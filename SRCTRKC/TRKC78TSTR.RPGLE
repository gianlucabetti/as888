000100170223      //==============================================================
000200170223      //?TRKC78TSTR - TEST richiamo TRKC78R
000300170223      //==============================================================
000400150116     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000500150116
000600170223      //--------------------------------------------------------------
000700170223      //?Dichiarazione file.                                          ?
000800170223      //--------------------------------------------------------------
000900170223      // - Video?
001000170223     fTRKC78TSTDcf   e             workstn
001100150116     f                                     indds(IndDspF)
001200150116     f                                     infds(InfDspF)
001300150116
001400170223      //--------------------------------------------------------------
001500170223      //?Definizione costanti.                                        ?
001600170223      //--------------------------------------------------------------
001700170223      // - Tasti funzionali a video?
001800150116     d c_F01           c                   const(x'31')
001900150116     d c_F02           c                   const(x'32')
002000150116     d c_F03           c                   const(x'33')
002100150116     d c_F04           c                   const(x'34')
002200150116     d c_F05           c                   const(x'35')
002300150116     d c_F06           c                   const(x'36')
002400150116     d c_F07           c                   const(x'37')
002500150116     d c_F08           c                   const(x'38')
002600150116     d c_F09           c                   const(x'39')
002700150116     d c_F10           c                   const(x'3A')
002800150116     d c_F11           c                   const(x'3B')
002900150116     d c_F12           c                   const(x'3C')
003000150116     d c_F13           c                   const(x'B1')
003100150116     d c_F14           c                   const(x'B2')
003200150116     d c_F15           c                   const(x'B3')
003300150116     d c_F16           c                   const(x'B4')
003400150116     d c_F17           c                   const(x'B5')
003500150116     d c_F18           c                   const(x'B6')
003600150116     d c_F19           c                   const(x'B7')
003700150116     d c_F20           c                   const(x'B8')
003800150116     d c_F21           c                   const(x'B9')
003900150116     d c_F22           c                   const(x'BA')
004000150116     d c_F23           c                   const(x'BB')
004100150116     d c_F24           c                   const(x'BC')
004200150116     d c_Enter         c                   const(x'F1')
004300150116     d c_RollDown      c                   const(x'F4')
004400150116     d c_RollUp        c                   const(x'F5')
004500150116
004600170223      //--------------------------------------------------------------
004700170223      //?Definizione schiere.                                         ?
004800170223      //--------------------------------------------------------------
004900150116
005000170223      //--------------------------------------------------------------
005100170223      //?Definizione aree dati.                                       ?
005200170223      //--------------------------------------------------------------
005300170223      // - Dati utente?
005400150116     d §AzUte        e ds                  extname(AZUTE00F)
005500150116     d                                     dtaara
005600150116     d §DatiUte      e ds                  extname(dDatiUte)
005700150116     d                                     dtaara
005800150116
005900170223      //--------------------------------------------------------------
006000170223      //?Definizione strutture dati.                                  ?
006100170223      //--------------------------------------------------------------
006200170223      // - Status ds?
006300150116     d Status         sds
006400150116     d   SDSpgm          *proc
006500150116
006600170223      // - InfDS?
006700150116     d InfDspF         ds
006800150116     d   dsp_aid             369    369a
006900150116
007000170223      // - Indicatori su DspF?
007100150116     d IndDspF         ds                  inz
007200170223        // - Abilitazione tasti funzionali?
007300150116     d   F3Attivo                      n   overlay(IndDspF : 03)
007400150116     d   F6Attivo                      n   overlay(IndDspF : 06)
007500150116     d   F12Attivo                     n   overlay(IndDspF : 12)
007600170223        // - Emissione messaggio di errore?
007700150116     d   ErrMessage                    n   overlay(IndDspF : 28)
007800170223        // - Indicatori di gestione del subfile?
007900150116     d   SflDsp_N                      n   overlay(IndDspF : 30)
008000150116     d   SflDspCtl_N                   n   overlay(IndDspF : 31)
008100150116     d   SflNxtChg                     n   overlay(IndDspF : 32)
008200150116     d   SflEnd                        n   overlay(IndDspF : 33)
008300170223        // - Riemissione videata?
008400150116     d   ErrGenerico                   n   overlay(IndDspF : 99)
008500150116
008600170223      // - Parametri ricevuti?
008700150116     d KPJBA         e ds
008800150116
008900170223      //--------------------------------------------------------------
009000170223      //?Definizione variabili globali.                               ?
009100170223      //--------------------------------------------------------------
009200170223      // - Flags Booleani?
009300170223     d Fine            s               n   inz
009400170223     d wInzD01         s               n   inz
009500150116
009600170223      // - Campi di comodo?
009700150116     d wDate_ISO       s               d   datfmt(*iso)  inz
009800150116     d wDate           s              8  0 inz
009900150116
010000170223      //--------------------------------------------------------------
010100170223      //?Definizione prototipi procedure usate.                       ?
010200170223      //--------------------------------------------------------------
010300170223      // - Reperimento dati utente?
010400150116     d TIBS34ds      e ds                  inz
010500150116      /copy gaitrasrc/srcProtoPR,TIBS34R
010600150116
010700170223      // - Reperimento dati utente?
010800170223     d TRKC78ds      e ds                  inz
010900170223     d trKC78r         pr                  extpgm('TRKC78R')
011000170223     d  kpjba                              likeds(KPJBA)
011100170223     d  trkc78ds                           likeds(TRKC78DS)
011200150116
011300170223      //--------------------------------------------------------------
011400170223      //?Definizione key-list.                                        ?
011500170223      //--------------------------------------------------------------
011600150116
011700170223      //--------------------------------------------------------------
011800170223      //?Riepilogo indicatori utilizzati.                             ?
011900170223      //--------------------------------------------------------------
012000170223
012100170223      //--------------------------------------------------------------
012200150116
012300170223      //--------------------------------------------------------------
012400170223      //?M A I N - L I N E                                            ?
012500170223      //--------------------------------------------------------------
012600150116     c     *Entry        plist
012700150116     c                   parm                    KPJBA
012800150116
012900150116      /free
013000150116
013100170223      //?Operazioni iniziali?
013200170223       exsr RoutInz;
013300150116
013400170223      //?Richiamo il programma
013500170223       DOW  not Fine;
013600170223         exsr GesD01;
013700170223       ENDDO;
013800150116
013900170223      //?Operazioni finali?
014000170223       exsr RoutEnd;
014100150116
014200170223      //--------------------------------------------------------------
014300170223      //?Operazioni iniziali.                                         ?
014400170223      //--------------------------------------------------------------
014500170223       BEGSR RoutInz;
014600150116
014700170223      //?Reperimento dati job?
014800170223         exsr DatiJob;
014900150116
015000170223      //?Reperimento data odierna?
015100150116         wDate_Iso = %date();
015200170223         wDate = %dec(%date());
015300150116
015400150116       ENDSR;
015500150116
015600170223      //--------------------------------------------------------------
015700170223      //?Reperimento Dati del job (Utente/Operativi).                 ?
015800170223      //--------------------------------------------------------------
015900170223       BEGSR DatiJob;
016000150116
016100150116         in(e) §AzUte;
016200170223         IF  NOT %error;
016300150116           in(e) §DatiUte;
016400170223         ENDIF;
016500170223         IF  %error or RSut = *blanks;
016600170223           tibs34r (TIBS34DS);
016700150116           in §AzUte;
016800150116           in §DatiUte;
016900170223         ENDIF;
017000150116
017100150116       ENDSR;
017200150116
017300170223      //--------------------------------------------------------------
017400170223      //?Gestione videata D01                                         ?
017500170223      //--------------------------------------------------------------
017600170223       BEGSR GesD01;
017700150116
017800170223      //?Inizializzazione videata?
017900170223         IF  wInzD01;
018000170223           clear KC78D01;
018100170223           wInzD01 = *off;
018200170223         ENDIF;
018300150116
018400150116         F6Attivo  = *on;
018500150116         F12Attivo = *off;
018600150116
018700170223      //?Emissione videata?
018800170223         IF  not ErrMessage;
018900170223           write KC78T01;
019000170223           write KC78P01;
019100170223         ENDIF;
019200170223         exfmt KC78D01;
019300150116
019400170223         clear V1Dmsg;
019500170223         reset ErrMessage;
019600170223         reset ErrGenerico;
019700150116
019800150116         SELECT;
019900170223      //?F3=Fine?
020000170223         WHEN  dsp_aid = c_F03;
020100170223           Fine = *on;
020200150116
020300170223      //?Invio o F6=Conferma?
020400170223         OTHER;
020500170223           exsr CtrD01;
020600170223           SELECT;
020700170223         //?rilevato errore?
020800170223           WHEN  ErrGenerico;
020900170223             leavesr;
021000170223         //?non premuto F6?
021100170223           WHEN  dsp_aid <> c_F06;
021200170223         //?richiamo da eseguire?
021300170223           OTHER;
021400170223             exsr CallTRKC78R;
021500170223           ENDSL;
021600150116
021700150116         ENDSL;
021800150116
021900150116       ENDSR;
022000150116
022100170223      //--------------------------------------------------------------
022200170223      //?Richiamo TRKC78R                                        ?
022300170223      //--------------------------------------------------------------
022400170223       BEGSR CallTRKC78R;
022500150116
022600170223      //?Richiamo *pgm TRKC78R?
022700170223         trkc78r (KPJBA:TRKC78DS);
022800150116
022900170223         *in28 = (OKC78err <> *blank);
023000170223         V1Dmsg = OKC78msg;
023100150116
023200150116         F6Attivo  = *off;
023300150116         F12Attivo = *on;
023400150116
023500170223         write KC78T01;
023600170223         write KC78P01;
023700170223         write KC78D01;
023800170223         write Protect;
023900150116
024000170223      //?Emissione 2ª videata (con il risultato)?
024100170223         DOU  dsp_aid = c_F03 or dsp_aid = c_F12;
024200150116
024300170223           exfmt KC78D02;
024400150116
024500170223        //?F3=Fine?
024600170223           IF  dsp_aid = c_F03;
024700170223             Fine = *on;
024800170223           ENDIF;
024900150116
025000170223         ENDDO;
025100150116
025200150116       ENDSR;
025300150116
025400170223      //--------------------------------------------------------------
025500170223      //?Controllo dati in videata D01                                ?
025600170223      //--------------------------------------------------------------
025700170223       BEGSR CtrD01;
025800150116
025900150116         %subst(IndDspF : 28) = *off;
026000150116
026100150116       ENDSR;
026200150116
026300170223      //--------------------------------------------------------------
026400170223      //?Operazioni finali.                                         ?
026500170223      //--------------------------------------------------------------
026600170223       BEGSR RoutEnd;
026700170223
026800170223         *inLR = *on;
026900150116
027000170223      //?Chiusura *pgm?
027100150116         return;
027200150116
027300150116       ENDSR;
027400150116
027500150116      /end-free
