000100100311       //--------------------------------------------------------------
000200100311       //?TEST - PREPARA E-MAIL DI CONFERMA APPUNTAMENTO               ?
000300100311       //--------------------------------------------------------------
000400100311
000500100311     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000600100311     h dftactgrp(*no) actgrp('QILE')
000700100311
000800100311       //--------------------------------------------------------------
000900100311       //?Dichiarazione file.                                          ?
001000100311       //--------------------------------------------------------------
001100100311
001200100311       // -?Video?
001300100311     fTRMK23TSTDcf   e             workstn
001400100311     f                                     indds(IndDspF)
001500100311     f                                     infds(InfDspF)
001600100311
001700100311       //--------------------------------------------------------------
001800100311       //?Definizione costanti.                                        ?
001900100311       //--------------------------------------------------------------
002000100311
002100100311       // -?Tasti funzionali a video?
002200100311     d c_F01           c                   const(x'31')
002300100311     d c_F02           c                   const(x'32')
002400100311     d c_F03           c                   const(x'33')
002500100311     d c_F04           c                   const(x'34')
002600100311     d c_F05           c                   const(x'35')
002700100311     d c_F06           c                   const(x'36')
002800100311     d c_F07           c                   const(x'37')
002900100311     d c_F08           c                   const(x'38')
003000100311     d c_F09           c                   const(x'39')
003100100311     d c_F10           c                   const(x'3A')
003200100311     d c_F11           c                   const(x'3B')
003300100311     d c_F12           c                   const(x'3C')
003400100311     d c_F13           c                   const(x'B1')
003500100311     d c_F14           c                   const(x'B2')
003600100311     d c_F15           c                   const(x'B3')
003700100311     d c_F16           c                   const(x'B4')
003800100311     d c_F17           c                   const(x'B5')
003900100311     d c_F18           c                   const(x'B6')
004000100311     d c_F19           c                   const(x'B7')
004100100311     d c_F20           c                   const(x'B8')
004200100311     d c_F21           c                   const(x'B9')
004300100311     d c_F22           c                   const(x'BA')
004400100311     d c_F23           c                   const(x'BB')
004500100311     d c_F24           c                   const(x'BC')
004600100311     d c_Enter         c                   const(x'F1')
004700100311     d c_RollDown      c                   const(x'F4')
004800100311     d c_RollUp        c                   const(x'F5')
004900100311
005000100311       //--------------------------------------------------------------
005100100311       //?Definizione schiere.                                         ?
005200100311       //--------------------------------------------------------------
005300100311
005400100311
005500100311       //--------------------------------------------------------------
005600100311       //?Definizione aree dati.                                       ?
005700100311       //--------------------------------------------------------------
005800100311
005900100311       // -?Dati utente?
006000100311     d §AzUte        e ds                  extname(AZUTE00F)
006100100311     d                                     dtaara
006200100311     d §DatiUte      e ds                  extname(dDatiUte)
006300100311     d                                     dtaara
006400100311
006500100311       //--------------------------------------------------------------
006600100311       //?Definizione strutture dati.                                  ?
006700100311       //--------------------------------------------------------------
006800100311
006900100311       // -?Status ds?
007000100311     d Status         sds
007100100311     d  SDSpgm           *proc
007200100311     d  SDSprm           *parms
007300100311     d  SDSusr               254    263
007400100311
007500100311       // -?InfDS?
007600100311     d InfDspF         ds
007700100311     d  dsp_aid              369    369a
007800100311
007900100311       // -?Indicatori su DspF?
008000100311     d IndDspF         ds
008100100311         // -?Indicatori di errore?
008200100311     d   ErrMessage                   1n   overlay(IndDspF : 28)
008300100311     d   ErrGenerico                  1n   overlay(IndDspF : 99)
008400100311
008500100311       // -?Parametri ricevuti?
008600100311     d KPJBA         e ds
008700100311
008800100311       // -?Parametri x Controllo profilo utenti?
008900100311     d TIBS34ds      e ds
009000100311
009100100311       // -?Dati da stampare?
009200100311     d TRMK23ds      e ds                  inz
009300100311
009400100311       //--------------------------------------------------------------
009500100311       //?Definizione variabili globali.                               ?
009600100311       //--------------------------------------------------------------
009700100311
009800100311       // -?Flags booleani?
009900100311     d $Fine           s               n   inz(*off)
010000100311     d $InzD01         s               n   inz(*on)
010100100311
010200100311       //--------------------------------------------------------------
010300100311       //?Definizione procedure usate.                                 ?
010400100311       //--------------------------------------------------------------
010500100311
010600100311       // -?Reperimento dati utente?
010700100311     d tibs34r         pr                  extpgm('TIBS34R')
010800100311     d   tibs34ds                          likeds(TIBS34ds)
010900100311
011000100311       // -?Stampa e-mail?
011100100311     d trmk23r         pr                  extpgm('TRMK23R')
011200100311     d   kpjba                             likeds(KPJBA)
011300100311
011400100311       //--------------------------------------------------------------
011500100311       //?Definizione key-list.                                        ?
011600100311       //--------------------------------------------------------------
011700100311
011800100311
011900100311       //--------------------------------------------------------------
012000100311       //?MAIN-LINE.                                                   ?
012100100311       //--------------------------------------------------------------
012200100311
012300100311     c     *Entry        plist
012400100311     c                   parm                    KPJBA
012500100311
012600100311      /free
012700100311
012800100311       // -?Start?
012900100311       *inLR = *on;
013000100311
013100100311       // -?Elab?
013200100311       dow  $Fine = *off;
013300100311         exsr sr_GesD01;
013400100311       enddo;
013500100311
013600100311       // -?End?
013700100311       return;
013800100311
013900100311       //--------------------------------------------------------------
014000100311       //?Operazioni iniziali                                          ?
014100100311       //--------------------------------------------------------------
014200100311       BEGSR  *InzSR;
014300100311
014400100311         // -?Reperimento dati utente?
014500100311         exsr sr_DatiJob;
014600100311
014700100311         // -?Impostazione nome programma in testata a video?
014800100311         VTDpgm = SDSpgm;
014900100311
015000100311       ENDSR;
015100100311
015200100311       //--------------------------------------------------------------
015300100311       //?Reperimento Dati del job (Utente/Operativi).                 ?
015400100311       //--------------------------------------------------------------
015500100311       BEGSR  sr_DatiJob;
015600100311
015700100311         in(E) §AzUte;
015800100311         if NOT %error;
015900100311           in(E) §DatiUte;
016000100311         endif;
016100100311         if %error or RSut = *blanks;
016200100311           clear TIBS34ds;
016300100311           tibs34r(tibs34ds);
016400100311           in §AzUte;
016500100311           in §DatiUte;
016600100311         endif;
016700100311
016800100311       ENDSR;
016900100311
017000100311       //--------------------------------------------------------------
017100100311       //?Gestione videata D01                                         ?
017200100311       //--------------------------------------------------------------
017300100311       BEGSR  sr_GesD01;
017400100311
017500100311         // -?Inizializzazione videata?
017600100311         if  $InzD01 = *on;
017700100311           clear TRMK23ds;
017800100311           $InzD01  = *off;
017900100311         endif;
018000100311
018100100311         // -?Emissione videata?
018200100311         if  ErrMessage = *off;
018300100311           write MK23T01;
018400100311           write MK23Z01;
018500100311         endif;
018600100311
018700100311         exfmt MK23D01;
018800100311
018900100311         reset ErrMessage;
019000100311         reset ErrGenerico;
019100100311         clear V1Dmsg;
019200100311
019300100311         SELECT;
019400100311
019500100311           // -?F3=Fine?
019600100311           WHEN  dsp_aid = c_F03;
019700100311             $Fine = *on;
019800100311
019900100311           // -?Invio o F6=Conferma?
020000100311           OTHER;
020100100311             exsr sr_CtrD01;
020200100311             select;
020300100311               // -?rilevato errore?
020400100311               when  ErrGenerico = *on;
020500100311               // -?non premuto F6?
020600100311               when  dsp_aid <> c_F06;
020700100311               // -?invio e-mail?
020800100311               other;
020900100311                 exsr  Call_TRMK23R;
021000100311                 //reset  $InzD01;
021100100311             endsl;
021200100311
021300100311         ENDSL;
021400100311
021500100311       ENDSR;
021600100311
021700100311       //--------------------------------------------------------------
021800100311       //?Richiamo stored procedure per immagini LdV                   ?
021900100311       //--------------------------------------------------------------
022000100311       BEGSR  Call_TRMK23R;
022100100311
022200100311         KPJBU = TRMK23ds;
022300100311         trmk23r ( kpjba );
022400100311         TRMK23ds = KPJBU;
022500100311
022600100311         write  Protect;
022700100311         exfmt  MK23D02;
022800100311
022900100311         // -?F3=Fine?
023000100311         if  dsp_aid = c_F03;
023100100311           $Fine = *on;
023200100311           leavesr;
023300100311         endif;
023400100311
023500100311       ENDSR;
023600100311
023700100311       //--------------------------------------------------------------
023800100311       //?Controllo dati in videata D01                                ?
023900100311       //--------------------------------------------------------------
024000100311       BEGSR  sr_CtrD01;
024100100311
024200100311         %subst( IndDspF : 50 ) = *off;
024300100311
024400100311       ENDSR;
024500100311
024600100311      /end-free
