000100130712      *PARMS dftactgrp(*no) actgrp('QILE') option(*noxref)
000200130712     /*PRM dbgview(*source)
000300130712     /*END
000400130712       //==============================================================
000500130712       //?TEST - SELEZIONE COMMERCIALE da AZCMM00F.                    ?
000600130712       //==============================================================
000700130712
000800130712     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000900130712     h dftactgrp(*no)
001000130712
001100130712       //--------------------------------------------------------------
001200130712       //?Dichiarazione file.                                          ?
001300130712       //--------------------------------------------------------------
001400130712
001500130712       // -?Video?
001600130712     fTRMK43TSTDcf   e             workstn
001700130712     f                                     indds(IndDspF)
001800130712     f                                     infds(InfDspF)
001900130712
002000130712       //--------------------------------------------------------------
002100130712       //?Definizione costanti.                                        ?
002200130712       //--------------------------------------------------------------
002300130712
002400130712       // -?Tasti funzionali a video?
002500130712     d c_F01           c                   const(x'31')
002600130712     d c_F02           c                   const(x'32')
002700130712     d c_F03           c                   const(x'33')
002800130712     d c_F04           c                   const(x'34')
002900130712     d c_F05           c                   const(x'35')
003000130712     d c_F06           c                   const(x'36')
003100130712     d c_F07           c                   const(x'37')
003200130712     d c_F08           c                   const(x'38')
003300130712     d c_F09           c                   const(x'39')
003400130712     d c_F10           c                   const(x'3A')
003500130712     d c_F11           c                   const(x'3B')
003600130712     d c_F12           c                   const(x'3C')
003700130712     d c_F13           c                   const(x'B1')
003800130712     d c_F14           c                   const(x'B2')
003900130712     d c_F15           c                   const(x'B3')
004000130712     d c_F16           c                   const(x'B4')
004100130712     d c_F17           c                   const(x'B5')
004200130712     d c_F18           c                   const(x'B6')
004300130712     d c_F19           c                   const(x'B7')
004400130712     d c_F20           c                   const(x'B8')
004500130712     d c_F21           c                   const(x'B9')
004600130712     d c_F22           c                   const(x'BA')
004700130712     d c_F23           c                   const(x'BB')
004800130712     d c_F24           c                   const(x'BC')
004900130712     d c_Enter         c                   const(x'F1')
005000130712     d c_RollDown      c                   const(x'F4')
005100130712     d c_RollUp        c                   const(x'F5')
005200130712
005300130712       //--------------------------------------------------------------
005400130712       //?Definizione schiere.                                         ?
005500130712       //--------------------------------------------------------------
005600130712
005700130712
005800130712       //--------------------------------------------------------------
005900130712       //?Definizione aree dati.                                       ?
006000130712       //--------------------------------------------------------------
006100130712
006200130712       // -?Dati utente?
006300130712     d §AzUte        e ds                  extname(AZUTE00F)
006400130712     d                                     dtaara
006500130712     d §DatiUte      e ds                  extname(dDatiUte)
006600130712     d                                     dtaara
006700130712
006800130712       //--------------------------------------------------------------
006900130712       //?Definizione strutture dati.                                  ?
007000130712       //--------------------------------------------------------------
007100130712
007200130712       // -?Status ds?
007300130712     d Status         sds
007400130712     d   SDSpgm          *proc
007500130712     d   SDSprm          *parms
007600130712     d   SDSusr              254    263
007700130712
007800130712       // -?InfDS?
007900130712     d InfDspF         ds
008000130712     d   dsp_aid             369    369a
008100130712
008200130712       // -?Indicatori su DspF?
008300130712     d IndDspF         ds
008400130712         // -?Abilitazione tasti funzionali?
008500130712     d   F6Attivo                      n   overlay(IndDspF : 06)
008600130712         // -?Emissione messaggio di errore?
008700130712     d   ErrMessage                    n   overlay(IndDspF : 28)
008800130712         // -?Riemissione videata?
008900130712     d   ErrGenerico                   n   overlay(IndDspF : 99)
009000130712
009100130712       // -?Parametri x TRMK43R?
009200130712     d KPJBA         e ds                  inz
009300130712     d TRMK43ds      e ds                  inz
009400130712     d AZCMMds       e ds                  extname(AZCMM00F)
009500130712     d                                     inz
009600130712     d AZNTC01ds     e ds                  extname(AZNTC00F) prefix(A_)
009700130712     d                                     inz
009800130712     d AZNTC02ds     e ds                  extname(AZNTC00F) prefix(B_)
009900130712     d                                     inz
010000130712
010100130712       //--------------------------------------------------------------
010200130712       //?Definizione variabili globali.                               ?
010300130712       //--------------------------------------------------------------
010400130712
010500130712       // -?Flags booleani?
010600130712     d $Fine           s               n   inz(*off)
010700130712     d $InzD01         s               n   inz(*on)
010800130712
010900130712       //--------------------------------------------------------------
011000130712       //?Definizione procedure usate.                                 ?
011100130712       //--------------------------------------------------------------
011200130712
011300130712       // -?Reperimento dati utente?
011400130712     d TIBS34ds      e ds                  qualified
011500130712      /copy gaitrasrc/srcProtoPR,TIBS34R
011600130712
011700130712       // -?Selezione commerciale?
011800130712     d trmk43r_01      pr                  extpgm('TRMK43R')
011900130712     d   kpjba                             likeds(KPJBA)
012000130712     d trmk43r_02      pr                  extpgm('TRMK43R')
012100130712     d   kpjba                             likeds(KPJBA)
012200130712     d   trmk43ds                          likeds(TRMK43ds)
012300130712     d trmk43r_03      pr                  extpgm('TRMK43R')
012400130712     d   kpjba                             likeds(KPJBA)
012500130712     d   trmk43ds                          likeds(TRMK43ds)
012600130712     d   AZCMMds                           likeds(AZCMMds)
012700130712     d trmk43r_04      pr                  extpgm('TRMK43R')
012800130712     d   kpjba                             likeds(KPJBA)
012900130712     d   trmk43ds                          likeds(TRMK43ds)
013000130712     d   AZCMMds                           likeds(AZCMMds)
013100130712     d   AZNTC01ds                         likeds(AZNTC01ds)
013200130712     d trmk43r_05      pr                  extpgm('TRMK43R')
013300130712     d   kpjba                             likeds(KPJBA)
013400130712     d   trmk43ds                          likeds(TRMK43ds)
013500130712     d   AZCMMds                           likeds(AZCMMds)
013600130712     d   AZNTC01ds                         likeds(AZNTC01ds)
013700130712     d   AZNTC02ds                         likeds(AZNTC02ds)
013800130712
013900130712       //--------------------------------------------------------------
014000130712       //?Definizione key-list.                                        ?
014100130712       //--------------------------------------------------------------
014200130712
014300130712
014400130712       //--------------------------------------------------------------
014500130712       //?Riepilogo indicatori.                                        ?
014600130712       //--------------------------------------------------------------
014700130712
014800130712
014900130712       //--------------------------------------------------------------
015000130712       //?M A I N - L I N E                                            ?
015100130712       //--------------------------------------------------------------
015200130712
015300130712      /free
015400130712
015500130712       // -?Start?
015600130712       *inLR = *on;
015700130712
015800130712       // -?Elab?
015900130712       dow  $Fine = *off;
016000130712         exsr  sr_GesD01;
016100130712       enddo;
016200130712
016300130712       // -?End?
016400130712       return;
016500130712
016600130712       //--------------------------------------------------------------
016700130712       //?Operazioni iniziali.                                         ?
016800130712       //--------------------------------------------------------------
016900130712       BEGSR  *InzSR;
017000130712
017100130712         // -?Reperimento dati job?
017200130712         exsr  sr_DatiJob;
017300130712
017400130712         // -?Impostazione nome programma a video?
017500130712         //VTDpgm = SDSpgm;
017600130712
017700130712       ENDSR;
017800130712
017900130712       //--------------------------------------------------------------
018000130712       //?Reperimento Dati del job (Utente/Operativi).                 ?
018100130712       //--------------------------------------------------------------
018200130712       BEGSR  sr_DatiJob;
018300130712
018400130712         in(E) §AzUte;
018500130712         if NOT %error;
018600130712           in(E) §DatiUte;
018700130712         endif;
018800130712         if %error or RSut = *blanks;
018900130712           clear TIBS34ds;
019000130712           tibs34r(tibs34ds);
019100130712           in §AzUte;
019200130712           in §DatiUte;
019300130712         endif;
019400130712
019500130712       ENDSR;
019600130712
019700130712       //--------------------------------------------------------------
019800130712       //?Gestione videata D01                                         ?
019900130712       //--------------------------------------------------------------
020000130712       BEGSR  sr_GesD01;
020100130712
020200130712         // -?Inizializzazione videata?
020300130712         if  $InzD01 = *on;
020400130712           clear  MK43D1;
020500130712           $InzD01 = *off;
020600130712         endif;
020700130712
020800130712         F6Attivo = *on;
020900130712
021000130712         // -?Emissione videata?
021100130712         if  ErrMessage = *off;
021200130712           write  MK43T1;
021300130712           write  MK43Z1;
021400130712         endif;
021500130712         exfmt  MK43D1;
021600130712
021700130712         reset  ErrMessage;
021800130712         reset  ErrGenerico;
021900130712         clear  V1Dmsg;
022000130712
022100130712         SELECT;
022200130712
022300130712           // -?F3=Fine?
022400130712           WHEN  dsp_aid = c_F03;
022500130712             $Fine = *on;
022600130712
022700130712           // -?Invio o F6=Conferma?
022800130712           OTHER;
022900130712             exsr  sr_CtrD01;
023000130712             select;
023100130712               // -?rilevato errore?
023200130712               when  ErrGenerico = *on;
023300130712               // -?non premuto F6?
023400130712               when  dsp_aid <> c_F06;
023500130712               // -?richiamo da eseguire?
023600130712               other;
023700130712                 exsr  Call_TRMK43R;
023800130712                 //reset  $InzD01;
023900130712                 //clear  iMK43solU;
024000130712                 clear  iMK43fil;
024100130712             endsl;
024200130712
024300130712         ENDSL;
024400130712
024500130712       ENDSR;
024600130712
024700130712       //--------------------------------------------------------------
024800130712       //?Richiamo *pgm TRMK43R                                        ?
024900130712       //--------------------------------------------------------------
025000130712       BEGSR  Call_TRMK43R;
025100130712
025200130712         // -?Richiamo *pgm TRMK43R?
025300130712         select;
025400130712           when  V1Cnrp = 1;
025500130712             trmk43r_01 ( kpjba );
025600130712           when  V1Cnrp = 2;
025700130712             trmk43r_02 ( kpjba : trmk43ds );
025800130712           when  V1Cnrp = 3;
025900130712             trmk43r_03 ( kpjba : trmk43ds : AZCMMds );
026000130712           when  V1Cnrp = 4;
026100130712             trmk43r_04 ( kpjba : trmk43ds : AZCMMds : AZNTC01ds );
026200130712           when  V1Cnrp = 5;
026300130712             trmk43r_05 ( kpjba : trmk43ds : AZCMMds : AZNTC01ds : AZNTC02ds );
026400130712         endsl;
026500130712
026600130712         *in28  = (oMK43err <> *off);
026700130712         V1Dmsg = oMK43msg;
026800130712         F6Attivo = *off;
026900130712
027000130712         write  MK43T1;
027100130712         write  MK43Z1;
027200130712         write  MK43D1;
027300130712         write  Protect;
027400130712
027500130712         // -?Emissione 2ª videata (con il risultato)?
027600130712         DoU  dsp_aid = c_F03  or  dsp_aid = c_F12;
027700130712
027800130712           exfmt  MK43D2;
027900130712
028000130712           // -?F3=Fine?
028100130712           if  dsp_aid = c_F03;
028200130712             $Fine = *on;
028300130712           endif;
028400130712
028500130712         EndDo;
028600130712
028700130712       ENDSR;
028800130712
028900130712       //--------------------------------------------------------------
029000130712       //?Controllo dati in videata D01                                ?
029100130712       //--------------------------------------------------------------
029200130712       BEGSR  sr_CtrD01;
029300130712
029400130712         %subst(IndDspF : 28) = *off;
029500130712
029600130712       ENDSR;
029700130712
029800130712      /end-free
