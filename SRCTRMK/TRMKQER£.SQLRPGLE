000100101108      //--------------------------------------------------------------
000200111003      //?TRMKQER - Sistema potenziale su TIATCE TIVISC dopo fusione
000300101108      //--------------------------------------------------------------
000400101108     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000500101108
000600101108      //---------------------------------------------------------------
000700101108      //?Dichiarazione file.
000800101108      //---------------------------------------------------------------
000900101108
001000111003     fTIATC01L  uf   e           k disk
001100101108
001200101108      //---------------------------------------------------------------
001300101108      //?Definizione costanti.
001400101108      //---------------------------------------------------------------
001500101108
001600101108      //---------------------------------------------------------------
001700101108      //?Definizione schiere.
001800101108      //---------------------------------------------------------------
001900101108
002000101108      //---------------------------------------------------------------
002100101108      //?Definizione aree dati.
002200101108      //---------------------------------------------------------------
002300101108
002400101108      //---------------------------------------------------------------
002500101108      //?Definizione strutture dati.
002600101108      //---------------------------------------------------------------
002700101110
002800101110      // - Parametri ricevuti
002900101110     d KPJBA         e ds
003000111003
003100111003      // - File Attività Concluse SIC
003200111003     d ATEDS         e ds                  extname(TIATCE0F)
003300101108
003400101108      //---------------------------------------------------------------
003500101108      //?Definizione variabili globali.
003600101108      //---------------------------------------------------------------
003700101108
003800101108      // - Flags booleani
003900101110     d $EndAtt         s               n   inz(*off)
004000101108
004100101108      //---------------------------------------------------------------
004200101108      //?Definizione procedure usate.
004300101108      //---------------------------------------------------------------
004400101108
004500101108      //---------------------------------------------------------------
004600101108      //?Prototipi usati.
004700101108      //---------------------------------------------------------------
004800101108
004900101108      //---------------------------------------------------------------
005000101108      //?Definizione key-list.
005100101108      //---------------------------------------------------------------
005200101108
005300101108      //---------------------------------------------------------------
005400101108      //?Riepilogo indicatori.
005500101108      //---------------------------------------------------------------
005600101108
005700101108      //---------------------------------------------------------------
005800101108      //?M A I N - L I N E
005900101108      //---------------------------------------------------------------
006000101110
006100101110     c     *Entry        plist
006200101110     c                   parm                    KPJBA
006300101108
006400101108      /free
006500101108
006600101108       //?Operazioni iniziali
006700101108       exsr RoutInz;
006800101108
006900111003       //?Elaboro il record
007000111003       exsr Elabora;
007100101108
007200101108       //?Operazioni finali
007300101108       exsr RoutEnd;
007400101108
007500101108       //--------------------------------------------------------------
007600101108       //?Operazioni iniziali.
007700101108       //--------------------------------------------------------------
007800101108       BEGSR RoutInz;
007900101110
008000101108
008100101108       ENDSR;
008200101108
008300101108       //--------------------------------------------------------------
008400101108       //?Elaborazione record.
008500101108       //--------------------------------------------------------------
008600101108       BEGSR Elabora;
008700111003
008800111003         $EndAtt = *off;
008900111003
009000111003         exec sql
009100111003           DECLARE ATE cursor for
009200111003           SELECT * from TIATCE0F
009300111003           order by ATEtat, ATEatn, ATEatnp;
009400111003
009500111003         exec sql
009600111003           OPEN ATE;
009700101108
009800111003       //?Leggo il file del SIC
009900111003         DOW  not $EndAtt;
010000111003           exec sql fetch next from ATE into :ATEDS;
010100111003           IF  sqlcod = 100 or sqlcod < 0;
010200111003             $EndAtt = *on;
010300111003             leave;
010400111003           ENDIF;
010500111003
010600111003         //?Aggancio l'attività
010700111003           chain (ATEtat:ATEatn:ATEatnp) TIATC01L;
010800111003           IF  %found(TIATC01L) and ATEcpo <> ATCcpo and
010900111003             ATCtas = 'S';
011000111003             clear ATCtas;
011100111003             UPDATE TIATC000;
011200111003           ENDIF;
011300101108
011400111003         ENDDO;
011500111003
011600111003         exec sql
011700111003           CLOSE ATE;
011800101108
011900101108       ENDSR;
012000101108
012100101108       //--------------------------------------------------------------
012200101108       //?Operazioni finali.
012300101108       //--------------------------------------------------------------
012400101108       BEGSR RoutEnd;
012500101108
012600101108         *inLR = *on;
012700101108         return;
012800101108
012900101108       ENDSR;
013000101108
013100101108      /end-free
