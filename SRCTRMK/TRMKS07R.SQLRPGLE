000100120925      //--------------------------------------------------------------
000200121206      //?TRMKS07R - Pulizia SIC file Info Commerciali.
000300120925      //--------------------------------------------------------------
000400120925
000500120925     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000600120925
000700120925      //---------------------------------------------------------------
000800120925      //?Dichiarazione file.
000900120925      //---------------------------------------------------------------
001000121105
001100121206       // -?SIC Info commerciali
001200140912     fTICPIM1F  uf   e             disk
001300120925
001400120925      //---------------------------------------------------------------
001500120925      //?Definizione costanti.
001600120925      //---------------------------------------------------------------
001700120925
001800120925      //---------------------------------------------------------------
001900120925      //?Definizione schiere.
002000120925      //---------------------------------------------------------------
002100120925
002200120925      //---------------------------------------------------------------
002300120925      //?Definizione aree dati.
002400120925      //---------------------------------------------------------------
002500120925
002600120925      //---------------------------------------------------------------
002700120925      //?Definizione strutture dati.
002800120925      //---------------------------------------------------------------
002900121010
003000121010       // -?Kpjba
003100121010     d KPJBA         e ds
003200121105
003300140912       // -?File TICPIM1F
003400140912     d TICPIMds      e ds                  extname(TICPIM1F)
003500120925
003600120925      //---------------------------------------------------------------
003700120925      //?Definizione variabili globali.
003800120925      //---------------------------------------------------------------
003900120925
004000120925       // -?Flags booleani
004100120925     d wEoF            s               n   inz(*off)
004200120928
004300120928       // -?Campi Rnn
004400121206     d CPIM_rrn        s              9  0
004500121008
004600120925      //---------------------------------------------------------------
004700120925      //?Definizione procedure esterne.
004800120925      //---------------------------------------------------------------
004900120925
005000120925      //---------------------------------------------------------------
005100120925      //?Definizione prototipi.
005200120925      //---------------------------------------------------------------
005300120925
005400120925      //---------------------------------------------------------------
005500120925      //?Definizione key-list.
005600120925      //---------------------------------------------------------------
005700120925
005800120925      //---------------------------------------------------------------
005900120925      //?Riepilogo indicatori.
006000120925      //---------------------------------------------------------------
006100120925
006200120925      //---------------------------------------------------------------
006300120925
006400120925      //---------------------------------------------------------------
006500120925      //?M A I N - L I N E
006600120925      //---------------------------------------------------------------
006700121011
006800121011     c     *entry        plist
006900121011     c                   parm                    KPJBA
007000120925
007100120925      /free
007200120925
007300120925       //?Operazioni iniziali
007400120925       exsr RoutInz;
007500121105
007600121206       //?Pulizia TICPIM
007700121206       exsr Pul_TICPIM;
007800120925
007900120925       //?Operazioni finali
008000120925       exsr RoutEnd;
008100120925
008200120925       //--------------------------------------------------------------
008300120925       //?Operazioni iniziali.
008400120925       //--------------------------------------------------------------
008500120925       BEGSR RoutInz;
008600120925
008700120925         exec sql set option dynusrprf = *owner, closqlcsr = *endmod;
008800120925
008900120925       ENDSR;
009000121105
009100121105       //--------------------------------------------------------------
009200140912       //?Pulizia TICPIM1F.
009300121105       //--------------------------------------------------------------
009400121206       BEGSR Pul_TICPIM;
009500121105
009600121105         wEoF = *off;
009700121105
009800140912       //?Leggo TICPIM1F senza TNCPO00F
009900121105         exec sql
010000121206          DECLARE CPIM cursor for
010100140912          SELECT rrn(TICPIM1F) from TICPIM1F
010200121206          exception join TNCPO00F on
010300121206          CPMcpo = CPOcpo;
010400121105
010500121105         exec sql
010600121206           open CPIM;
010700121206
010800121105         IF sqlcode < 0;
010900121105           wEoF = *on;
011000121105           leavesr;
011100121105         ENDIF;
011200121105
011300121105         DOW  not wEoF;
011400121105
011500121206           exec sql fetch next from CPIM into :CPIM_rrn;
011600121105           IF  sqlcod = 100 or sqlcod < 0;
011700121105             wEoF = *on;
011800121105             leave;
011900121105           ENDIF;
012000121105
012100121206         //?Deleto lo storico info comm.
012200140912           chain CPIM_rrn TICPIM1F;
012300140912           IF  %found(TICPIM1F);
012400140912             DELETE  TICPIM10;
012500121105           ENDIF;
012600121105
012700121105         ENDDO;
012800121105
012900121206         exec sql close CPIM;
013000121105         wEoF = *off;
013100121105
013200121105       ENDSR;
013300120925
013400120925       //--------------------------------------------------------------
013500120925       //?Operazioni finali.
013600120925       //--------------------------------------------------------------
013700120925       BEGSR RoutEnd;
013800120925
013900120925         *inLR = *on;
014000120925         return;
014100120925
014200120925       ENDSR;
014300120925
014400120925      /end-free
