000100160209      //--------------------------------------------------------------
000200160209      //?TRSM90R - Elimina File Tariffe Inserite dopo annulla tariffa
000300160209      //--------------------------------------------------------------
000400160209     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000500160209
000600160209      //---------------------------------------------------------------
000700160209      //?Dichiarazione file.
000800160209      //---------------------------------------------------------------
000900160209
001000160209      //---------------------------------------------------------------
001100160209      //?Definizione costanti.
001200160209      //---------------------------------------------------------------
001300160209
001400160209      //---------------------------------------------------------------
001500160209      //?Definizione schiere.
001600160209      //---------------------------------------------------------------
001700160209
001800160209      //---------------------------------------------------------------
001900160209      //?Definizione aree dati.
002000160209      //---------------------------------------------------------------
002100160209      // - Dati utente
002200160209     d §AzUte        e ds                  extname(AZUTE00F)
002300160209     d                                     dtaara
002400160209     d §DatiUte      e ds                  extname(dDatiUte)
002500160209     d                                     dtaara
002600160209
002700160209      //---------------------------------------------------------------
002800160209      //?Definizione strutture dati.
002900160209      //---------------------------------------------------------------
003000160209      // - Parametri ricevuti
003100160209     d KPJBA         e ds
003200160209
003300160209      // - Reperimento dati utente
003400160209     d TIBS34DS      e ds
003500160209
003600160209      // - Ds passaggio dati
003700160209     d TRSM90DS      e ds
003800160209
003900160209      // - File Tariffe Inserite
004000160209     d TNRST00F      e ds                  extname(TNRST00F)
004100160209     d TNRSD00F      e ds                  extname(TNRSD00F)
004200160209
004300160209      // - File Tariffe
004400160209     d TNTAM00F      e ds                  extname(TNTAM00F)
004500160209
004600160209      //---------------------------------------------------------------
004700160209      //?Definizione variabili globali.
004800160209      //---------------------------------------------------------------
004900160209
005000160209      //---------------------------------------------------------------
005100160209      //?Definizione Procedure usate.
005200160209      //---------------------------------------------------------------
005300160209
005400160209      //---------------------------------------------------------------
005500160209      //?Definizione Prototipi.
005600160209      //---------------------------------------------------------------
005700160209      /copy gaitrasrc/srcprotopr,TIBS34R
005800160209
005900160209      //---------------------------------------------------------------
006000160209      //?Definizione key-list.
006100160209      //---------------------------------------------------------------
006200160209
006300160209      //---------------------------------------------------------------
006400160209      //?M A I N - L I N E
006500160209      //---------------------------------------------------------------
006600160209
006700160209     c     *Entry        plist
006800160209     c                   parm                    kpjba
006900160209     c                   parm                    TRSM90DS
007000160209
007100160209      /free
007200160209
007300160209       //?Operazioni iniziali
007400160209       exsr RoutInz;
007500160209
007600160209       //?Controllo la tariffa passata
007700160209       exsr Controlla;
007800160209
007900160209       //?Elimina file
008000160209       exsr Elimina;
008100160209
008200160209       //?Operazioni finali
008300160209       exsr RoutEnd;
008400160209
008500160209       //--------------------------------------------------------------
008600160209       //?Operazioni iniziali.
008700160209       //--------------------------------------------------------------
008800160209       BEGSR RoutInz;
008900160209
009000160209         exec sql set option dynusrprf = *owner, closqlcsr = *endmod;
009100160209
009200160209       //?Reperimento dati job
009300160209         exsr DatiJob;
009400160209
009500160209       //?Pulisco dati output
009600160209         clear OSM90err;
009700160209         clear OSM90msg;
009800160209
009900160209       ENDSR;
010000160209
010100160209       //--------------------------------------------------------------
010200160209       //?Reperimento Dati del job (Utente/Operativi).
010300160209       //--------------------------------------------------------------
010400160209       BEGSR DatiJob;
010500160209
010600160209         in(E) §AzUte;
010700160209         IF  NOT %error;
010800160209           in(E) §DatiUte;
010900160209         ENDIF;
011000160209         IF  %error or RSut = *blanks;
011100160209           clear TIBS34ds;
011200160209           tibs34r(tibs34ds);
011300160209           in §AzUte;
011400160209           in §DatiUte;
011500160209         ENDIF;
011600160209
011700160209       ENDSR;
011800160209
011900160209       //--------------------------------------------------------------
012000160209       //?Controllo la tariffa passata.
012100160209       //--------------------------------------------------------------
012200160209       BEGSR Controlla;
012300160209
012400160209         exec sql SELECT TAMatb into :TAMatb
012500160209                  FROM TNTAM00F
012600160209                  WHERE TAMksc = :ISM90ksc and
012700160209                        TAMctr = :ISM90ctr and
012800160209                        TAMprg = :ISM90prg;
012900160209
013000160209       //?Non trovata tariffa
013100160209          IF  sqlcod <> 0;
013200160209            OSM90err = '1';
013300160209            OSM90msg = 'Tariffa inesistente';
013400160209            exsr RoutEnd;
013500160209          ENDIF;
013600160209
013700160209       //?Trovata tariffa ma non annullata
013800160209          IF  TAMatb = *blanks;
013900160209            OSM90err = '1';
014000160209            OSM90msg = 'Tariffa ancora valida';
014100160209            exsr RoutEnd;
014200160209          ENDIF;
014300160209
014400160209       ENDSR;
014500160209
014600160209       //--------------------------------------------------------------
014700160209       //?Elimina file.
014800160209       //--------------------------------------------------------------
014900160209       BEGSR Elimina;
015000160209
015100160209       //?Elimino TNRST00F
015200160209         exec sql DELETE from TNRST00F
015300160209                  WHERE  RSTksc = :ISM90ksc and
015400160209                         RSTctr = :ISM90ctr and
015500160209                         RSTprg = :ISM90prg;
015600160209
015700160209       //?Elimino TNRSD00F
015800160209         exec sql DELETE from TNRSD00F
015900160209                  WHERE  RSDksc = :ISM90ksc and
016000160209                         RSDctr = :ISM90ctr and
016100160209                         RSDprg = :ISM90prg;
016200160209
016300160209       ENDSR;
016400160209
016500160209       //--------------------------------------------------------------
016600160209       //?Operazioni finali.
016700160209       //--------------------------------------------------------------
016800160209       BEGSR RoutEnd;
016900160209
017000160209         *inLR = *on;
017100160209         return;
017200160209
017300160209       ENDSR;
017400160209
017500160209      /end-free
