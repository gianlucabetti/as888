000100110803      //--------------------------------------------------------------
000200110805      //?TRTB371R - Interrogazione tabella "TM"
000300110803      //--------------------------------------------------------------
000400110803     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000500110803
000600110803      //---------------------------------------------------------------
000700110803      //?Dichiarazione file.
000800110803      //---------------------------------------------------------------
000900110803
001000110803      // - Tabelle
001100110805     fTABEL00F  if   e           k disk
001200110803
001300110803      // - Video
001400110805     fTRTB371D  cf   e             workstn
001500110803
001600110803      //---------------------------------------------------------------
001700110803      //?Definizione costanti.
001800110803      //---------------------------------------------------------------
001900110803
002000110803      //---------------------------------------------------------------
002100110803      //?Definizione schiere.
002200110803      //---------------------------------------------------------------
002300110803
002400110803      //---------------------------------------------------------------
002500110803      //?Definizione aree dati.
002600110803      //---------------------------------------------------------------
002700110803
002800110803      // - Dati utente
002900110803     d §AzUte        e ds                  extname(AZUTE00F)
003000110803     d                                     dtaara
003100110803     d §DatiUte      e ds                  extname(dDatiUte)
003200110803     d                                     dtaara
003300110803
003400110803      //---------------------------------------------------------------
003500110803      //?Definizione strutture dati.
003600110803      //---------------------------------------------------------------
003700110803
003800110803      // - Parametri ricevuti
003900110803     d KPJBA         e ds
004000110803     d TNTA61DS      e ds
004100110803
004200110803      // - Reperimento dati utente
004300110803     d TIBS34DS      e ds
004400110810
004500110810      // - Tabella 1A
004600110810     d ds1A          e ds                  inz
004700110803
004800110805      // - Tabella TM
004900110805     d dsTM          e ds                  inz
005000110810
005100110810      // - Sk x tipi incasso a video
005200141007     d dsV1Ctm         ds            18    inz
005300110810     d  V1Ctm1                             inz
005400110810     d  V1Ctm2                             inz
005500110810     d  V1Ctm3                             inz
005600110810     d  V1Ctm4                             inz
005700141006     d  V1Ctm5                             inz
005800141006     d  V1Ctm6                             inz
005900141007     d  V1Ctm7                             inz
006000141007     d  V1Ctm8                             inz
006100141007     d  V1Ctm9                             inz
006200141007     d   $V1Ctm                1     18    inz  dim(09)
006300110810
006400110810      // - Sk x descrizioni tipi incasso a video
006500141007     d dsV1Dtm         ds           225    inz
006600110810     d  V1Dtm1                             inz
006700110810     d  V1Dtm2                             inz
006800110810     d  V1Dtm3                             inz
006900110810     d  V1Dtm4                             inz
007000141006     d  V1Dtm5                             inz
007100141006     d  V1Dtm6                             inz
007200141007     d  V1Dtm7                             inz
007300141007     d  V1Dtm8                             inz
007400141007     d  V1Dtm9                             inz
007500141007     d   $V1Dtm                1    225    inz  dim(09)
007600110803
007700110803      //---------------------------------------------------------------
007800110803      //?Definizione variabili globali.
007900110803      //---------------------------------------------------------------
008000110803
008100110803      // - Flags booleani
008200110803     d $Fine           s               n   inz(*off)
008300110803     d $InzD01         s               n   inz(*on)
008400110805
008500110805      // - Campi di comodo
008600110805     d conta           s              2  0 inz
008700110803
008800110803      //---------------------------------------------------------------
008900110803      //?Definizione procedure esterne.
009000110803      //---------------------------------------------------------------
009100110803
009200110803      //---------------------------------------------------------------
009300110803      //?Prototipi.
009400110803      //---------------------------------------------------------------
009500110803
009600110803      /copy gaitrasrc/srcprotopr,tibs34r
009700110805      /copy gaitrasrc/srcprotopi,tibs69r
009800110803      /copy gaitrasrc/srcprotopr,tibs69r
009900110803
010000110803      //---------------------------------------------------------------
010100110803      //?Definizione key-list.
010200110803      //---------------------------------------------------------------
010300110803
010400110803      //---------------------------------------------------------------
010500110803      //?Riepilogo indicatori.
010600110803      //---------------------------------------------------------------
010700110803
010800110803      //---------------------------------------------------------------
010900110803
011000110803      //---------------------------------------------------------------
011100110803      //?M A I N - L I N E
011200110803      //---------------------------------------------------------------
011300110803
011400110803     c     *Entry        plist
011500110803     c                   parm                    KPJBA
011600110803     c                   parm                    TNTA61DS
011700110803
011800110803      /free
011900110803
012000110803       //?Operazioni iniziali
012100110803       exsr RoutInz;
012200110803
012300110803       //?Gestione video
012400110803       DOW $Fine = *off;
012500110803         exsr GesD01;
012600110803       ENDDO;
012700110803
012800110803       //?Operazioni finali
012900110803       exsr RoutEnd;
013000110803
013100110803       //--------------------------------------------------------------
013200110803       //?Operazioni iniziali.
013300110803       //--------------------------------------------------------------
013400110803       BEGSR RoutInz;
013500110803
013600110803         //?Reperimento dati job
013700110803         exsr DatiJob;
013800110805
013900110805         IF  TA61ksc <= *zeros;
014000110805           TA61err = *on;
014100110805           TA61msg = 'Richiesto il codice cliente';
014200110805           $Fine = *on;
014300110805           leavesr;
014400110805         ENDIF;
014500110803
014600110803       ENDSR;
014700110803
014800110803       //--------------------------------------------------------------
014900110803       //?Reperimento Dati del job (Utente/Operativi).
015000110803       //--------------------------------------------------------------
015100110803       BEGSR DatiJob;
015200110803
015300110803         in(E) §AzUte;
015400110803         if NOT %error;
015500110803           in(E) §DatiUte;
015600110803         endif;
015700110803         if %error or RSut = *blanks;
015800110803           clear TIBS34ds;
015900110803           tibs34r(tibs34ds);
016000110803           in §AzUte;
016100110803           in §DatiUte;
016200110803         endif;
016300110803
016400110803       ENDSR;
016500110803
016600110803       //--------------------------------------------------------------
016700110803       //?Gestione videata.
016800110803       //--------------------------------------------------------------
016900110803       BEGSR GesD01;
017000110803
017100110803         //?Iniziallizazione videata
017200110803         IF $InzD01 = *on;
017300110803           exsr InzD01;
017400110803           $InzD01 = *off;
017500110803         ENDIF;
017600110803
017700110803       //?Emissione videata
017800110805         exfmt TB37D01;
017900110803
018000110803       //?F12 = Ritorno
018100110803         IF  *inkl;
018200110803           $fine = *on ;
018300110803           leavesr ;
018400110803         ENDIF;
018500110803
018600110803       ENDSR;
018700110803
018800110803       //--------------------------------------------------------------
018900110803       //?Caricamento videata D01.
019000110803       //--------------------------------------------------------------
019100110803       BEGSR InzD01;
019200110803
019300110805         clear V1Dksc;
019400110810         clear dsV1Ctm;
019500110810         clear dsV1Dtm;
019600110805         clear V1Cforza;
019700110810         conta = 1;
019800110805
019900110805         clear  tibs69ds;
020000110805         I69kac = TA61ksc;
020100110805         TIBS69R (tibs69ds:ds_cnaco:ds_cnind:ds_cnclp:ds_fncls);
020200110805         V1Cksc = TA61ksc;
020300110805         V1Dksc = ACORag;
020400110805
020500110810         clear dsTM;
020600110805         TBLkut = 1;
020700110805         TBLcod = 'TM';
020800110805         TBLkey = %editc(V1Cksc:'X');
020900110803
021000110805         chain (TBLkut : TBLcod : TBLkey) TABEL00F;
021100110805         IF  %Found(TABEL00F) and TBLflg = *blanks;
021200110803
021300110805           dsTM = TBLuni;
021400110805         //?TM
021500110805           IF  §TMftm = 'S';
021600110810             $V1Ctm(conta) = 'TM';
021700110810             exsr decod;
021800110805             conta += 1;
021900110805           ENDIF;
022000110805         //?BB
022100110805           IF  §TMfbb = 'S';
022200110810             $V1Ctm(conta) = 'BB';
022300110810             exsr decod;
022400110805             conta += 1;
022500110805           ENDIF;
022600110805         //?BA
022700110805           IF  §TMfba = 'S';
022800110810             $V1Ctm(conta) = 'BA';
022900110810             exsr decod;
023000110805             conta += 1;
023100110805           ENDIF;
023200110805         //?CA
023300110805           IF  §TMfca = 'S';
023400110810             $V1Ctm(conta) = 'CA';
023500110810             exsr decod;
023600110805             conta += 1;
023700110805           ENDIF;
023800110805         //?BC
023900110805           IF  §TMfbc = 'S';
024000110810             $V1Ctm(conta) = 'BC';
024100110810             exsr decod;
024200110805             conta += 1;
024300110805           ENDIF;
024400110805         //?SC
024500110805           IF  §TMfsc = 'S';
024600110810             $V1Ctm(conta) = 'SC';
024700110810             exsr decod;
024800110805             conta += 1;
024900110805           ENDIF;
025000110805         //?TO
025100110805           IF  §TMfto = 'S';
025200110810             $V1Ctm(conta) = 'TO';
025300110810             exsr decod;
025400110805             conta += 1;
025500110805           ENDIF;
025600110805         //?S2
025700110810           IF  §TMfs2 = 'S';
025800110810             $V1Ctm(conta) = 'S2';
025900110810             exsr decod;
026000110805             conta += 1;
026100110805           ENDIF;
026200110805         //?BP
026300110805           IF  §TMfbp = 'S';
026400110810             $V1Ctm(conta) = 'BP';
026500110810             exsr decod;
026600110805             conta += 1;
026700110805           ENDIF;
026800150520         //?TP
026900150520           IF  §TMftp = 'S';
027000150520             $V1Ctm(conta) = 'TP';
027100150520             exsr decod;
027200150520             conta += 1;
027300150520           ENDIF;
027400110805
027500110805         //?Forzatura
027600110805           IF  §TMfti <> *blanks;
027700110810             V1Cforza =
027800110810             'Se Tipo incasso non indicato, in bolla viene forzato ' +
027900110810              §TMfti;
028000110805           ENDIF;
028100110805
028200110805         ENDIF;
028300110803
028400110803       ENDSR;
028500110810
028600110810       //--------------------------------------------------------------
028700110810       //?Decodifico tipo incasso da tabella 1A.
028800110810       //--------------------------------------------------------------
028900110810       BEGSR Decod;
029000110810
029100110810         clear ds1A;
029200110810         TBLcod = '1A';
029300110810         TBLkey = $V1Ctm(conta);
029400110810         chain (TBLkut : TBLcod : TBLkey) TABEL00F;
029500110810         IF  %Found(TABEL00F) and TBLflg = *blanks;
029600110810           ds1A = TBLuni;
029700110810         ENDIF;
029800110810         $V1Dtm(conta) = §1Ades;
029900110810
030000110810       ENDSR;
030100110803
030200110803       //--------------------------------------------------------------
030300110803       //?Operazioni finali.
030400110803       //--------------------------------------------------------------
030500110803       BEGSR RoutEnd;
030600110803
030700110803         *inLR = *on;
030800110803         return;
030900110803
031000110803       ENDSR;
