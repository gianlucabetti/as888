000100110803      //--------------------------------------------------------------
000200110805      //?TRTB371R - Interrogazione tabella "TM"
000300110803      //--------------------------------------------------------------
000400110803     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000500110803
000600110803      //---------------------------------------------------------------
000700110803      //?Dichiarazione file.
000800110803      //---------------------------------------------------------------
000900110803
001000110803      // - Tabelle
001100110805     fTABEL00F  if   e           k disk
001200110803
001300110803      // - Video
001400110805     fTRTB371D  cf   e             workstn
001500110803
001600110803      //---------------------------------------------------------------
001700110803      //?Definizione costanti.
001800110803      //---------------------------------------------------------------
001900110803
002000110803      //---------------------------------------------------------------
002100110803      //?Definizione schiere.
002200110803      //---------------------------------------------------------------
002300110803
002400110803      //---------------------------------------------------------------
002500110803      //?Definizione aree dati.
002600110803      //---------------------------------------------------------------
002700110803
002800110803      // - Dati utente
002900110803     d §AzUte        e ds                  extname(AZUTE00F)
003000110803     d                                     dtaara
003100110803     d §DatiUte      e ds                  extname(dDatiUte)
003200110803     d                                     dtaara
003300110803
003400110803      //---------------------------------------------------------------
003500110803      //?Definizione strutture dati.
003600110803      //---------------------------------------------------------------
003700110803
003800110803      // - Parametri ricevuti
003900110803     d KPJBA         e ds
004000110803     d TNTA61DS      e ds
004100110803
004200110803      // - Reperimento dati utente
004300110803     d TIBS34DS      e ds
004400110810
004500110810      // - Tabella 1A
004600110810     d ds1A          e ds                  inz
004700110803
004800110805      // - Tabella TM
004900110805     d dsTM          e ds                  inz
005000110810
005100110810      // - Sk x tipi incasso a video
005200110810     d dsV1Ctm         ds             8    inz
005300110810     d  V1Ctm1                             inz
005400110810     d  V1Ctm2                             inz
005500110810     d  V1Ctm3                             inz
005600110810     d  V1Ctm4                             inz
005700110810     d   $V1Ctm                1      8    inz  dim(04)
005800110810
005900110810      // - Sk x descrizioni tipi incasso a video
006000110810     d dsV1Dtm         ds           100    inz
006100110810     d  V1Dtm1                             inz
006200110810     d  V1Dtm2                             inz
006300110810     d  V1Dtm3                             inz
006400110810     d  V1Dtm4                             inz
006500110810     d   $V1Dtm                1    100    inz  dim(04)
006600110803
006700110803      //---------------------------------------------------------------
006800110803      //?Definizione variabili globali.
006900110803      //---------------------------------------------------------------
007000110803
007100110803      // - Flags booleani
007200110803     d $Fine           s               n   inz(*off)
007300110803     d $InzD01         s               n   inz(*on)
007400110805
007500110805      // - Campi di comodo
007600110805     d conta           s              2  0 inz
007700110803
007800110803      //---------------------------------------------------------------
007900110803      //?Definizione procedure esterne.
008000110803      //---------------------------------------------------------------
008100110803
008200110803      //---------------------------------------------------------------
008300110803      //?Prototipi.
008400110803      //---------------------------------------------------------------
008500110803
008600110803      /copy gaitrasrc/srcprotopr,tibs34r
008700110805      /copy gaitrasrc/srcprotopi,tibs69r
008800110803      /copy gaitrasrc/srcprotopr,tibs69r
008900110803
009000110803      //---------------------------------------------------------------
009100110803      //?Definizione key-list.
009200110803      //---------------------------------------------------------------
009300110803
009400110803      //---------------------------------------------------------------
009500110803      //?Riepilogo indicatori.
009600110803      //---------------------------------------------------------------
009700110803
009800110803      //---------------------------------------------------------------
009900110803
010000110803      //---------------------------------------------------------------
010100110803      //?M A I N - L I N E
010200110803      //---------------------------------------------------------------
010300110803
010400110803     c     *Entry        plist
010500110803     c                   parm                    KPJBA
010600110803     c                   parm                    TNTA61DS
010700110803
010800110803      /free
010900110803
011000110803       //?Operazioni iniziali
011100110803       exsr RoutInz;
011200110803
011300110803       //?Gestione video
011400110803       DOW $Fine = *off;
011500110803         exsr GesD01;
011600110803       ENDDO;
011700110803
011800110803       //?Operazioni finali
011900110803       exsr RoutEnd;
012000110803
012100110803       //--------------------------------------------------------------
012200110803       //?Operazioni iniziali.
012300110803       //--------------------------------------------------------------
012400110803       BEGSR RoutInz;
012500110803
012600110803         //?Reperimento dati job
012700110803         exsr DatiJob;
012800110805
012900110805         IF  TA61ksc <= *zeros;
013000110805           TA61err = *on;
013100110805           TA61msg = 'Richiesto il codice cliente';
013200110805           $Fine = *on;
013300110805           leavesr;
013400110805         ENDIF;
013500110803
013600110803       ENDSR;
013700110803
013800110803       //--------------------------------------------------------------
013900110803       //?Reperimento Dati del job (Utente/Operativi).
014000110803       //--------------------------------------------------------------
014100110803       BEGSR DatiJob;
014200110803
014300110803         in(E) §AzUte;
014400110803         if NOT %error;
014500110803           in(E) §DatiUte;
014600110803         endif;
014700110803         if %error or RSut = *blanks;
014800110803           clear TIBS34ds;
014900110803           tibs34r(tibs34ds);
015000110803           in §AzUte;
015100110803           in §DatiUte;
015200110803         endif;
015300110803
015400110803       ENDSR;
015500110803
015600110803       //--------------------------------------------------------------
015700110803       //?Gestione videata.
015800110803       //--------------------------------------------------------------
015900110803       BEGSR GesD01;
016000110803
016100110803         //?Iniziallizazione videata
016200110803         IF $InzD01 = *on;
016300110803           exsr InzD01;
016400110803           $InzD01 = *off;
016500110803         ENDIF;
016600110803
016700110803       //?Emissione videata
016800110805         exfmt TB37D01;
016900110803
017000110803       //?F12 = Ritorno
017100110803         IF  *inkl;
017200110803           $fine = *on ;
017300110803           leavesr ;
017400110803         ENDIF;
017500110803
017600110803       ENDSR;
017700110803
017800110803       //--------------------------------------------------------------
017900110803       //?Caricamento videata D01.
018000110803       //--------------------------------------------------------------
018100110803       BEGSR InzD01;
018200110803
018300110805         clear V1Dksc;
018400110810         clear dsV1Ctm;
018500110810         clear dsV1Dtm;
018600110805         clear V1Cforza;
018700110810         conta = 1;
018800110805
018900110805         clear  tibs69ds;
019000110805         I69kac = TA61ksc;
019100110805         TIBS69R (tibs69ds:ds_cnaco:ds_cnind:ds_cnclp:ds_fncls);
019200110805         V1Cksc = TA61ksc;
019300110805         V1Dksc = ACORag;
019400110805
019500110810         clear dsTM;
019600110805         TBLkut = 1;
019700110805         TBLcod = 'TM';
019800110805         TBLkey = %editc(V1Cksc:'X');
019900110803
020000110805         chain (TBLkut : TBLcod : TBLkey) TABEL00F;
020100110805         IF  %Found(TABEL00F) and TBLflg = *blanks;
020200110803
020300110805           dsTM = TBLuni;
020400110805         //?TM
020500110805           IF  §TMftm = 'S';
020600110810             $V1Ctm(conta) = 'TM';
020700110810             exsr decod;
020800110805             conta += 1;
020900110805           ENDIF;
021000110805         //?BB
021100110805           IF  §TMfbb = 'S';
021200110810             $V1Ctm(conta) = 'BB';
021300110810             exsr decod;
021400110805             conta += 1;
021500110805           ENDIF;
021600110805         //?BA
021700110805           IF  §TMfba = 'S';
021800110810             $V1Ctm(conta) = 'BA';
021900110810             exsr decod;
022000110805             conta += 1;
022100110805           ENDIF;
022200110805         //?CA
022300110805           IF  §TMfca = 'S';
022400110810             $V1Ctm(conta) = 'CA';
022500110810             exsr decod;
022600110805             conta += 1;
022700110805           ENDIF;
022800110805         //?BC
022900110805           IF  §TMfbc = 'S';
023000110810             $V1Ctm(conta) = 'BC';
023100110810             exsr decod;
023200110805             conta += 1;
023300110805           ENDIF;
023400110805         //?SC
023500110805           IF  §TMfsc = 'S';
023600110810             $V1Ctm(conta) = 'SC';
023700110810             exsr decod;
023800110805             conta += 1;
023900110805           ENDIF;
024000110805         //?TO
024100110805           IF  §TMfto = 'S';
024200110810             $V1Ctm(conta) = 'TO';
024300110810             exsr decod;
024400110805             conta += 1;
024500110805           ENDIF;
024600110805         //?S2
024700110810           IF  §TMfs2 = 'S';
024800110810             $V1Ctm(conta) = 'S2';
024900110810             exsr decod;
025000110805             conta += 1;
025100110805           ENDIF;
025200110805         //?BP
025300110805           IF  §TMfbp = 'S';
025400110810             $V1Ctm(conta) = 'BP';
025500110810             exsr decod;
025600110805             conta += 1;
025700110805           ENDIF;
025800110805
025900110805         //?Forzatura
026000110805           IF  §TMfti <> *blanks;
026100110810             V1Cforza =
026200110810             'Se Tipo incasso non indicato, in bolla viene forzato ' +
026300110810              §TMfti;
026400110805           ENDIF;
026500110805
026600110805         ENDIF;
026700110803
026800110803       ENDSR;
026900110810
027000110810       //--------------------------------------------------------------
027100110810       //?Decodifico tipo incasso da tabella 1A.
027200110810       //--------------------------------------------------------------
027300110810       BEGSR Decod;
027400110810
027500110810         clear ds1A;
027600110810         TBLcod = '1A';
027700110810         TBLkey = $V1Ctm(conta);
027800110810         chain (TBLkut : TBLcod : TBLkey) TABEL00F;
027900110810         IF  %Found(TABEL00F) and TBLflg = *blanks;
028000110810           ds1A = TBLuni;
028100110810         ENDIF;
028200110810         $V1Dtm(conta) = §1Ades;
028300110810
028400110810       ENDSR;
028500110803
028600110803       //--------------------------------------------------------------
028700110803       //?Operazioni finali.
028800110803       //--------------------------------------------------------------
028900110803       BEGSR RoutEnd;
029000110803
029100110803         *inLR = *on;
029200110803         return;
029300110803
029400110803       ENDSR;
