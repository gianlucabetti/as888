000100110803      //--------------------------------------------------------------
000200110805      //?TRTB371R - Interrogazione tabella "TM"
000300110803      //--------------------------------------------------------------
000400110803     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000500110803
000600110803      //---------------------------------------------------------------
000700110803      //?Dichiarazione file.
000800110803      //---------------------------------------------------------------
000900110803
001000110803      // - Tabelle
001100110805     fTABEL00F  if   e           k disk
001200110803
001300110803      // - Video
001400110805     fTRTB371D  cf   e             workstn
001500110803
001600110803      //---------------------------------------------------------------
001700110803      //?Definizione costanti.
001800110803      //---------------------------------------------------------------
001900110803
002000110803      //---------------------------------------------------------------
002100110803      //?Definizione schiere.
002200110803      //---------------------------------------------------------------
002300110803
002400110803      //---------------------------------------------------------------
002500110803      //?Definizione aree dati.
002600110803      //---------------------------------------------------------------
002700110803
002800110803      // - Dati utente
002900110803     d §AzUte        e ds                  extname(AZUTE00F)
003000110803     d                                     dtaara
003100110803     d §DatiUte      e ds                  extname(dDatiUte)
003200110803     d                                     dtaara
003300110803
003400110803      //---------------------------------------------------------------
003500110803      //?Definizione strutture dati.
003600110803      //---------------------------------------------------------------
003700110803
003800110803      // - Parametri ricevuti
003900110803     d KPJBA         e ds
004000110803     d TNTA61DS      e ds
004100110803
004200110803      // - Reperimento dati utente
004300110803     d TIBS34DS      e ds
004400110810
004500110810      // - Tabella 1A
004600110810     d ds1A          e ds                  inz
004700110803
004800110805      // - Tabella TM
004900110805     d dsTM          e ds                  inz
005000110810
005100110810      // - Sk x tipi incasso a video
005200141006     d dsV1Ctm         ds            12    inz
005300110810     d  V1Ctm1                             inz
005400110810     d  V1Ctm2                             inz
005500110810     d  V1Ctm3                             inz
005600110810     d  V1Ctm4                             inz
005700141006     d  V1Ctm5                             inz
005800141006     d  V1Ctm6                             inz
005900141006     d   $V1Ctm                1     12    inz  dim(06)
006000110810
006100110810      // - Sk x descrizioni tipi incasso a video
006200141006     d dsV1Dtm         ds           150    inz
006300110810     d  V1Dtm1                             inz
006400110810     d  V1Dtm2                             inz
006500110810     d  V1Dtm3                             inz
006600110810     d  V1Dtm4                             inz
006700141006     d  V1Dtm5                             inz
006800141006     d  V1Dtm6                             inz
006900141006     d   $V1Dtm                1    150    inz  dim(06)
007000110803
007100110803      //---------------------------------------------------------------
007200110803      //?Definizione variabili globali.
007300110803      //---------------------------------------------------------------
007400110803
007500110803      // - Flags booleani
007600110803     d $Fine           s               n   inz(*off)
007700110803     d $InzD01         s               n   inz(*on)
007800110805
007900110805      // - Campi di comodo
008000110805     d conta           s              2  0 inz
008100110803
008200110803      //---------------------------------------------------------------
008300110803      //?Definizione procedure esterne.
008400110803      //---------------------------------------------------------------
008500110803
008600110803      //---------------------------------------------------------------
008700110803      //?Prototipi.
008800110803      //---------------------------------------------------------------
008900110803
009000110803      /copy gaitrasrc/srcprotopr,tibs34r
009100110805      /copy gaitrasrc/srcprotopi,tibs69r
009200110803      /copy gaitrasrc/srcprotopr,tibs69r
009300110803
009400110803      //---------------------------------------------------------------
009500110803      //?Definizione key-list.
009600110803      //---------------------------------------------------------------
009700110803
009800110803      //---------------------------------------------------------------
009900110803      //?Riepilogo indicatori.
010000110803      //---------------------------------------------------------------
010100110803
010200110803      //---------------------------------------------------------------
010300110803
010400110803      //---------------------------------------------------------------
010500110803      //?M A I N - L I N E
010600110803      //---------------------------------------------------------------
010700110803
010800110803     c     *Entry        plist
010900110803     c                   parm                    KPJBA
011000110803     c                   parm                    TNTA61DS
011100110803
011200110803      /free
011300110803
011400110803       //?Operazioni iniziali
011500110803       exsr RoutInz;
011600110803
011700110803       //?Gestione video
011800110803       DOW $Fine = *off;
011900110803         exsr GesD01;
012000110803       ENDDO;
012100110803
012200110803       //?Operazioni finali
012300110803       exsr RoutEnd;
012400110803
012500110803       //--------------------------------------------------------------
012600110803       //?Operazioni iniziali.
012700110803       //--------------------------------------------------------------
012800110803       BEGSR RoutInz;
012900110803
013000110803         //?Reperimento dati job
013100110803         exsr DatiJob;
013200110805
013300110805         IF  TA61ksc <= *zeros;
013400110805           TA61err = *on;
013500110805           TA61msg = 'Richiesto il codice cliente';
013600110805           $Fine = *on;
013700110805           leavesr;
013800110805         ENDIF;
013900110803
014000110803       ENDSR;
014100110803
014200110803       //--------------------------------------------------------------
014300110803       //?Reperimento Dati del job (Utente/Operativi).
014400110803       //--------------------------------------------------------------
014500110803       BEGSR DatiJob;
014600110803
014700110803         in(E) §AzUte;
014800110803         if NOT %error;
014900110803           in(E) §DatiUte;
015000110803         endif;
015100110803         if %error or RSut = *blanks;
015200110803           clear TIBS34ds;
015300110803           tibs34r(tibs34ds);
015400110803           in §AzUte;
015500110803           in §DatiUte;
015600110803         endif;
015700110803
015800110803       ENDSR;
015900110803
016000110803       //--------------------------------------------------------------
016100110803       //?Gestione videata.
016200110803       //--------------------------------------------------------------
016300110803       BEGSR GesD01;
016400110803
016500110803         //?Iniziallizazione videata
016600110803         IF $InzD01 = *on;
016700110803           exsr InzD01;
016800110803           $InzD01 = *off;
016900110803         ENDIF;
017000110803
017100110803       //?Emissione videata
017200110805         exfmt TB37D01;
017300110803
017400110803       //?F12 = Ritorno
017500110803         IF  *inkl;
017600110803           $fine = *on ;
017700110803           leavesr ;
017800110803         ENDIF;
017900110803
018000110803       ENDSR;
018100110803
018200110803       //--------------------------------------------------------------
018300110803       //?Caricamento videata D01.
018400110803       //--------------------------------------------------------------
018500110803       BEGSR InzD01;
018600110803
018700110805         clear V1Dksc;
018800110810         clear dsV1Ctm;
018900110810         clear dsV1Dtm;
019000110805         clear V1Cforza;
019100110810         conta = 1;
019200110805
019300110805         clear  tibs69ds;
019400110805         I69kac = TA61ksc;
019500110805         TIBS69R (tibs69ds:ds_cnaco:ds_cnind:ds_cnclp:ds_fncls);
019600110805         V1Cksc = TA61ksc;
019700110805         V1Dksc = ACORag;
019800110805
019900110810         clear dsTM;
020000110805         TBLkut = 1;
020100110805         TBLcod = 'TM';
020200110805         TBLkey = %editc(V1Cksc:'X');
020300110803
020400110805         chain (TBLkut : TBLcod : TBLkey) TABEL00F;
020500110805         IF  %Found(TABEL00F) and TBLflg = *blanks;
020600110803
020700110805           dsTM = TBLuni;
020800110805         //?TM
020900110805           IF  §TMftm = 'S';
021000110810             $V1Ctm(conta) = 'TM';
021100110810             exsr decod;
021200110805             conta += 1;
021300110805           ENDIF;
021400110805         //?BB
021500110805           IF  §TMfbb = 'S';
021600110810             $V1Ctm(conta) = 'BB';
021700110810             exsr decod;
021800110805             conta += 1;
021900110805           ENDIF;
022000110805         //?BA
022100110805           IF  §TMfba = 'S';
022200110810             $V1Ctm(conta) = 'BA';
022300110810             exsr decod;
022400110805             conta += 1;
022500110805           ENDIF;
022600110805         //?CA
022700110805           IF  §TMfca = 'S';
022800110810             $V1Ctm(conta) = 'CA';
022900110810             exsr decod;
023000110805             conta += 1;
023100110805           ENDIF;
023200110805         //?BC
023300110805           IF  §TMfbc = 'S';
023400110810             $V1Ctm(conta) = 'BC';
023500110810             exsr decod;
023600110805             conta += 1;
023700110805           ENDIF;
023800110805         //?SC
023900110805           IF  §TMfsc = 'S';
024000110810             $V1Ctm(conta) = 'SC';
024100110810             exsr decod;
024200110805             conta += 1;
024300110805           ENDIF;
024400110805         //?TO
024500110805           IF  §TMfto = 'S';
024600110810             $V1Ctm(conta) = 'TO';
024700110810             exsr decod;
024800110805             conta += 1;
024900110805           ENDIF;
025000110805         //?S2
025100110810           IF  §TMfs2 = 'S';
025200110810             $V1Ctm(conta) = 'S2';
025300110810             exsr decod;
025400110805             conta += 1;
025500110805           ENDIF;
025600110805         //?BP
025700110805           IF  §TMfbp = 'S';
025800110810             $V1Ctm(conta) = 'BP';
025900110810             exsr decod;
026000110805             conta += 1;
026100110805           ENDIF;
026200110805
026300110805         //?Forzatura
026400110805           IF  §TMfti <> *blanks;
026500110810             V1Cforza =
026600110810             'Se Tipo incasso non indicato, in bolla viene forzato ' +
026700110810              §TMfti;
026800110805           ENDIF;
026900110805
027000110805         ENDIF;
027100110803
027200110803       ENDSR;
027300110810
027400110810       //--------------------------------------------------------------
027500110810       //?Decodifico tipo incasso da tabella 1A.
027600110810       //--------------------------------------------------------------
027700110810       BEGSR Decod;
027800110810
027900110810         clear ds1A;
028000110810         TBLcod = '1A';
028100110810         TBLkey = $V1Ctm(conta);
028200110810         chain (TBLkut : TBLcod : TBLkey) TABEL00F;
028300110810         IF  %Found(TABEL00F) and TBLflg = *blanks;
028400110810           ds1A = TBLuni;
028500110810         ENDIF;
028600110810         $V1Dtm(conta) = §1Ades;
028700110810
028800110810       ENDSR;
028900110803
029000110803       //--------------------------------------------------------------
029100110803       //?Operazioni finali.
029200110803       //--------------------------------------------------------------
029300110803       BEGSR RoutEnd;
029400110803
029500110803         *inLR = *on;
029600110803         return;
029700110803
029800110803       ENDSR;
