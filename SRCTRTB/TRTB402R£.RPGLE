000100110803      //--------------------------------------------------------------
000200110811      //?TRTB402R - Interrogazione tabella 3K - VAG
000300110803      //--------------------------------------------------------------
000400110803     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000500110803
000600110803      //---------------------------------------------------------------
000700110803      //?Dichiarazione file.
000800110803      //---------------------------------------------------------------
000900110803
001000110803      // - Tabelle
001100110810     fTABEL00F  if   e           k disk
001200110803
001300110803      // - Video
001400110811     fTRTB402D  cf   e             workstn
001500110803
001600110803      //---------------------------------------------------------------
001700110803      //?Definizione costanti.
001800110803      //---------------------------------------------------------------
001900110803
002000110803      //---------------------------------------------------------------
002100110803      //?Definizione schiere.
002200110803      //---------------------------------------------------------------
002300110803
002400110803      //---------------------------------------------------------------
002500110803      //?Definizione aree dati.
002600110803      //---------------------------------------------------------------
002700110803
002800110803      // - Dati utente
002900110803     d §AzUte        e ds                  extname(AZUTE00F)
003000110803     d                                     dtaara
003100110803     d §DatiUte      e ds                  extname(dDatiUte)
003200110803     d                                     dtaara
003300110803
003400110803      //---------------------------------------------------------------
003500110803      //?Definizione strutture dati.
003600110803      //---------------------------------------------------------------
003700110803
003800110803      // - Parametri ricevuti
003900110803     d KPJBA         e ds
004000110803     d TNTA61DS      e ds
004100110803
004200110803      // - Reperimento dati utente
004300110803     d TIBS34DS      e ds
004400110803
004500110811      // - Tabella 3K
004600110811     d ds3K          e ds                  inz
004700110803
004800110803      //---------------------------------------------------------------
004900110803      //?Definizione variabili globali.
005000110803      //---------------------------------------------------------------
005100110803
005200110803      // - Flags booleani
005300110803     d $Fine           s               n   inz(*off)
005400110803     d $InzD01         s               n   inz(*on)
005500110803
005600110803      //---------------------------------------------------------------
005700110803      //?Definizione procedure esterne.
005800110803      //---------------------------------------------------------------
005900110803
006000110803      //---------------------------------------------------------------
006100110803      //?Prototipi.
006200110803      //---------------------------------------------------------------
006300110803
006400110803      /copy gaitrasrc/srcprotopr,tibs34r
006500110810      /copy gaitrasrc/srcprotopi,tibs69r
006600110810      /copy gaitrasrc/srcprotopr,tibs69r
006700110803
006800110803      //---------------------------------------------------------------
006900110803      //?Definizione key-list.
007000110803      //---------------------------------------------------------------
007100110803
007200110803      //---------------------------------------------------------------
007300110803      //?Riepilogo indicatori.
007400110803      //---------------------------------------------------------------
007500110803
007600110803      //---------------------------------------------------------------
007700110803
007800110803      //---------------------------------------------------------------
007900110803      //?M A I N - L I N E
008000110803      //---------------------------------------------------------------
008100110803
008200110803     c     *Entry        plist
008300110803     c                   parm                    KPJBA
008400110803     c                   parm                    TNTA61DS
008500110803
008600110803      /free
008700110803
008800110803       //?Operazioni iniziali
008900110803       exsr RoutInz;
009000110803
009100110803       //?Gestione video
009200110803       DOW $Fine = *off;
009300110803         exsr GesD01;
009400110803       ENDDO;
009500110803
009600110803       //?Operazioni finali
009700110803       exsr RoutEnd;
009800110803
009900110803       //--------------------------------------------------------------
010000110803       //?Operazioni iniziali.
010100110803       //--------------------------------------------------------------
010200110803       BEGSR RoutInz;
010300110803
010400110803         //?Reperimento dati job
010500110803         exsr DatiJob;
010600110805
010700110805         IF  TA61ksc <= *zeros;
010800110805           TA61err = *on;
010900110805           TA61msg = 'Richiesto il codice cliente';
011000110805           $Fine = *on;
011100110805         ENDIF;
011200110803
011300110803       ENDSR;
011400110803
011500110803       //--------------------------------------------------------------
011600110803       //?Reperimento Dati del job (Utente/Operativi).
011700110803       //--------------------------------------------------------------
011800110803       BEGSR DatiJob;
011900110803
012000110803         in(E) §AzUte;
012100110803         if NOT %error;
012200110803           in(E) §DatiUte;
012300110803         endif;
012400110803         if %error or RSut = *blanks;
012500110803           clear TIBS34ds;
012600110803           tibs34r(tibs34ds);
012700110803           in §AzUte;
012800110803           in §DatiUte;
012900110803         endif;
013000110803
013100110803       ENDSR;
013200110803
013300110803       //--------------------------------------------------------------
013400110803       //?Gestione videata.
013500110803       //--------------------------------------------------------------
013600110803       BEGSR GesD01;
013700110803
013800110803         //?Iniziallizazione videata
013900110803         IF $InzD01 = *on;
014000110803           exsr InzD01;
014100110803           $InzD01 = *off;
014200110803         ENDIF;
014300110803
014400110803       //?Emissione videata
014500110811         exfmt TB40D01;
014600110803
014700110803       //?F12 = Ritorno
014800110803         IF  *inkl;
014900110803           $fine = *on ;
015000110803           leavesr ;
015100110803         ENDIF;
015200110803
015300110803       ENDSR;
015400110803
015500110803       //--------------------------------------------------------------
015600110803       //?Caricamento videata D01.
015700110803       //--------------------------------------------------------------
015800110803       BEGSR InzD01;
015900110803
016000110810         clear V1Dksc;
016100110810         clear V1Dksu;
016200110812         clear V1Ccq6;
016300110812         clear V1Ccq7;
016400110812         clear V1Cnmc;
016500110812         clear V1Cgqi;
016600110812         clear V1Capp;
016700110810
016800110810       //?Decodifico il cliente
016900110810         clear  tibs69ds;
017000110810         I69kac = TA61ksc;
017100110810         TIBS69R (tibs69ds:ds_cnaco:ds_cnind:ds_cnclp:ds_fncls);
017200110810         V1Cksc = TA61ksc;
017300110811         IF  O69err = *blanks;
017400110811           V1Dksc = ACORag;
017500110811         ELSE;
017600110811           V1Dksc = '? ? ? ? ? ?';
017700110811         ENDIF;
017800110810
017900110810       //?Aggancio la tabella
018000110811         clear ds3K;
018100110810         TBLkut = 1;
018200110811         TBLcod = '3K';
018300110810         TBLkey = %editc(V1Cksc:'X');
018400110810
018500110810         chain (TBLkut : TBLcod : TBLkey) TABEL00F;
018600110810         IF  %Found(TABEL00F) and TBLflg = *blanks;
018700110811
018800110811         ds3K = TBLuni;
018900110811
019000110811         //?Se presente decodifico l'unificante giac.
019100110811           IF  §3Kgks <> 0;
019200110811             clear  tibs69ds;
019300110811             I69kac = §3Kgks;
019400110811             TIBS69R (tibs69ds:ds_cnaco:ds_cnind:ds_cnclp:ds_fncls);
019500110811             V1Cksu = §3Kgks;
019600110811             IF  O69err = *blanks;
019700110811               V1Dksu = ACORag;
019800110811             ELSE;
019900110811               V1Dksu = '? ? ? ? ? ?';
020000110811             ENDIF;
020100110811           ELSE;
020200110811             clear V1Cksu;
020300110811           ENDIF;
020400110810
020500110811         //?Se presente decodifico l'unificante cons.
020600110811           IF  §3Kcks <> 0;
020700110810             clear  tibs69ds;
020800110811             I69kac = §3Kcks;
020900110810             TIBS69R (tibs69ds:ds_cnaco:ds_cnind:ds_cnclp:ds_fncls);
021000110811             V1Cksu = §3Kcks;
021100110811             IF  O69err = *blanks;
021200110811               V1Dksu = ACORag;
021300110811             ELSE;
021400110811               V1Dksu = '? ? ? ? ? ?';
021500110811             ENDIF;
021600110810           ELSE;
021700110810             clear V1Cksu;
021800110810           ENDIF;
021900110810
022000110811         //?Flag
022100110812           IF  §3Kcq6 = 'S';
022200110812             V1Ccq6 = 'SI';
022300110914           ELSE;
022400110914             V1Ccq6 = 'NO';
022500110812           ENDIF;
022600110812           IF  §3Kcq7 = 'S';
022700110812             V1Ccq7 = 'SI';
022800110914           ELSE;
022900110914             V1Ccq7 = 'NO';
023000110812           ENDIF;
023100110812           IF  §3Knmc = 'S';
023200110812             V1Cnmc = 'SI';
023300110914           ELSE;
023400110914             V1Cnmc = 'NO';
023500110812           ENDIF;
023600110812           SELECT;
023700110812             WHEN  §3Kgqi = 'A';
023800110812               V1cgqi = 'Aperte';
023900110812             WHEN  §3Kgqi = 'C';
024000110812               V1cgqi = 'Chiuse';
024100110812             WHEN  §3Kgqi = 'E';
024200110812               V1cgqi = 'Aperte/Chiuse';
024300110812           ENDSL;
024400110812           IF  §3Kapp = 'S';
024500110812             V1Capp = 'SI';
024600110914           ELSE;
024700110914             V1Capp = 'NO';
024800110812           ENDIF;
024900110810
025000110810         ENDIF;
025100110803
025200110803       ENDSR;
025300110803
025400110803       //--------------------------------------------------------------
025500110803       //?Operazioni finali.
025600110803       //--------------------------------------------------------------
025700110803       BEGSR RoutEnd;
025800110803
025900110803         *inLR = *on;
026000110803         return;
026100110803
026200110803       ENDSR;
