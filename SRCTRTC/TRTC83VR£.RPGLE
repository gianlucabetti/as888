000100960530      ***********************************************************************
000200120828      *                                                                     *
000300120828      *   ?   - ESPORTA SU TIVGD - quanto caricato in QTEMP/EDIFCSUM    ?   *
000400120828      *                                                                     *
000500960530      ***********************************************************************
000600120823     H DECEDIT('0,') DATEDIT(*YMD/)
000700000207      *---------------------------------------------------------------------*
000800120822     FEDIFCSUM  IF   E           K DISK
000900120822      **?__________________________________________________________________ */
001000120822     ftivgd00f  if a E             DISK    commit
001100120822     Ftivir02L  IF   E           K DISK
001200120822     Ftis7prgf  uf   e             disk    RENAME(tis7prgf:tis7prg0)
001300120822     F                                     PREFIX(f_) usropn
001400120822      **?__________________________________________________________________ */
001500120822     D TipoF           C                   CONST('EU')
001600120822     D dwlprg          s             10    INZ(*all'0')
001700120822     D wrkprg          s              8  0 INZ(*zeros)
001800120822     d trul47ds      e ds
001900120822     D W0140           S             14  0 inz
002000120822     D Progressivo     S             10    inz
002100120822      *---------------------------------------------------------------------*
002200120822     D Var_ISV         s                   like(Virfi1)
002300120822      *---------------------------------------------------------------------*
002400120822     D TRTC82DS      E DS
002500120822     D KPJBA         E DS
002600120822     D WLBDA8          DS                  INZ
002700120822     D  G02DAT                 1      8  0
002800120822     D  G02INV                 9     16  0
002900120822     D  G02ERR                17     17
003000120822     D  G02TGI                18     22  0
003100120822      **?__________________________________________________________________ */
003200120822     IRRIFCSUM
003300120822     I              RRIFCSUM                    SUMDAT
003400020222     C*---------------------------------------------------------------------*
003500960530     C* Ciclo principale                                                   -*
003600960530     C*---------------------------------------------------------------------*
003700010426     C     *ENTRY        PLIST
003800010426     C                   PARM                    KPJBA
003900120822     C                   eval       TRTC82DS = kpjbu
004000120822     C*
004100120822      * apre
004200120822      *   il TIVGD
004300120822     C                   EXSR      vgd_OPEN
004400010426     C*
004500120822      * Legge e scrive il TIVGD
004600120822     C                   READ      EDIFCSUM
004700020219      *
004800120822    3C                   dow       not %EoF(EDIFCSUM)
004900020219      * ------------
005000120822     c                   exsr      VGD_WRITE
005100120822      * ------------
005200120822     C                   READ      EDIFCSUM
005300120822    3C                   ENDdo
005400120822      * quindi chiude
005500120822      *   il TIVGD
005600120822     C                   EXSR      vgd_CLOSE
005700120822      *
005800120823     c                   COMMIT
005900120823      *
006000120823     C                   SETON                                        LR
006100950428     C*****************************************************************
006200950428     C* OPERAZIONI INIZIALI
006300950428     C*****************************************************************
006400950428     C     *INZSR        BEGSR
006500010426     C*
006600120822     c     kvir02        klist
006700120822     C                   kfld                    virKSC
006800120822     C                   kfld                    virTIP
006900120822      *
007000020227      *------------
007100020220     C* Inizializzo variabili totale
007200960530     C* Imposto data del giorno
007300960530     C                   TIME                    W0140            14 0
007400120822     C                   TIME                    ORADAT           14 0
007500120822     C                   MOVEL     ORADAT        ORATR             6 0
007600120822     c                   move      *date         udtymd            8 0
007700960530     C*
007800960530     C                   ENDSR
007900120822      **?__________________________________________________________________ */
008000120822      *    Apertura del TIVGD
008100120822      **?__________________________________________________________________ */
008200120822     C     VGD_OPEN      Begsr
008300120822      *
008400120822      *  recupera il progressivo
008500120822     c                   exsr      Piglia_progr
008600120822      *
008700120822      *  istruzioni apertura blocco scrittura TIVGD    Edi Standard
008800120822     C                   clear                   trul47ds
008900120822     C                   eval      d47opz  = 'I'
009000120822     C                   eval      d47tip  = TipoF
009100120822     C                   eval      d47lck  = 'N'
009200120822     C                   eval      d47chkj = 'N'
009300120823     C                   eval      d47pgm  = 'TRTC83R2V'
009400120822     C                   call      'TRUL47R'
009500120822     C                   parm                    trul47ds
009600120822      *
009700120822     c                   endsr
009800120822      **?__________________________________________________________________ */
009900120822      *   Scrittura del TIVGD
010000120822      **?__________________________________________________________________ */
010100120822     C     VGD_WRITE     Begsr
010200120822      *
010300120822     c                   clear                   tivgd000
010400120822     c                   eval      vgddta = %TrimR(SumDAT)
010500120822     c                   eval      vgdtip = TipoF
010600120822     c                   move      *all'0'       cliente           8
010700120822     c                   move      D82CPT        cliente
010800120822     c                   eval      vgdksu = cliente
010900120822     C                   eval      vgdprg = Progressivo
011000120822     c                   eval      vgdtsc = 'WW'
011100120823     c                   eval      vgdpgm = 'TRTC83R2V'
011200120822     c                   eval      vgddat = udtymd
011300120822      *
011400120822     C                   WRITE     tivgd000
011500120822      *
011600120822     c                   endsr
011700120822      **?__________________________________________________________________ */
011800120822      *    Chiusura del TIVGD
011900120822      **?__________________________________________________________________ */
012000120822     C     VGD_CLOSE     Begsr
012100120822      *
012200120822     C* Infine elimino il blocco elaborazione TIVGD    Edi Standard
012300120822     C                   clear                   trul47ds
012400120822     C                   eval      d47opz  = 'F'
012500120822     C                   eval      d47tip  = TipoF
012600120822     C                   call      'TRUL47R'
012700120822     C                   parm                    trul47ds
012800120822      *
012900120822     c                   endsr
013000120822      **?__________________________________________________________________ */
013100120822      *   Prende il Progressivo
013200120822      **?__________________________________________________________________ */
013300120822     C     Piglia_progr  Begsr
013400120822      *
013500120822     c                   move      *all'0'       cliente           8
013600120822     c                   move      D82CPT        cliente
013700120822     C                   MOVE      Cliente       virKSC
013800120822     C                   MOVEL     TipoF         virTIP
013900120822     c     kvir02        chain     tivir02l
014000120822     c                   move      'OF'          Var_ISV
014100120822     c                   if        %Found(tivir02l)
014200120822     c                   move      VirFI1        Var_ISV
014300120822     C                   End
014400120822
014500120822      *       prende numeratore strategi
014600120822     C                   exsr      calprog
014700120822      *
014800120822     c                   endsr
014900120822     C*------------------------------------------------------*
015000120822     C*  prepara il file
015100120822     C*------------------------------------------------------*
015200120822     C     calprog       begsr
015300120822     C*
015400120822     C                   open      tis7prgf
015500120822     C                   read(e)   tis7prgf
015600120822     C*
015700120822     C                   if        not %error
015800120822     C                   eval      dwlprg = f_tis7prgf
015900120822     C*
016000120822     C                   move(p)   dwlprg        wrkprg
016100120822     C                   add       1             wrkprg
016200120822     C                   move(p)   wrkprg        dwlprg
016300120822     C                   movel     Var_ISV       dwlprg
016400120822     C*
016500120822     C                   eval       f_tis7prgf = dwlprg
016600120822     C                   eval      Progressivo = dwlprg
016700120822     C*
016800120822     C                   update    tis7prg0
016900120822     C                   endif
017000120822     C*
017100120822     C                   close     tis7prgf
017200120822     C*
017300120822     C                   endsr
017400120822      **?__________________________________________________________________ */
