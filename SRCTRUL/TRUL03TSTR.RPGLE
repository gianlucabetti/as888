000100131108       //==============================================================
000200131108       //?TEST - DETERMINAZIONE NOME DELL'IMMAGINE PER TILAC           ?
000300131108       //==============================================================
000400131108
000500131108       //--------------------------------------------------------------
000600131108       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700131108       //--------------------------------------------------------------
000800131108
000900131108     /*PRM dbgview(*source)
001000131108     /*END
001100131108
001200131108       //--------------------------------------------------------------
001300131108       //?Specifiche di controllo.                                     ?
001400131108       //--------------------------------------------------------------
001500131108
001600131108     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001700131108
001800131108       //--------------------------------------------------------------
001900131108       //?Dichiarazione file.                                          ?
002000131108       //--------------------------------------------------------------
002100131108
002200131108       // -?Video?
002300131108     fTRUL03TSTDcf   e             workstn
002400131108     f                                     indds(IndDspF)
002500131108     f                                     infds(InfDspF)
002600131108
002700131108       //--------------------------------------------------------------
002800131108       //?Definizione costanti.                                        ?
002900131108       //--------------------------------------------------------------
003000131108
003100131108       // -?Costante per controllo "caratteri solo numerici"?
003200131108     d c_Digits        c                   const('0123456789')
003300131108
003400131108       // -?Tasti funzionali a video?
003500131108     d c_F01           c                   const(x'31')
003600131108     d c_F02           c                   const(x'32')
003700131108     d c_F03           c                   const(x'33')
003800131108     d c_F04           c                   const(x'34')
003900131108     d c_F05           c                   const(x'35')
004000131108     d c_F06           c                   const(x'36')
004100131108     d c_F07           c                   const(x'37')
004200131108     d c_F08           c                   const(x'38')
004300131108     d c_F09           c                   const(x'39')
004400131108     d c_F10           c                   const(x'3A')
004500131108     d c_F11           c                   const(x'3B')
004600131108     d c_F12           c                   const(x'3C')
004700131108     d c_F13           c                   const(x'B1')
004800131108     d c_F14           c                   const(x'B2')
004900131108     d c_F15           c                   const(x'B3')
005000131108     d c_F16           c                   const(x'B4')
005100131108     d c_F17           c                   const(x'B5')
005200131108     d c_F18           c                   const(x'B6')
005300131108     d c_F19           c                   const(x'B7')
005400131108     d c_F20           c                   const(x'B8')
005500131108     d c_F21           c                   const(x'B9')
005600131108     d c_F22           c                   const(x'BA')
005700131108     d c_F23           c                   const(x'BB')
005800131108     d c_F24           c                   const(x'BC')
005900131108     d c_Enter         c                   const(x'F1')
006000131108     d c_RollDown      c                   const(x'F4')
006100131108     d c_RollUp        c                   const(x'F5')
006200131108
006300131108       //--------------------------------------------------------------
006400131108       //?Definizione schiere.                                         ?
006500131108       //--------------------------------------------------------------
006600131108
006700131108
006800131108       //--------------------------------------------------------------
006900131108       //?Definizione aree dati.                                       ?
007000131108       //--------------------------------------------------------------
007100131108
007200131108       // -?Dati utente?
007300131108     d §AzUte        e ds                  extname(AZUTE00F)
007400131108     d                                     dtaara
007500131108     d §DatiUte      e ds                  extname(dDatiUte)
007600131108     d                                     dtaara
007700131108
007800131108       //--------------------------------------------------------------
007900131108       //?Definizione strutture dati.                                  ?
008000131108       //--------------------------------------------------------------
008100131108
008200131108       // -?Status ds?
008300131108     d Status         sds
008400131108     d  SDSpgm           *proc
008500131108     d  SDSprm           *parms
008600131108     d  SDSusr               254    263
008700131108
008800131108       // -?InfDS?
008900131108     d InfDspF         ds
009000131108     d  dsp_aid              369    369a
009100131108
009200131108       // -?Indicatori su DspF?
009300131108     d IndDspF         ds
009400131108         // -?Abilitazione tasti funzionali?
009500131108     d   F6Attivo                      n   overlay(IndDspF : 06)
009600131108     d   F12Attivo                     n   overlay(IndDspF : 12)
009700131108         // -?Emissione messaggio di errore?
009800131108     d   ErrMessage                    n   overlay(IndDspF : 28)
009900131108         // -?Riemissione videata?
010000131108     d   ErrGenerico                   n   overlay(IndDspF : 99)
010100131108
010200131108       // -?kpjba?
010300131108     d KPJBA         e ds                  qualified  inz
010400131108
010500131108       //--------------------------------------------------------------
010600131108       //?Definizione variabili globali.                               ?
010700131108       //--------------------------------------------------------------
010800131108
010900131108       // -?Flags booleani?
011000131108     d $Fine           s               n   inz(*off)
011100131108     d $InzD01         s               n   inz(*on)
011200131108
011300131108       //--------------------------------------------------------------
011400131108       //?Definizione procedure usate.                                 ?
011500131108       //--------------------------------------------------------------
011600131108
011700131108       // -?Reperimento dati utente?
011800131108     d TIBS34ds      e ds                  qualified
011900131108      /copy gaitrasrc/srcProtoPR,TIBS34R
012000131108
012100131108       // -?Determinazione nome dell'immagine per TILAC?
012200131108     d TRUL03ds      e ds                  inz
012300131108     d trul03r         pr                  extpgm('TRUL03R')
012400131108     d   trul03ds...
012500131108     d                                     likeds(trul03ds)
012600131108
012700131108       //--------------------------------------------------------------
012800131108       //?Definizione key-list.                                        ?
012900131108       //--------------------------------------------------------------
013000131108
013100131108
013200131108       //--------------------------------------------------------------
013300131108       //?Riepilogo indicatori.                                        ?
013400131108       //--------------------------------------------------------------
013500131108
013600131108
013700131108       //--------------------------------------------------------------
013800131108       //?M A I N - L I N E                                            ?
013900131108       //--------------------------------------------------------------
014000131108
014100131108      /free
014200131108
014300131108       // -?Start?
014400131108       *inLR = *on;
014500131108
014600131108       // -?Elab?
014700131108       dow  $Fine = *off;
014800131108         exsr  sr_GesD01;
014900131108       enddo;
015000131108
015100131108       // -?End?
015200131108       return;
015300131108
015400131108       //--------------------------------------------------------------
015500131108       //?Operazioni iniziali.                                         ?
015600131108       //--------------------------------------------------------------
015700131108       BEGSR  *InzSR;
015800131108
015900131108         // -?Reperimento dati job?
016000131108         exsr  sr_DatiJob;
016100131108
016200131108         // -?Impostazione nome programma a video?
016300131108         //VTDpgm = SDSpgm;
016400131108
016500131108       ENDSR;
016600131108
016700131108       //--------------------------------------------------------------
016800131108       //?Reperimento Dati del job (Utente/Operativi).                 ?
016900131108       //--------------------------------------------------------------
017000131108       BEGSR  sr_DatiJob;
017100131108
017200131108         in(E) §AzUte;
017300131108         if NOT %error;
017400131108           in(E) §DatiUte;
017500131108         endif;
017600131108         if %error or RSut = *blanks;
017700131108           clear TIBS34ds;
017800131108           tibs34r(tibs34ds);
017900131108           in §AzUte;
018000131108           in §DatiUte;
018100131108         endif;
018200131108
018300131108       ENDSR;
018400131108
018500131108       //--------------------------------------------------------------
018600131108       //?Gestione videata D01                                         ?
018700131108       //--------------------------------------------------------------
018800131108       BEGSR  sr_GesD01;
018900131108
019000131108         // -?Inizializzazione videata?
019100131108         if  $InzD01 = *on;
019200131108           clear  ul03d1;
019300131108           $InzD01  = *off;
019400131108         endif;
019500131108
019600131108         F6Attivo  = *on;
019700131108         F12Attivo = *off;
019800131108
019900131108         // -?Emissione videata?
020000131108         if  ErrMessage = *off;
020100131108           write  ul03t1;
020200131108           write  ul03z1;
020300131108         endif;
020400131108         exfmt  ul03d1;
020500131108
020600131108         reset  ErrGenerico;
020700131108         reset  ErrMessage;
020800131108         clear  V1Dmsg;
020900131108
021000131108         SELECT;
021100131108
021200131108           // -?F3=Fine?
021300131108           WHEN  dsp_aid = c_F03;
021400131108             $Fine = *on;
021500131108
021600131108           // -?F6=Conferma?
021700131108           WHEN  dsp_aid = c_F06;
021800131108             exsr   sr_CallTRUL03;
021900131108             reset  $InzD01;
022000131108             clear  ErrGenerico;
022100131108             clear  ErrMessage;
022200131108             clear  V1Dmsg;
022300131108
022400131108         ENDSL;
022500131108
022600131108       ENDSR;
022700131108
022800131108       //--------------------------------------------------------------
022900131108       //?Richiamo *pgm TRUL03R                                        ?
023000131108       //--------------------------------------------------------------
023100131108       BEGSR  sr_CallTRUL03;
023200131108
023300131108         // -?Verifica se inseriti gli orari (o lasciati *blank)?
023400131108         If  %check( c_Digits : i03hm1a ) = *zero  and
023500131108             %check( c_Digits : i03hm2a ) = *zero  and
023600131108             %check( c_Digits : i03hm2a ) = *zero  and
023700131108             %check( c_Digits : i03hm3a ) = *zero;
023800131108           // -?Richiamo *pgm TRUL03R con orari corretti?
023900131108           i03hm1 = %int( i03hm1a );
024000131108           i03hm2 = %int( i03hm2a );
024100131108           i03hm3 = %int( i03hm3a );
024200131108           i03hm4 = %int( i03hm4a );
024300131108           trul03r ( trul03ds );
024400131108         Else;
024500131108           // -?Richiamo *pgm TRUL03R con orari *blank?
024600131108           KPJBA.kpjbu = i03hm1a + i03hm2a + i03hm3a + i03hm4a +
024700131108                         i03nt1 + i03nt2;
024800131108           trul03r ( KPJBA.kpjbu );
024900131108           trul03ds = KPJBA.kpjbu;
025000131108         EndIF;
025100131108
025200131108         F6Attivo  = *off;
025300131108         F12Attivo = *on;
025400131108
025500131108         write  ul03t1;
025600131108         write  ul03z1;
025700131108         write  ul03d1;
025800131108         write  Protect;
025900131108
026000131108         //ErrGenerico = o03err;
026100131108         //ErrMessage  = o03err;
026200131108         //V1Dmsg = o03msg;
026300131108
026400131108         // -?Emissione 2ª videata (con il risultato)?
026500131108         DoU  dsp_aid = c_F03  or  dsp_aid = c_F12;
026600131108
026700131108           exfmt  ul03d2;
026800131108
026900131108           // -?F3=Fine?
027000131108           if  dsp_aid = c_F03;
027100131108             $Fine = *on;
027200131108           endif;
027300131108
027400131108         EndDo;
027500131108
027600131108       ENDSR;
027700131108
027800131108      /end-free
