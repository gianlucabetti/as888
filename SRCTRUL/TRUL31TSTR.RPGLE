000100090128      *PARMS dftactgrp(*no) actgrp('QILE') option(*noxref)
000200090128       //--------------------------------------------------------------
000300100622       //?TEST - RITORNO FILIALI ABILITATE
000400090128       //--------------------------------------------------------------
000500090128
000600090128     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000700090128     h dftactgrp(*no) actgrp('QILE')
000800090128
000900090128       //--------------------------------------------------------------
001000090128       //?Dichiarazione file.
001100090128       //--------------------------------------------------------------
001200090128
001300090128       // - Video
001400100622     fTRUL31TSTDcf   e             workstn
001500090128     f                                     indds(IndDspF)
001600090128     f                                     infds(InfDspF)
001700090128
001800090128       //--------------------------------------------------------------
001900090128       //?Definizione costanti.
002000090128       //--------------------------------------------------------------
002100090128
002200090128       // - Tasti funzionali a video
002300090128     d c_F01           c                   const(x'31')
002400090128     d c_F02           c                   const(x'32')
002500090128     d c_F03           c                   const(x'33')
002600090128     d c_F04           c                   const(x'34')
002700090128     d c_F05           c                   const(x'35')
002800090128     d c_F06           c                   const(x'36')
002900090128     d c_F07           c                   const(x'37')
003000090128     d c_F08           c                   const(x'38')
003100090128     d c_F09           c                   const(x'39')
003200090128     d c_F10           c                   const(x'3A')
003300090128     d c_F11           c                   const(x'3B')
003400090128     d c_F12           c                   const(x'3C')
003500090128     d c_F13           c                   const(x'B1')
003600090128     d c_F14           c                   const(x'B2')
003700090128     d c_F15           c                   const(x'B3')
003800090128     d c_F16           c                   const(x'B4')
003900090128     d c_F17           c                   const(x'B5')
004000090128     d c_F18           c                   const(x'B6')
004100090128     d c_F19           c                   const(x'B7')
004200090128     d c_F20           c                   const(x'B8')
004300090128     d c_F21           c                   const(x'B9')
004400090128     d c_F22           c                   const(x'BA')
004500090128     d c_F23           c                   const(x'BB')
004600090128     d c_F24           c                   const(x'BC')
004700090128     d c_Enter         c                   const(x'F1')
004800090128     d c_RollDown      c                   const(x'F4')
004900090128     d c_RollUp        c                   const(x'F5')
005000090128
005100090128       //--------------------------------------------------------------
005200090128       //?Definizione schiere.
005300090128       //--------------------------------------------------------------
005400090128
005500090128
005600090128       //--------------------------------------------------------------
005700090128       //?Definizione aree dati.
005800090128       //--------------------------------------------------------------
005900090128
006000090128       // - Dati utente
006100090128     d §AzUte        e ds                  extname(AZUTE00F)
006200090128     d                                     dtaara
006300090128     d §DatiUte      e ds                  extname(dDatiUte)
006400090128     d                                     dtaara
006500090128
006600090128       //--------------------------------------------------------------
006700090128       //?Definizione strutture dati.
006800090128       //--------------------------------------------------------------
006900090128
007000090128       // - Status ds
007100090128     d Status         sds
007200090128     d  SDSpgm           *proc
007300090128     d  SDSprm           *parms
007400090128     d  SDSusr               254    263
007500090128
007600090128       // - InfDS
007700090128     d InfDspF         ds
007800090128     d  dsp_aid              369    369a
007900090128
008000090128       // - Indicatori su DspF
008100090128     d IndDspF         ds
008200090128        // - Indicatori di errore
008300090128     d  ErrMessage                    1n   overlay(IndDspF : 28)
008400090128     d  ErrGenerico                   1n   overlay(IndDspF : 99)
008500090128
008600090128       // - Parametri x Controllo profilo utenti
008700090304     d TIBS34ds      e ds                  qualified
008800090128
008900100622       // - Parametri x TRUL31R
009000100622     d TRUL31ds      e ds                  inz
009100100622     d pog                    10    759    dim(250)
009200100622
009300100622     d kpjba         e ds
009400090128
009500090128       //--------------------------------------------------------------
009600090128       //?Definizione variabili globali.
009700090128       //--------------------------------------------------------------
009800090128
009900090128       // - Flags booleani
010000090128     d $Fine           s               n   inz(*off)
010100090128     d $InzD01         s               n   inz(*on)
010200090128
010300090128       //--------------------------------------------------------------
010400090128       //?Definizione procedure usate.
010500090128       //--------------------------------------------------------------
010600090128
010700090128       // - Reperimento dati utente
010800090304      /copy GAITRASRC/SRCPROTOPR,TIBS34R
010900100622      /copy gaitrasrc/srcprotopr,trul31r
011000090128
011100090128       //--------------------------------------------------------------
011200090128       //?Definizione key-list.
011300090128       //--------------------------------------------------------------
011400090128
011500090128
011600090128       //--------------------------------------------------------------
011700090128       //?Riepilogo indicatori.
011800090128       //--------------------------------------------------------------
011900090128
012000090128
012100090128       //--------------------------------------------------------------
012200090128       //?M A I N - L I N E
012300090128       //--------------------------------------------------------------
012400090128
012500090128      /free
012600090128
012700090128       // - Start
012800090128       *inLR = *on;
012900090128
013000090128       // - Elab
013100090128       dow  $Fine = *off;
013200090128         exsr sr_GesD01;
013300090128       enddo;
013400090128
013500090128       // - End
013600090128       return;
013700090128
013800090128       //--------------------------------------------------------------
013900090128       //?Operazioni iniziali
014000090128       //--------------------------------------------------------------
014100090128       BEGSR *InzSR;
014200090128
014300090128         // Reperimento dati utente
014400090128         exsr sr_DatiJob;
014500090128
014600090128       ENDSR;
014700090128
014800090128       //--------------------------------------------------------------
014900090128       //?Reperimento Dati del job (Utente/Operativi).
015000090128       //--------------------------------------------------------------
015100090128       BEGSR sr_DatiJob;
015200090128
015300090128         in(E) §AzUte;
015400090128         if NOT %error;
015500090128           in(E) §DatiUte;
015600090128         endif;
015700090128         if %error or RSut = *blanks;
015800090128           clear TIBS34ds;
015900090128           tibs34r(tibs34ds);
016000090128           in §AzUte;
016100090128           in §DatiUte;
016200090128         endif;
016300090128
016400090128       ENDSR;
016500090128
016600090128       //--------------------------------------------------------------
016700090128       //?Gestione videata D01
016800090128       //--------------------------------------------------------------
016900090128       BEGSR sr_GesD01;
017000090128
017100090128         // Inizializzazione videata
017200090128         if  $InzD01 = *on;
017300100622           clear ul31d1;
017400090128           $InzD01  = *off;
017500090128         endif;
017600090128
017700090128         // emissione videata
017800090128         if  ErrMessage = *off;
017900100622           write ul31t1;
018000100622           write ul31z1;
018100090128         endif;
018200090128
018300100622         exfmt ul31d1;
018400090128
018500090128         reset ErrMessage;
018600090128         reset ErrGenerico;
018700090128         clear V1Dmsg;
018800090128
018900090128         SELECT;
019000090128
019100090128         // - F3=Fine
019200090128           WHEN  dsp_aid = c_F03;
019300090128             $Fine = *on;
019400090128
019500090128         // - Invio o F6=Conferma
019600090128           OTHER;
019700090128             exsr sr_CtrD01;
019800090128             select;
019900090129               // - rilevato errore
020000090128               when  ErrGenerico = *on;
020100090129               // - non premuto F6
020200090128               when  dsp_aid <> c_F06;
020300090129               // - override da gestire
020400090128               other;
020500100622                 exsr Call_trul31r;
020600090128             endsl;
020700090128
020800090128         ENDSL;
020900090128
021000090128       ENDSR;
021100090128
021200090128       //--------------------------------------------------------------
021300100622       //?Richiamo stored procedure TRUL31R
021400090128       //--------------------------------------------------------------
021500100622       BEGSR Call_trul31r;
021600090128
021700100622         trul31r (kpjba:trul31ds);
021800100622
021900100622         pog001 = pog(001);
022000100622         pog002 = pog(002);
022100100622         pog003 = pog(003);
022200100622         pog004 = pog(004);
022300100622         pog005 = pog(005);
022400100622         pog006 = pog(006);
022500100622         pog007 = pog(007);
022600100622         pog008 = pog(008);
022700100622         pog009 = pog(009);
022800100622         pog010 = pog(010);
022900100622         pog011 = pog(011);
023000100622         pog012 = pog(012);
023100100622         pog013 = pog(013);
023200100622         pog014 = pog(014);
023300100622         pog015 = pog(015);
023400100622         pog016 = pog(016);
023500100622         pog017 = pog(017);
023600100622         pog018 = pog(018);
023700100622         pog019 = pog(019);
023800100622         pog020 = pog(020);
023900100622         pog021 = pog(021);
024000100622         pog022 = pog(022);
024100100622         pog023 = pog(023);
024200100622         pog024 = pog(024);
024300100622         pog025 = pog(025);
024400100622         pog026 = pog(026);
024500100622         pog027 = pog(027);
024600100622         pog028 = pog(028);
024700100622         pog029 = pog(029);
024800100622         pog030 = pog(030);
024900100622         pog031 = pog(031);
025000100622         pog032 = pog(032);
025100100622         pog033 = pog(033);
025200100622         pog034 = pog(034);
025300100622         pog035 = pog(035);
025400100622         pog036 = pog(036);
025500100622         pog037 = pog(037);
025600100622         pog038 = pog(038);
025700100622         pog039 = pog(039);
025800100622         pog040 = pog(040);
025900100622         pog041 = pog(041);
026000100622         pog042 = pog(042);
026100100622         pog043 = pog(043);
026200100622         pog044 = pog(044);
026300100622         pog045 = pog(045);
026400100622         pog046 = pog(046);
026500100622         pog047 = pog(047);
026600100622         pog048 = pog(048);
026700100622         pog049 = pog(049);
026800100622         pog050 = pog(050);
026900100622         pog051 = pog(051);
027000100622         pog052 = pog(052);
027100100622         pog053 = pog(053);
027200100622         pog054 = pog(054);
027300100622         pog055 = pog(055);
027400100622         pog056 = pog(056);
027500100622         pog057 = pog(057);
027600100622         pog058 = pog(058);
027700100622         pog059 = pog(059);
027800100622         pog060 = pog(060);
027900100622         pog061 = pog(061);
028000100622         pog062 = pog(062);
028100100622         pog063 = pog(063);
028200100622         pog064 = pog(064);
028300100622         pog065 = pog(065);
028400100622         pog066 = pog(066);
028500100622         pog067 = pog(067);
028600100622         pog068 = pog(068);
028700100622         pog069 = pog(069);
028800100622         pog070 = pog(070);
028900100622         pog071 = pog(071);
029000100622         pog072 = pog(072);
029100100622         pog073 = pog(073);
029200100622         pog074 = pog(074);
029300100622         pog075 = pog(075);
029400100622         pog076 = pog(076);
029500100622         pog077 = pog(077);
029600100622         pog078 = pog(078);
029700100622         pog079 = pog(079);
029800100622         pog080 = pog(080);
029900100622         pog081 = pog(081);
030000100622         pog082 = pog(082);
030100100622         pog083 = pog(083);
030200100622         pog084 = pog(084);
030300100622         pog085 = pog(085);
030400100622         pog086 = pog(086);
030500100622         pog087 = pog(087);
030600100622         pog088 = pog(088);
030700100622         pog089 = pog(089);
030800100622         pog090 = pog(090);
030900100622         pog091 = pog(091);
031000100622         pog092 = pog(092);
031100100622         pog093 = pog(093);
031200100622         pog094 = pog(094);
031300100622         pog095 = pog(095);
031400100622         pog096 = pog(096);
031500100622         pog097 = pog(097);
031600100622         pog098 = pog(098);
031700100622         pog099 = pog(099);
031800100622         pog100 = pog(100);
031900100622         pog101 = pog(101);
032000100622         pog102 = pog(102);
032100100622         pog103 = pog(103);
032200100622         pog104 = pog(104);
032300100622         pog105 = pog(105);
032400100622         pog106 = pog(106);
032500100622         pog107 = pog(107);
032600100622         pog108 = pog(108);
032700100622         pog109 = pog(109);
032800100622         pog110 = pog(110);
032900100622         pog111 = pog(111);
033000100622         pog112 = pog(112);
033100100622         pog113 = pog(113);
033200100622         pog114 = pog(114);
033300100622         pog115 = pog(115);
033400100622         pog116 = pog(116);
033500100622         pog117 = pog(117);
033600100622         pog118 = pog(118);
033700100622         pog119 = pog(119);
033800100622         pog120 = pog(120);
033900100622         pog121 = pog(121);
034000100622         pog122 = pog(122);
034100100622         pog123 = pog(123);
034200100622         pog124 = pog(124);
034300100622         pog125 = pog(125);
034400100622         pog126 = pog(126);
034500100622         pog127 = pog(127);
034600100622         pog128 = pog(128);
034700100622         pog129 = pog(129);
034800100622         pog130 = pog(130);
034900100622         pog131 = pog(131);
035000100622         pog132 = pog(132);
035100100622         pog133 = pog(133);
035200100622         pog134 = pog(134);
035300100622         pog135 = pog(135);
035400100622         pog136 = pog(136);
035500100622         pog137 = pog(137);
035600100622         pog138 = pog(138);
035700100622         pog139 = pog(139);
035800100622         pog140 = pog(140);
035900100622         pog141 = pog(141);
036000100622         pog142 = pog(142);
036100100622         pog143 = pog(143);
036200100622         pog144 = pog(144);
036300100622         pog145 = pog(145);
036400100622         pog146 = pog(146);
036500100622         pog147 = pog(147);
036600100622         pog148 = pog(148);
036700100622         pog149 = pog(149);
036800100622         pog150 = pog(150);
036900100622         pog151 = pog(151);
037000100622         pog152 = pog(152);
037100100622         pog153 = pog(153);
037200100622         pog154 = pog(154);
037300100622         pog155 = pog(155);
037400100622         pog156 = pog(156);
037500100622         pog157 = pog(157);
037600100622         pog158 = pog(158);
037700100622         pog159 = pog(159);
037800100622         pog160 = pog(160);
037900100622         pog161 = pog(161);
038000100622         pog162 = pog(162);
038100100622         pog163 = pog(163);
038200100622         pog164 = pog(164);
038300100622         pog165 = pog(165);
038400100622         pog166 = pog(166);
038500100622         pog167 = pog(167);
038600100622         pog168 = pog(168);
038700100622         pog169 = pog(169);
038800100622         pog170 = pog(170);
038900100622         pog171 = pog(171);
039000100622         pog172 = pog(172);
039100100622         pog173 = pog(173);
039200100622         pog174 = pog(174);
039300100622         pog175 = pog(175);
039400100622         pog176 = pog(176);
039500100622         pog177 = pog(177);
039600100622         pog178 = pog(178);
039700100622         pog179 = pog(179);
039800100622         pog180 = pog(180);
039900100622         pog181 = pog(181);
040000100622         pog182 = pog(182);
040100100622         pog183 = pog(183);
040200100622         pog184 = pog(184);
040300100622         pog185 = pog(185);
040400100622         pog186 = pog(186);
040500100622         pog187 = pog(187);
040600100622         pog188 = pog(188);
040700100622         pog189 = pog(189);
040800100622         pog190 = pog(190);
040900100622         pog191 = pog(191);
041000100622         pog192 = pog(192);
041100100622         pog193 = pog(193);
041200100622         pog194 = pog(194);
041300100622         pog195 = pog(195);
041400100622         pog196 = pog(196);
041500100622         pog197 = pog(197);
041600100622         pog199 = pog(198);
041700100622         pog198 = pog(199);
041800100622         pog200 = pog(200);
041900100622         pog201 = pog(201);
042000100622         pog202 = pog(202);
042100100622         pog203 = pog(203);
042200100622         pog204 = pog(204);
042300100622         pog205 = pog(205);
042400100622         pog206 = pog(206);
042500100622         pog207 = pog(207);
042600100622         pog208 = pog(208);
042700100622         pog209 = pog(209);
042800100622         pog210 = pog(210);
042900100622         pog211 = pog(211);
043000100622         pog212 = pog(212);
043100100622         pog213 = pog(213);
043200100622         pog214 = pog(214);
043300100622         pog215 = pog(215);
043400100622         pog216 = pog(216);
043500100622         pog217 = pog(217);
043600100622         pog218 = pog(218);
043700100622         pog219 = pog(219);
043800100622         pog220 = pog(220);
043900100622         pog221 = pog(221);
044000100622         pog222 = pog(222);
044100100622         pog223 = pog(223);
044200100622         pog224 = pog(224);
044300100622         pog225 = pog(225);
044400100622         pog226 = pog(226);
044500100622         pog227 = pog(227);
044600100622         pog228 = pog(228);
044700100622         pog229 = pog(229);
044800100622         pog230 = pog(230);
044900100622         pog231 = pog(231);
045000100622         pog232 = pog(232);
045100100622         pog233 = pog(233);
045200100622         pog234 = pog(234);
045300100622         pog235 = pog(235);
045400100622         pog236 = pog(236);
045500100622         pog237 = pog(237);
045600100622         pog238 = pog(238);
045700100622         pog239 = pog(239);
045800100622         pog240 = pog(240);
045900100622         pog241 = pog(241);
046000100622         pog242 = pog(242);
046100100622         pog243 = pog(243);
046200100622         pog244 = pog(244);
046300100622         pog245 = pog(245);
046400100622         pog246 = pog(246);
046500100622         pog247 = pog(247);
046600100622         pog248 = pog(248);
046700100622         pog249 = pog(249);
046800100622         pog250 = pog(250);
046900090128
047000100622         dou  dsp_aid <> c_F03;
047100090212
047200100622           write  ul31d1;
047300090212           write  Protect;
047400100622           exfmt  ul31d2;
047500090212
047600090212           select;
047700090212             // - F3=Fine
047800090212             when  dsp_aid = c_F03;
047900090212               $Fine = *on;
048000090212           endsl;
048100090212
048200090212         enddo;
048300090128
048400090128       ENDSR;
048500090128
048600090128       //--------------------------------------------------------------
048700090128       //?Controllo dati in videata D01
048800090128       //--------------------------------------------------------------
048900090128       BEGSR sr_CtrD01;
049000090128
049100090128         IndDspF  = *zero;
049200090128
049300090128       ENDSR;
049400090128
049500090128      /end-free
