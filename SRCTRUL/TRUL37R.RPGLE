000100060502     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000200060427      *------------------------------------------------------------------------*
000300060601      * Ricerca/scelta codici lingua su AZLIN00F                               *
000400060427      *------------------------------------------------------------------------*
000500060601     fazlin03l  if   e           k disk
000600060601     ftrul37d   cf   e             workstn sfile(trl37s1:s01nrr)
000700060428
000800060428      *------------------------------------------------------------------------*
000900060428      * riepilogo indicatori
001000060428      *------------------------------------------------------------------------*
001100060601      * 20 - sfldspctl -- sflclr
001200060601      * 21 - sflend
001300060601      * 22 - sfldsp
001400060502
001500060502      *------------------------------------------------------------------------*
001600060502      * schiere
001700060502      *------------------------------------------------------------------------*
001800060427
001900060428      *------------------------------------------------------------------------*
002000060428      * campi di work
002100060428      *------------------------------------------------------------------------*
002200060601     d p37iso2         s                   like(liniso2)
002300060601     d p37desi         s                   like(lindesita)
002400060505     d s01nrr          s              4  0
002500060601     d wrksfl          s              1
002600060428
002700060428      *------------------------------------------------------------------------*
002800060428      * ds interne/esterne
002900060428      *------------------------------------------------------------------------*
003000060428
003100060428      *------------------------------------------------------------------------*
003200060428      * pgm richiamati
003300060428      *------------------------------------------------------------------------*
003400060428
003500060428      *------------------------------------------------------------------------*
003600060428      * costanti
003700060428      *------------------------------------------------------------------------*
003800010503
003900060428      *------------------------------------------------------------------------*
004000010423
004100060428      /free
004200060428
004300060601       exsr sr_subfile;
004400060601
004500060601       *inlr = *on;
004600010430
004700060502       // ------------------------------------------------------------------------
004800060502       // gestione subfile
004900060502       // ------------------------------------------------------------------------
005000060601       begsr sr_subfile;
005100060428
005200060502       // inizio elaborazione subfile
005300060601         dow  *inkc =*off;
005400060428
005500060502       // caricamento subfile
005600060601          exsr sr_carsfl;
005700060601
005800060601       // forzo sempre pagina 1
005900060601          if rec01 < 1;
006000060601           rec01 = 1;
006100060601          endif;
006200060428
006300060428
006400060502       // Emissione del subfile
006500060601          write trl37p1;
006600060601          exfmt trl37c1;
006700060428
006800060502       // F3=Fine
006900060601           if *inkc;
007000060601            leave;
007100060428
007200060502       // in tutti gli altri casi
007300060601           else;
007400060502       // controllo ed elaborazione scelte su subfile
007500060428            exsr sr_gestsfl;
007600060601          endif;
007700060428
007800060601       // fine elaborazione
007900060428         enddo;
008000060428
008100060428        endsr;
008200060428
008300060502       // ------------------------------------------------------------------------
008400060502       // caricamento subfile
008500060502       // ------------------------------------------------------------------------
008600060601       begsr sr_carsfl;
008700060428
008800060502       // inizializzo il subfile
008900060505         s01nrr = 0;
009000060428         *in20 = *on;
009100060601         write trl37c1;
009200060601         *in20 = *off;
009300060601         *in21 = *off;
009400060601         *in22 = *off;
009500060428
009600060502       // imposto la chiave di posizionamento e lettura file
009700060601         clear liniso2;
009800060502       // posizionamento file
009900060601         setll liniso2 azlin03l;
010000060502       // fino a che non è fine file
010100060601         dou %eof(azlin03l);
010200060502       // leggo file
010300060601          read azlin03l;
010400060502       // fine file esco
010500060601          if %eof(azlin03l);
010600060428           leave;
010700060428          endif;
010800060601          exsr sr_wtrsfl;
010900060428         enddo;
011000060428
011100060502       // se scritto almeno un record
011200060505        if s01nrr > 0;
011300060502       // indicatore di sflend
011400060428         eval *in21 = *on;
011500060428        endif;
011600060428
011700060502       // se non scritto neanche un record
011800060505        if s01nrr = 0;
011900060502       // indicatore di sfldsp
012000060601         eval *in22 = *on;
012100060428        endif;
012200060428
012300060428       endsr;
012400060601
012500060601       // ------------------------------------------------------------------------
012600060601       // scrivo subfile
012700060601       // ------------------------------------------------------------------------
012800060601       begsr sr_wtrsfl;
012900060601
013000060601       // se non raggiunto limite massimo di caricamento
013100060601        if s01nrr < 9999;
013200060601         clear v1sopz;
013300060601         v1siso2 = liniso2;
013400060601         v1sdesi = lindesita;
013500060601         s01nrr = s01nrr + 1;
013600060601         write trl37s1;
013700060601        endif;
013800060601
013900060601       endsr;
014000060601
014100060502       // ------------------------------------------------------------------------
014200060502       // gestione del subfile
014300060502       // ------------------------------------------------------------------------
014400060502       begsr sr_gestsfl;
014500060502
014600060502       // inizio lettura subfile
014700060601        dow *in21;
014800060601         readc trl37s1;
014900060502       // se fine subfile
015000060502         if %eof;
015100060502          leave;
015200060502         endif;
015300060502       // se è stata immessa un'opzione
015400060601         if v1sopz <> *blanks;
015500060601          p37iso2 = v1siso2;
015600060601          p37desi = v1sdesi;
015700060601          update trl37s1;
015800060601          *inkc = *on;
015900060601          leave;
016000060502         endif;
016100060502
016200060502        enddo;
016300060502
016400060502       endsr;
016500060505
016600060502       // ------------------------------------------------------------------------
016700060502       // routine iniziale
016800060502       // ------------------------------------------------------------------------
016900060428         begsr *inzsr;
017000060428
017100060428      /end-free
017200060428
017300060428     c     *entry        plist
017400060601     c                   parm                    p37iso2
017500060601     c                   parm                    p37desi
017600060428
017700060601     c                   endsr
017800060502
