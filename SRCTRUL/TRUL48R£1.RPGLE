000100040315     h Decedit('0,') Datedit(*YMD.) Option(*nodebugio)
000200040316
000300040316      *------------------------------------------------------------------------*
000400040316      *                                                                        *
000500100412      *   STACCA NUMERO PER NUOVA VISITA/TRATTATIVA                            *
000600040316      *                                                                        *
000700040316      *------------------------------------------------------------------------*
000800040512
000900100413     fTnvis05l  if   e           k Disk    prefix(W_)
001000100412     fTivis05l  if   e           k Disk
001100040316
001200100413      *------------------------------------------------------------------------*
001300100413      *   S C H I E R E
001400100413      *------------------------------------------------------------------------*
001500040316
001600100413      *------------------------------------------------------------------------*
001700100413      *   V A R I A B I L I
001800100413      *------------------------------------------------------------------------*
001900100413
002000100413     d Newnrv          s                   like(visnrv)
002100100413     d $prg            s              2  0
002200100413
002300100413      // - Flags booleani
002400100413     d $NumOK          s               n   inz(*off)
002500040316
002600100413       //----------------------------------------------------------------------*
002700100413       // D S   I N T E R N E / E S T E R N E
002800100413       //-----------------------------------------------------------------------*
002900040512     d Kpjba         e ds
003000100412     d Trul48ds      e ds
003100100413     d Trul33ds      e ds                  inz
003200040316
003300100413       //----------------------------------------------------------------------*
003400100413       // C O S T A N T I
003500100413       //----------------------------------------------------------------------*
003600040316
003700100413       //----------------------------------------------------------------------*
003800100413       //RIEPILOGO INDICATORI
003900100413       //----------------------------------------------------------------------*
004000100413       // -
004100100413       //---------------------------------------------------------------------*
004200100413
004300100413       //--------------------------------------------------------------
004400100413       //?prototipi
004500100413       //---------------------------------------------------------------
004600100413
004700100413
004800100413     D Trul33R         pr                  extpgm('TRUL33R')
004900100413     D  Kpjba                              likeds(kpjba) const
005000100413
005100100413        //--------------------------------------------------------------------*
005200040316
005300100413     c     *Entry        plist
005400100413     c                   parm                    KPJBA
005500100413     c                   parm                    trul48ds
005600100413
005700100413      /free
005800100413
005900100413            reset $NumOk ;
006000100413
006100100413            dow $NumOk = *off ;
006200040512
006300100412                RESET trul33ds;
006400100412                i33tla = 'L'  ;
006500100412                i33ope = 0    ;
006600100413                i33Cnu = 1    ;
006700100412                i33num = 1    ;
006800100412                kpjbu = trul33ds;
006900100412                trul33r(kpjba);
007000100412                trul33ds = kpjbu;
007100100412
007200100413                If o33Err = 0;
007300100412                   newnrv  = o33Nrf;
007400100413                   $prg = 1 ;
007500100413       // verifico se numero già esistente  prima su TNVIS e con tutti i suoi progressivi
007600100413                   setll newnrv tnvis05l ;
007700100413                   dow not %equal(tnvis05l) and $prg <= 9 ;
007800100413                       newnrv+=1 ;
007900100413                       setll newnrv tnvis05l ;
008000100413                       $prg+=1 ;
008100100413                   enddo ;
008200100413       // se progressivo diverso da 10 vuol dire che il numero è già impegnato
008300100413                   If $prg <> 10 ;
008400100413                      iter  ;
008500100413                   endif ;
008600100413       // se progressivo uguale a 10 non ho trovato numeri visita nel file tnvis
008700100413                   newnrv  = o33Nrf;
008800100413                   $prg = 1 ;
008900100413       // verifico se numero già esistente  prima su TIVIS
009000100413                   setll newnrv tivis05l ;
009100100413                   dow not %equal(tivis05l) and $prg <= 9 ;
009200100413                       newnrv+=1 ;
009300100413                       setll newnrv tivis05l ;
009400100413                       $prg+=1 ;
009500100413                   enddo ;
009600100413       // se progressivo diverso da 10 vuol dire che il numero è già impegnato
009700100413                   If $prg <> 10 ;
009800100413                      iter  ;
009900100413                   endif ;
010000100412
010100100413                   $NumOk = *on ;
010200100413                   o48nrv = o33nrf ;
010300100412                else ;
010400100413                   o48err = o33err ;
010500100413                   o48msg = o33msg ;
010600100413                   leave;
010700100412                Endif;
010800100412        // se esiste già questo numero richiamo trul33
010900100412            Enddo;
011000040316
011100100413            Eval  *InLr = *On ;
011200040318
