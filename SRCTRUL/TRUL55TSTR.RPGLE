000100090128      *PARMS dftactgrp(*no) actgrp('QILE') option(*noxref)
000200101109     /*PRM dbgview(*source)
000300101109     /*END
000400101109       //==============================================================
000500101109       //?TEST - DETERMINAZIONE NOME DELL'IMMAGINE PER TILAC           ?
000600101109       //==============================================================
000700090128
000800090128     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000900090128     h dftactgrp(*no) actgrp('QILE')
001000101109     h bnddir('TRUL')
001100090128
001200090128       //--------------------------------------------------------------
001300101109       //?Dichiarazione file.                                          ?
001400090128       //--------------------------------------------------------------
001500090128
001600101109       // -?Video?
001700090128     fTRUL55TSTDcf   e             workstn
001800090128     f                                     indds(IndDspF)
001900090128     f                                     infds(InfDspF)
002000090128
002100090128       //--------------------------------------------------------------
002200101109       //?Definizione costanti.                                        ?
002300090128       //--------------------------------------------------------------
002400090128
002500101109       // -?Tasti funzionali a video?
002600090128     d c_F01           c                   const(x'31')
002700090128     d c_F02           c                   const(x'32')
002800090128     d c_F03           c                   const(x'33')
002900090128     d c_F04           c                   const(x'34')
003000090128     d c_F05           c                   const(x'35')
003100090128     d c_F06           c                   const(x'36')
003200090128     d c_F07           c                   const(x'37')
003300090128     d c_F08           c                   const(x'38')
003400090128     d c_F09           c                   const(x'39')
003500090128     d c_F10           c                   const(x'3A')
003600090128     d c_F11           c                   const(x'3B')
003700090128     d c_F12           c                   const(x'3C')
003800090128     d c_F13           c                   const(x'B1')
003900090128     d c_F14           c                   const(x'B2')
004000090128     d c_F15           c                   const(x'B3')
004100090128     d c_F16           c                   const(x'B4')
004200090128     d c_F17           c                   const(x'B5')
004300090128     d c_F18           c                   const(x'B6')
004400090128     d c_F19           c                   const(x'B7')
004500090128     d c_F20           c                   const(x'B8')
004600090128     d c_F21           c                   const(x'B9')
004700090128     d c_F22           c                   const(x'BA')
004800090128     d c_F23           c                   const(x'BB')
004900090128     d c_F24           c                   const(x'BC')
005000090128     d c_Enter         c                   const(x'F1')
005100090128     d c_RollDown      c                   const(x'F4')
005200090128     d c_RollUp        c                   const(x'F5')
005300090128
005400090128       //--------------------------------------------------------------
005500101109       //?Definizione schiere.                                         ?
005600090128       //--------------------------------------------------------------
005700090128
005800090128
005900090128       //--------------------------------------------------------------
006000101109       //?Definizione aree dati.                                       ?
006100090128       //--------------------------------------------------------------
006200090128
006300101109       // -?Dati utente?
006400090128     d §AzUte        e ds                  extname(AZUTE00F)
006500090128     d                                     dtaara
006600090128     d §DatiUte      e ds                  extname(dDatiUte)
006700090128     d                                     dtaara
006800090128
006900090128       //--------------------------------------------------------------
007000101109       //?Definizione strutture dati.                                  ?
007100090128       //--------------------------------------------------------------
007200090128
007300101109       // -?Status ds?
007400090128     d Status         sds
007500090128     d  SDSpgm           *proc
007600090128     d  SDSprm           *parms
007700090128     d  SDSusr               254    263
007800090128
007900101109       // -?InfDS?
008000090128     d InfDspF         ds
008100090128     d  dsp_aid              369    369a
008200090128
008300101109       // -?Indicatori su DspF?
008400090128     d IndDspF         ds
008500101109         // -?Abilitazione tasti funzionali?
008600101109     d   F6Attivo                      n   overlay(IndDspF : 06)
008700101109         // -?Emissione messaggio di errore?
008800101109     d   ErrMessage                    n   overlay(IndDspF : 28)
008900101109         // -?Riemissione videata?
009000101109     d   ErrGenerico                   n   overlay(IndDspF : 99)
009100090128
009200101109       // -?Parametri per Reperimento dati utente?
009300090304     d TIBS34ds      e ds                  qualified
009400090128
009500101109       // -?Parametri x TRUL55R?
009600090304     d TRUL55ds      e ds                  inz
009700101109
009800101109       // -?kpjba?
009900090304     d kpjba         e ds                  qualified  inz
010000090128
010100090128       //--------------------------------------------------------------
010200101109       //?Definizione variabili globali.                               ?
010300090128       //--------------------------------------------------------------
010400090128
010500101109       // -?Flags booleani?
010600090128     d $Fine           s               n   inz(*off)
010700090128     d $InzD01         s               n   inz(*on)
010800090128
010900090128       //--------------------------------------------------------------
011000101109       //?Definizione procedure usate.                                 ?
011100090128       //--------------------------------------------------------------
011200090128
011300101109       // -?Reperimento dati utente?
011400101109      /copy gaitrasrc/srcProtoPR,TIBS34R
011500090128
011600101109       // -?Determinazione nome dell'immagine per TILAC?
011700090128     d trul55r         pr                  extpgm('TRUL55R')
011800090128     d   trul55ds...
011900090128     d                                     likeds(trul55ds)
012000101109
012100101209       // -?Ricerca/Controllo tabelle (TNTBE)?
012200101209     d TIBS02ds      e ds                  inz
012300101209     d   T02mod      e                     inz('R')
012400101209     d   T02cod      e                     inz('NIM')
012500101209      /copy gaitrasrc/srcProtoPR,TIBS02R
012600090128
012700090128       //--------------------------------------------------------------
012800101109       //?Definizione key-list.                                        ?
012900090128       //--------------------------------------------------------------
013000090128
013100090128
013200090128       //--------------------------------------------------------------
013300101109       //?Riepilogo indicatori.                                        ?
013400090128       //--------------------------------------------------------------
013500090128
013600090128
013700090128       //--------------------------------------------------------------
013800101109       //?M A I N - L I N E                                            ?
013900090128       //--------------------------------------------------------------
014000090128
014100090128      /free
014200090128
014300101109       // -?Start?
014400090128       *inLR = *on;
014500090128
014600101109       // -?Elab?
014700090128       dow  $Fine = *off;
014800101109         exsr  sr_GesD01;
014900090128       enddo;
015000090128
015100101109       // -?End?
015200101209       clear  TIBS02ds;
015300101209       T02tla = 'C';
015400101209       TNTBE_RicercaControllo (kpjba : TIBS02ds);
015500090128       return;
015600090128
015700090128       //--------------------------------------------------------------
015800101109       //?Operazioni iniziali.                                         ?
015900090128       //--------------------------------------------------------------
016000101109       BEGSR  *InzSR;
016100090128
016200101109         // -?Reperimento dati job?
016300101109         exsr  sr_DatiJob;
016400090128
016500101109         // -?Impostazione nome programma a video?
016600090128         //VTDpgm = SDSpgm;
016700090128
016800090128       ENDSR;
016900090128
017000090128       //--------------------------------------------------------------
017100101109       //?Reperimento Dati del job (Utente/Operativi).                 ?
017200090128       //--------------------------------------------------------------
017300101109       BEGSR  sr_DatiJob;
017400090128
017500090128         in(E) §AzUte;
017600090128         if NOT %error;
017700090128           in(E) §DatiUte;
017800090128         endif;
017900090128         if %error or RSut = *blanks;
018000090128           clear TIBS34ds;
018100090128           tibs34r(tibs34ds);
018200090128           in §AzUte;
018300090128           in §DatiUte;
018400090128         endif;
018500090128
018600090128       ENDSR;
018700090128
018800090128       //--------------------------------------------------------------
018900101109       //?Gestione videata D01                                         ?
019000090128       //--------------------------------------------------------------
019100101109       BEGSR  sr_GesD01;
019200090128
019300101109         // -?Inizializzazione videata?
019400090128         if  $InzD01 = *on;
019500090128           clear ul55d1;
019600090128           $InzD01  = *off;
019700090128         endif;
019800101109
019900101109         F6Attivo = *on;
020000090128
020100101109         // -?Emissione videata?
020200090128         if  ErrMessage = *off;
020300090128           write ul55t1;
020400090128           write ul55z1;
020500090128         endif;
020600090128         exfmt ul55d1;
020700090128
020800090128         reset ErrMessage;
020900090128         reset ErrGenerico;
021000090128         clear V1Dmsg;
021100090128
021200090128         SELECT;
021300090128
021400101109           // -?F3=Fine?
021500090128           WHEN  dsp_aid = c_F03;
021600090128             $Fine = *on;
021700090128
021800101109           // -?Invio o F6=Conferma?
021900090128           OTHER;
022000090128             exsr sr_CtrD01;
022100090128             select;
022200101109               // -?rilevato errore?
022300090128               when  ErrGenerico = *on;
022400101109               // -?non premuto F6?
022500090128               when  dsp_aid <> c_F06;
022600101109               // -?richiamo da eseguire?
022700090128               other;
022800101109                 exsr  Call_TRUL55R;
022900090129                 //reset $InzD01;
023000090213                 //clear  I55lnp;
023100090213                 //clear  I55nrs;
023200090129                 clear  I55nsp;
023300090213                 //clear  I55aas;
023400090129                 clear  I55mgs;
023500090129                 clear  I55rmn;
023600090129                 clear  I55rma;
023700090128             endsl;
023800090128
023900090128         ENDSL;
024000090128
024100090128       ENDSR;
024200090128
024300090128       //--------------------------------------------------------------
024400101109       //?Richiamo *pgm TRUL55R                                        ?
024500090128       //--------------------------------------------------------------
024600101109       BEGSR  Call_TRUL55R;
024700090128
024800101109         // -?Richiamo *pgm TRUL55R?
024900101109         trul55r ( trul55ds );
025000090128
025100090129         *in28  = O55err;
025200090129         V1Dmsg = O55msg;
025300101109         F6Attivo = *off;
025400101109
025500101109         write  ul55t1;
025600101109         write  ul55z1;
025700101109         write  ul55d1;
025800101109         write  Protect;
025900090129
026000101109         // -?Emissione 2ª videata (con il risultato)?
026100101109         dou  dsp_aid = c_F03  or  dsp_aid = c_F12;
026200090212
026300090212           exfmt  ul55d2;
026400090212
026500101109           // -?F3=Fine?
026600101109           if  dsp_aid = c_F03;
026700101109             $Fine = *on;
026800101109           endif;
026900090212
027000090212         enddo;
027100090128
027200090128       ENDSR;
027300090128
027400090128       //--------------------------------------------------------------
027500101109       //?Controllo dati in videata D01                                ?
027600090128       //--------------------------------------------------------------
027700101109       BEGSR  sr_CtrD01;
027800090128
027900101109         %subst(IndDspF : 28) = *off;
028000090304
028100101109         // -?Flag "Nome Immagine"?
028200101109         select;
028300101109           // -?Interrogazione?
028400101109           when  %scan( '?' : I55fmi ) > *zero;
028500101109             clear  I55fmi;
028600101209             reset  TIBS02ds;
028700101209             //T02sif = knsif;
028800101209             TNTBE_RicercaControllo (kpjba : TIBS02ds);
028900101209             if  T02err = *blank;
029000101209               V1NIMdes = T02uni;
029100101209               I55fmi = T02ke1;
029200101209             endif;
029300101109             ErrGenerico = *on;
029400101109           // -?Decodifica?
029500101109           when  I55fmi <> *blank;
029600101209             clear  V1NIMdes;
029700101209             reset  TIBS02ds;
029800101209             T02mod = 'C';
029900101209             //T02sif = knsif;
030000101209             T02ke1 = I55fmi;
030100101209             TNTBE_RicercaControllo (kpjba : TIBS02ds);
030200101209             if  T02err = *blank;
030300101209               V1NIMdes = T02uni;
030400101209             else;
030500101209               V1NIMdes = *all'? ';
030600101209             endif;
030700101109         endsl;
030800090128
030900090128       ENDSR;
031000090128
031100090128      /end-free
