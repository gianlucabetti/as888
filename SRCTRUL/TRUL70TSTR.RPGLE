000100151016     /*PRM dbgview(*source)
000200151016     /*END
000300151016       //==============================================================
000400151016       //?TEST - DETERMINAZIONE NOME DELL'IMMAGINE PER TILAC           ?
000500151016       //==============================================================
000600151016
000700151016     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000800151016     h dftactgrp(*no)
000900151016     h bnddir('TRUL')
001000151016
001100151016       //--------------------------------------------------------------
001200151016       //?Dichiarazione file.                                          ?
001300151016       //--------------------------------------------------------------
001400151016
001500151016       // -?Video?
001600151016     fTRUL70TSTDcf   e             workstn
001700151016     f                                     indds(IndDspF)
001800151016     f                                     infds(InfDspF)
001900151016
002000151016       //--------------------------------------------------------------
002100151016       //?Definizione costanti.                                        ?
002200151016       //--------------------------------------------------------------
002300151016
002400151016       // -?Tasti funzionali a video?
002500151016     d c_F01           c                   const(x'31')
002600151016     d c_F02           c                   const(x'32')
002700151016     d c_F03           c                   const(x'33')
002800151016     d c_F04           c                   const(x'34')
002900151016     d c_F05           c                   const(x'35')
003000151016     d c_F06           c                   const(x'36')
003100151016     d c_F07           c                   const(x'37')
003200151016     d c_F08           c                   const(x'38')
003300151016     d c_F09           c                   const(x'39')
003400151016     d c_F10           c                   const(x'3A')
003500151016     d c_F11           c                   const(x'3B')
003600151016     d c_F12           c                   const(x'3C')
003700151016     d c_F13           c                   const(x'B1')
003800151016     d c_F14           c                   const(x'B2')
003900151016     d c_F15           c                   const(x'B3')
004000151016     d c_F16           c                   const(x'B4')
004100151016     d c_F17           c                   const(x'B5')
004200151016     d c_F18           c                   const(x'B6')
004300151016     d c_F19           c                   const(x'B7')
004400151016     d c_F20           c                   const(x'B8')
004500151016     d c_F21           c                   const(x'B9')
004600151016     d c_F22           c                   const(x'BA')
004700151016     d c_F23           c                   const(x'BB')
004800151016     d c_F24           c                   const(x'BC')
004900151016     d c_Enter         c                   const(x'F1')
005000151016     d c_RollDown      c                   const(x'F4')
005100151016     d c_RollUp        c                   const(x'F5')
005200151016
005300151016       //--------------------------------------------------------------
005400151016       //?Definizione schiere.                                         ?
005500151016       //--------------------------------------------------------------
005600151016
005700151016
005800151016       //--------------------------------------------------------------
005900151016       //?Definizione aree dati.                                       ?
006000151016       //--------------------------------------------------------------
006100151016
006200151016       // -?Dati utente?
006300151016     d §AzUte        e ds                  extname(AZUTE00F)
006400151016     d                                     dtaara
006500151016     d §DatiUte      e ds                  extname(dDatiUte)
006600151016     d                                     dtaara
006700151016
006800151016       //--------------------------------------------------------------
006900151016       //?Definizione strutture dati.                                  ?
007000151016       //--------------------------------------------------------------
007100151016
007200151016       // -?Status ds?
007300151016     d Status         sds
007400151016     d   SDSpgm          *proc
007500151016     d   SDSprm          *parms
007600151016     d   SDSusr              254    263
007700151016
007800151016       // -?InfDS?
007900151016     d InfDspF         ds
008000151016     d   dsp_aid             369    369a
008100151016
008200151016       // -?Indicatori su DspF?
008300151016     d IndDspF         ds
008400151016         // -?Abilitazione tasti funzionali?
008500151016     d   F6Attivo                      n   overlay( IndDspF : 06 )
008600151016     d   F12Attivo                     n   overlay( IndDspF : 12 )
008700160923     d   RUpAttivo                     n   overlay( IndDspF : 25 )
008800151016         // -?Emissione messaggio di errore?
008900151016     d   ErrMessage                    n   overlay( IndDspF : 28 )
009000151016         // -?Riemissione videata?
009100151016     d   ErrGenerico                   n   overlay( IndDspF : 99 )
009200151016
009300151016       //--------------------------------------------------------------
009400151016       //?Definizione variabili globali.                               ?
009500151016       //--------------------------------------------------------------
009600151016
009700151016       // -?Flags booleani?
009800151016     d $Fine           s               n   inz(*off)
009900151016     d $InzD01         s               n   inz(*on)
010000160923
010100160923       // -?Variabili per la gestione delle videate?
010200160923     d $Video          s              2    inz('D1')
010300151016
010400151016       //--------------------------------------------------------------
010500151016       //?Definizione procedure usate.                                 ?
010600151016       //--------------------------------------------------------------
010700151016
010800151016       // -?Verifica se C.F. di Pubblica Amministrazione?
010900151016     d trul70ds      e ds                  inz
011000160923     d AZIPAds       e ds                  inz
011100160923     d                                     extname(AZIPA00F)
011200151016     d trul70r         pr                  extpgm('TRUL70R')
011300151016     d   trul70ds                          likeds(trul70ds)
011400160923     d   AZIPAds                           likeds(AZIPAds)
011500151016
011600151016       //--------------------------------------------------------------
011700151016       //?Definizione key-list.                                        ?
011800151016       //--------------------------------------------------------------
011900151016
012000151016
012100151016       //--------------------------------------------------------------
012200151016       //?Riepilogo indicatori.                                        ?
012300151016       //--------------------------------------------------------------
012400151016
012500151016
012600151016       //--------------------------------------------------------------
012700151016       //?M A I N - L I N E                                            ?
012800151016       //--------------------------------------------------------------
012900151016
013000151016      /free
013100151016
013200151016       // -?Start?
013300151016       *inLR = *on;
013400151016
013500151016       // -?Elab?
013600160923       DoW  $Fine = *off;
013700160923         select;
013800160923           when  $Video = 'D1';
013900160923             exsr  sr_GesD01;
014000160923           when  $Video = 'D2';
014100160923             exsr  sr_GesD02;
014200160923           when  $Video = 'D3';
014300160923             exsr  sr_GesD03;
014400160923           other;
014500160923             $Fine = *on;
014600160923         endsl;
014700160923       EndDo;
014800151016
014900151016       // -?End?
015000151016       return;
015100151016
015200151016       //--------------------------------------------------------------
015300151016       //?Gestione videata D01                                         ?
015400151016       //--------------------------------------------------------------
015500151016       BEGSR  sr_GesD01;
015600151016
015700151016         // -?Inizializzazione videata?
015800151016         if  $InzD01 = *on;
015900151016           clear  ul70d1;
016000151016           $InzD01  = *off;
016100151016         endif;
016200151016
016300151016         F6Attivo  = *on;
016400151016         F12Attivo = *off;
016500151016
016600151016         // -?Emissione videata?
016700151016         if  Not ErrMessage;
016800151016           write  ul70t1;
016900151016           write  ul70z1;
017000151016         endif;
017100151016         exfmt  ul70d1;
017200151016
017300151016         reset  ErrMessage;
017400151016         reset  ErrGenerico;
017500151016         clear  V1Dmsg;
017600151016
017700151016         SELECT;
017800151016
017900151016           // -?F3=Fine?
018000151016           WHEN  dsp_aid = c_F03;
018100151016             $Fine = *on;
018200151016
018300151016           // -?Invio o F6=Conferma?
018400151016           OTHER;
018500151016             exsr sr_CtrD01;
018600151016             select;
018700151016               // -?rilevato errore?
018800151016               when  ErrGenerico = *on;
018900151016               // -?non premuto F6?
019000151016               when  dsp_aid <> c_F06;
019100151016               // -?richiamo da eseguire?
019200151016               other;
019300160923                 trul70r ( trul70ds : AZIPAds );
019400160923                 $Video = 'D2';
019500151016                 //reset $InzD01;
019600151016             endsl;
019700151016
019800151016         ENDSL;
019900151016
020000151016       ENDSR;
020100160923
020200160923       //--------------------------------------------------------------
020300160923       //?Gestione videata D02                                         ?
020400160923       //--------------------------------------------------------------
020500160923       BEGSR  sr_GesD02;
020600160923
020700160923         F6Attivo  = *off;
020800160923         F12Attivo = *on;
020900160923         RUpAttivo = ( oUL70esi = *on );
021000160923
021100160923         // -?Emissione videata?
021200160923         if  Not ErrMessage;
021300160923           write  ul70t1;
021400160923           write  ul70z1;
021500160923           write  ul70d1;
021600160923           write  Protect;
021700160923         endif;
021800160923         exfmt  ul70d2;
021900160923
022000160923         reset  ErrMessage;
022100160923         reset  ErrGenerico;
022200160923         clear  V1Dmsg;
022300160923
022400160923         SELECT;
022500160923
022600160923           // -?F3=Fine?
022700160923           WHEN  dsp_aid = c_F03;
022800160923             $Fine = *on;
022900160923
023000160923           // -?F12=Ritorno?
023100160923           WHEN  dsp_aid = c_F12;
023200160923             $Video = 'D1';
023300160923
023400160923           // -?Roll-Up?
023500160923           WHEN  dsp_aid = c_RollUp;
023600160923             $Video = 'D3';
023700160923
023800160923         ENDSL;
023900160923
024000160923       ENDSR;
024100160923
024200160923       //--------------------------------------------------------------
024300160923       //?Gestione videata D03                                         ?
024400160923       //--------------------------------------------------------------
024500160923       BEGSR  sr_GesD03;
024600160923
024700160923         F6Attivo  = *off;
024800160923         F12Attivo = *on;
024900160923         RUpAttivo = ( oUL70esi = *on );
025000160923
025100160923         // -?Emissione videata?
025200160923         if  Not ErrMessage;
025300160923           write  ul70t1;
025400160923           write  ul70z1;
025500160923           write  Protect;
025600160923         endif;
025700160923         exfmt  ul70d3;
025800160923
025900160923         reset  ErrMessage;
026000160923         reset  ErrGenerico;
026100160923         clear  V1Dmsg;
026200160923
026300160923         SELECT;
026400160923
026500160923           // -?F3=Fine?
026600160923           WHEN  dsp_aid = c_F03;
026700160923             $Fine = *on;
026800160923
026900160923           // -?F12=Ritorno?
027000160923           WHEN  dsp_aid = c_F12;
027100160923             $Video = 'D1';
027200160923
027300160923           // -?Roll-Down?
027400160923           WHEN  dsp_aid = c_RollDown;
027500160923             $Video = 'D2';
027600160923
027700160923         ENDSL;
027800160923
027900160923       ENDSR;
028000151016
028100151016       //--------------------------------------------------------------
028200151016       //?Controllo dati in videata D01                                ?
028300151016       //--------------------------------------------------------------
028400151016       BEGSR  sr_CtrD01;
028500151016
028600151016         %subst(IndDspF : 28) = *off;
028700151016
028800151016       ENDSR;
028900151016
029000151016      /end-free
