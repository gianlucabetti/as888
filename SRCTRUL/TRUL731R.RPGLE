000100160922      //--------------------------------------------------------------
000200160922      //?TRUL731R - Controllo Limiti Quantità Ritiri
000300160922      //--------------------------------------------------------------
000400160922     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000500160922
000600160922      //---------------------------------------------------------------
000700160922      //?Dichiarazione file.
000800160922      //---------------------------------------------------------------
000900160922
001000160922      //---------------------------------------------------------------
001100160922      //?Definizione costanti.
001200160922      //---------------------------------------------------------------
001300160922
001400160922      //---------------------------------------------------------------
001500160922      //?Definizione schiere.
001600160922      //---------------------------------------------------------------
001700160922      // - Messaggi di errore
001800160922     d Msg             s             78    dim(50) ctdata perrcd(1)
001900160922
002000160922      //---------------------------------------------------------------
002100160922      //?Definizione aree dati.
002200160922      //---------------------------------------------------------------
002300160922
002400160922      //---------------------------------------------------------------
002500160922      //?Definizione strutture dati.
002600160922      //---------------------------------------------------------------
002700160922      // - Parametri ricevuti
002800160922     d KPJBA         e ds
002900160922     d TRUL731DS     e ds
003000160922
003100160922      // - Ricerca/Controllo tabelle
003200160922     d TIBS02DS      e ds
003300160922
003400160922      // - Tabella LQR - limiti quantità ritiri
003500160922     d dLQR          e ds
003600160922
003700160922      //---------------------------------------------------------------
003800160922      //?Definizione variabili globali.
003900160922      //---------------------------------------------------------------
004000160922      // - Indici di schiera
004100011217     d xx              s              3  0
004200011217     d yy              s              3  0
004300160922
004400160922      //---------------------------------------------------------------
004500160922      //?Definizione Procedure.
004600160922      //---------------------------------------------------------------
004700160922
004800160922      //---------------------------------------------------------------
004900160922      //?Definizione Prototipi.
005000160922      //---------------------------------------------------------------
005100160922      /copy gaitrasrc/srcprotopr,TIBS02R
005200160922
005300160922      //---------------------------------------------------------------
005400160922      //?Definizione key-list.
005500160922      //---------------------------------------------------------------
005600160922
005700160922      //---------------------------------------------------------------
005800160922      //?M A I N - L I N E
005900160922      //---------------------------------------------------------------
006000160922     c     *Entry        plist
006100160922     c                   parm                    TRUL731DS
006200011019
006300160922      /free
006400160922
006500160922       //?Operazioni iniziali
006600160922       exsr RoutInz;
006700160922
006800160922       //?Elabora
006900160922       //?se tipo lancio 'C' devo fare solo la chiusura dei file
007000160922       IF  I731tla <> 'C';
007100160922         exsr Elabora;
007200160922       ENDIF;
007300160922
007400160922       //?Operazioni finali
007500160922       exsr RoutEnd;
007600160922
007700160922       //--------------------------------------------------------------
007800160922       //?Operazioni iniziali.
007900160922       //--------------------------------------------------------------
008000160922       BEGSR RoutInz;
008100160922
008200160922       //?Pulisco i dati di OUTPUT della ds
008300160922         clear O731lbncm;
008400160922         clear O731fbncm;
008500160922         clear O731lbncf;
008600160922         clear O731fbncf;
008700160922         clear O731lblcm;
008800160922         clear O731fblcm;
008900160922         clear O731lblcf;
009000160922         clear O731fblcf;
009100160922         clear O731lattm;
009200160922         clear O731fattm;
009300160922         clear O731lattf;
009400160922         clear O731fattf;
009500160922         clear O731lmtcm;
009600160922         clear O731fmtcm;
009700160922         clear O731lmtcf;
009800160922         clear O731fmtcf;
009900160922         clear O731err;
010000160922         clear O731msg;
010100160922
010200160922       //?Controllo tipo lancio
010300160922         IF  I731tla <> 'C' and I731tla <> 'L' and I731tla <> *blanks;
010400160922           clear I731tla;
010500160922         ENDIF;
010600160922
010700160922       //?Chiudo in LR o RT
010800160922         IF  I731tla <> *blanks;
010900160922           *inLR = *on;
011000160922         ELSE;
011100160922           *inRT = *on;
011200160922         ENDIF;
011300160922
011400160922       //?Aggancio la tabella LQR
011500160922         clear TIBS02DS;
011600160922         clear dLQR;
011700160922         T02mod = 'C';
011800160922         T02sif = knsif;
011900160922         T02cod = 'LQR';
012000160922         T02ke1 = '1';
012100160922         TNTBE_RicercaControllo (kpjba:tibs02ds);
012200160922         IF  T02err = *blanks;
012300160922           dLQR = T02uni;
012400160922         ELSE;
012500160922       //?se non trovo la tabella torno errore al chiamante
012600160922           O731err = '1';
012700160922           O731msg = 'Tabella non trovata. Telefonare Ufficio -
012800160922                      ICT di Sede';
012900160922         ENDIF;
013000160922
013100160922       ENDSR;
013200160922
013300160922       //--------------------------------------------------------------
013400160922       //?Elaborazione principale.
013500160922       //--------------------------------------------------------------
013600160922       BEGSR Elabora;
013700160922
013800160922         O731lbncm = §LQRbncm;
013900160922         O731lbncf = §LQRbncf;
014000160922         O731lblcm = §LQRblcm;
014100160922         O731lblcf = §LQRblcf;
014200160922         O731lattm = §LQRattm;
014300160922         O731lattf = §LQRattf;
014400160922         O731lmtcm = §LQRmtcm;
014500160922         O731lmtcf = §LQRmtcf;
014600160922
014700160922       //?Controllo i limiti impostati con i valori ricevuti
014800160922         IF  I731bnc > O731lbncm;
014900160922           O731fbncm = '1';
015000160922         ENDIF;
015100160922         IF  I731bnc > O731lbncf;
015200160922           O731fbncf = '1';
015300160922         ENDIF;
015400160922
015500160922         IF  I731blc > O731lblcm;
015600160922           O731fblcm = '1';
015700160922         ENDIF;
015800160922         IF  I731blc > O731lblcf;
015900160922           O731fblcf = '1';
016000160922         ENDIF;
016100160922
016200160922         IF  I731att > O731lattm;
016300160922           O731fattm = '1';
016400160922         ENDIF;
016500160922         IF  I731att > O731lattf;
016600160922           O731fattf = '1';
016700160922         ENDIF;
016800160922
016900160922         IF  I731mtc > O731lmtcm;
017000160922           O731fmtcm = '1';
017100160922         ENDIF;
017200160922         IF  I731mtc > O731lmtcf;
017300160922           O731fmtcf = '1';
017400160922         ENDIF;
017500160922
017600160922       ENDSR;
017700160922
017800160922       //--------------------------------------------------------------
017900160922       //?Operazioni finali.
018000160922       //--------------------------------------------------------------
018100160922       BEGSR RoutEnd;
018200160922
018300160922         return;
018400160922
018500160922       ENDSR;
018600160922
018700160922      /end-free
018800160922
018900160922       //--------------------------------------------------------------
019000160922       //?Schiere a tempo di compilazione.
019100160922       //--------------------------------------------------------------
019200160922
019300160922** -- MSG -------------------------------------------------------------------*
019400160922Tabella Limiti Quantità non trovata. Avvisare Ufficio ICT di Sede              01
