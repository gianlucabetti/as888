000100140402       //==============================================================
000200180109       //?Controllo / Calcola check digit
000300140402       //==============================================================
000400140402
000500140402       //--------------------------------------------------------------
000600140402       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700140402       //--------------------------------------------------------------
000800140402
000900140402     /*PRM  dbgview(*source)
001000140402     /*END
001100140402
001200140402       //--------------------------------------------------------------
001300140402       //?Specifiche di controllo.                                     ?
001400140402       //--------------------------------------------------------------
001500140402
001600140402     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001700140402
001800140402       //--------------------------------------------------------------
001900140402       //?Dichiarazione file.                                          ?
002000140402       //--------------------------------------------------------------
002100140402
002200140402
002300140402       //--------------------------------------------------------------
002400140402       //?Definizione costanti.                                        ?
002500140402       //--------------------------------------------------------------
002600140402
002700140402       // -?Costante per controllo "caratteri solo numerici"?
002800140402     d c_Digits        c                   const('0123456789')
002900140402
003000140402       //--------------------------------------------------------------
003100140402       //?Definizione schiere.                                         ?
003200140402       //--------------------------------------------------------------
003300140402
003400180109     D MSG             S             78    DIM(3) CTDATA PERRCD(1)
003500140402       //--------------------------------------------------------------
003600140402       //?Definizione aree dati.                                       ?
003700140402       //--------------------------------------------------------------
003800140402
003900140402
004000140402       //--------------------------------------------------------------
004100140402       //?Definizione strutture dati.                                  ?
004200140402       //--------------------------------------------------------------
004300140402
004400140402       // -?Parametri ricevuti?
004500180109     d TRULa8ds0     e ds
004600180109     D
004700180109     d TRUL28ds0     e ds
004800140402
004900140402       //--------------------------------------------------------------
005000140402       //?Definizione variabili globali.                               ?
005100140402       //--------------------------------------------------------------
005200140402
005300140402       // -?Indici di schiera?
005400140402     d xx              s              3  0 inz
005500140402
005600140402       // -?Lunghezza del codice ricevuto in Input?
005700140402     d wLen            s              3  0 inz
005800140402
005900140402       //--------------------------------------------------------------
006000140402       //?Definizione prototipi procedure.                             ?
006100140402       //--------------------------------------------------------------
006200180109      /copy gaitrasrc/srcprotopr,TRUL28R0
006300140402
006400140402       //--------------------------------------------------------------
006500140402       //?Definizione key-list.                                        ?
006600140402       //--------------------------------------------------------------
006700140402
006800140402
006900140402       //--------------------------------------------------------------
007000140402       //?M A I N - L I N E                                            ?
007100140402       //--------------------------------------------------------------
007200140402
007300140402     c     *Entry        plist
007400180109     c                   parm                    TRULa8ds0
007500140402
007600140402      /free
007700140402
007800140402       // -?Operazioni iniziali?
007900140402       exsr  sr_RoutInz;
008000140403
008100180109       // -?richiamo pgm di controllo/calcolo chck digit?
008200180109         clear trul28ds0  ;
008300180109         i280cod=ia80cod;
008400180109          trul28r0(trul28ds0);
008500180109          if o280err='1';
008600180109            oa80err='1'  ;
008700180109            oa80msg=msg(3)  ;
008800180109            else  ;
008900180109            oa80cod=o280cod  ;
009000180109          endif  ;
009100140402
009200140402       // -?Operazioni finali?
009300140402       exsr  sr_RoutEnd;
009400140402
009500140402       //--------------------------------------------------------------
009600140402       //?Operazioni iniziali.                                         ?
009700140402       //--------------------------------------------------------------
009800140402       BEGSR  sr_RoutInz;
009900140402
010000140402         *inLR = *on;
010100140402
010200140402         // -?Inizializzazione campi di Output?
010300180109         clear  oa80cod;
010400180109         clear  oa80MSG;
010500180109         oa80err = *off;
010600140402
010700140402         // -?Verifica dei parametri ricevuti:?
010800140402         // ·?Codice in input mancante?
010900180109         if  iA80cod = *blank  or  iA80cod = *zero;
011000180109           oa80err = *on;
011100180109           oa80MSG = MSG(1)  ;
011200140402           exsr  sr_RoutEnd;
011300140402         endif;
011400180109         // ·?tipo controllo  in input mancante?
011500180109         if  iA80tric<> 'K' AND iA80tric<> 'C'  ;
011600180109           oa80err = *on;
011700180109           oa80MSG = MSG(2)  ;
011800180109           exsr  sr_RoutEnd;
011900180109         endif;
012000140402
012100140402         // -?Calcolo del numero dei caratteri ricevuti?
012200180109         wLen = %len( %trimr( ia80cod ) );
012300140402
012400140402         // -?Verifica dei parametri ricevuti:?
012500140402         // ·?I caratteri devono essere 14 (solo n° spedizione)?
012600140402         //  ?                        o 19 (già completo)?
012700140402         if  wLen <> 14  and  wLen <> 19;
012800180109           oa80err = *on;
012900180109           oa80MSG = MSG(3)  ;
013000140402           exsr  sr_RoutEnd;
013100140402         endif;
013200180109         // ·?I caratteri devono essere 14  PER CALCOLO ?
013300180109         if  wLen <> 14  and  iA80tric=  'K'   ;
013400180109           oa80err = *on;
013500180109           oa80MSG = MSG(3)  ;
013600180109           exsr  sr_RoutEnd;
013700180109         endif  ;
013800180109         // ·?I caratteri devono essere 19 per il controllo?
013900180109         if  wLen <> 19  and  iA80tric=  'C'   ;
014000180109           oa80err = *on;
014100180109           oa80MSG = MSG(3)  ;
014200180109           exsr  sr_RoutEnd;
014300180109         endif  ;
014400140402         // ·?Tutti i caratteri devono essere numerici?
014500180109         if  %check( c_Digits : %subst( ia80cod : 1 : wLen ) ) > *zero;
014600180109           oa80err = *on;
014700180109           oa80MSG = MSG(3)  ;
014800140402           exsr  sr_RoutEnd;
014900140402         endif;
015000140402
015100140402       ENDSR;
015200140402
015300140402       //--------------------------------------------------------------
015400140402       //?Operazioni finali.                                           ?
015500140402       //--------------------------------------------------------------
015600140402       BEGSR  sr_RoutEnd;
015700140402
015800140402         return;
015900140402
016000140402       ENDSR;
016100180109**
016200180109BRTCODE non passato
016300180109Tipo controllo errato
016400180109BRTCODE errato
