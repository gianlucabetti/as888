000100100413      //---------------------------------------------------------------
000200120109      //?TRULBLCR - Verifica data inserimento blocco cliente
000300100413      //---------------------------------------------------------------
000400100413
000500100413     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000600100413
000700100413      //---------------------------------------------------------------
000800100413      //?Dichiarazione file.
000900100413      //---------------------------------------------------------------
001000110201      // - File Variazioni anagrafiche
001100110201     fCNACVT1L  if   e           k disk
001200100413      //---------------------------------------------------------------
001300100413      //?Definizione costanti.
001400100413      //---------------------------------------------------------------
001500100413
001600100413      //---------------------------------------------------------------
001700100413      //?Definizione schiere.
001800100413      //---------------------------------------------------------------
001900110323
002000100413      //---------------------------------------------------------------
002100100413      //?Definizione aree dati.
002200100413      //---------------------------------------------------------------
002300100413
002400100413      //---------------------------------------------------------------
002500100413      //?Definizione strutture dati.
002600100413      //---------------------------------------------------------------
002700100415
002800110131      // - Parametri ricevuti
002900100415     d KPJBA         e ds
003000110211
003100120109      // - Ricerca data insrimento blocco cliente
003200120109     d TRULBLCDS     e ds                  inz
003300110131
003400100413      //---------------------------------------------------------------
003500100413      //?Definizione variabili globali.
003600100413      //---------------------------------------------------------------
003700100413
003800100413      // - Flags booleani
003900100413     d $End            s               n   inz(*off)
004000110201     d $SiAcv          s               n   inz(*off)
004100110323
004200120109      // campi di comodo
004300120109     d K_acvkcc        s                   like(ACVkcc)
004400120109     d K_acvksc        s                   like(ACVksc)
004500110201     d wDatBlc         s                   like(ACVdav)
004600110201     d wOraBlc         s                   like(ACVorv)
004700110502
004800100413
004900100413      //---------------------------------------------------------------
005000100413      //?Definizione key-list.
005100100413      //---------------------------------------------------------------
005200100413
005300100413      //---------------------------------------------------------------
005400100413      //?Riepilogo indicatori.
005500100413      //---------------------------------------------------------------
005600100413
005700100413      //---------------------------------------------------------------
005800100413      //?M A I N - L I N E
005900100413      //---------------------------------------------------------------
006000100413
006100100413     c     *Entry        plist
006200110131     c                   parm                    kpjba
006300120109     c                   parm                    Trulblcds
006400100413
006500100413      /free
006600100413
006700100726       //?Elaboro
006800120109       If iblctla <> 'C' ;
006900120109         wDatBlc = 0 ;
007000120109         K_acvkcc = iblckcc ;
007100120109         K_acvKsc = iblcksc ;
007200120109         exsr Elabora;
007300120109       Endif ;
007400100413
007500100413       //?Operazioni finali
007600100513       exsr RoutEnd;
007700100413
007800100413       //--------------------------------------------------------------
007900110131       //?Elabora.
008000100413       //--------------------------------------------------------------
008100100513       BEGSR Elabora;
008200100413
008300100413         $End = *off;
008400100413
008500120109         //?Cerco la data della variazione
008600120109           $SiAcv = *off;
008700120109           setll (ACOkcc:ACOksc) CNACVT1L;
008800120109           reade (ACOkcc:ACOksc) CNACVT1L;
008900120109           DOW  not %eof(CNACVT1L);
009000120109             IF  %eof(CNACVT1L);
009100120109               leave;
009200120109             ENDIF;
009300120109             IF  ACVcta = 'M' and
009400120109                 %scan('B':ACVflo) > 0;
009500120109               $siAcv = *on;
009600120109               leave;
009700120109             ENDIF;
009800120109             reade (ACOkcc:ACOksc) CNACVT1L;
009900120109           ENDDO;
010000120109         //?se non trovo variazioni pulisco i campi della data e ora variazione
010100120109         //?e memorizzo la causale blocco
010200120109           IF not $SiAcv and wDatBlc = 0;
010300120109             clear ACVdav;
010400120109             clear ACVorv;
010500120109             wDatBlc = 00010101;
010600120109           ENDIF;
010700120109
010800120109         //?se data più alta memorizzo la data/ora variazione
010900120109           IF  ACVdav > wDatBlc or
011000120109               ACVdav = wDatBlc ;
011100120109             wDatBlc = ACVdav;
011200120109           ENDIF;
011300110315
011400100413       ENDSR;
011500110201
011600100413       //--------------------------------------------------------------
011700100413       //?Operazioni finali.
011800100413       //--------------------------------------------------------------
011900100513       BEGSR RoutEnd;
012000100413
012100120109         oblcdav = WdtaBlc ;
012200120109
012300120109         If iblctla = 'L' ;
012400120109           *inRT = *on;
012500120109         else ;
012600120109           *inLR = *on;
012700120109         Endif ;
012800100413
012900100413       ENDSR;
013000100413
013100100413      /end-free
