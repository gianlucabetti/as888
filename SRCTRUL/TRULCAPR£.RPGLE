000100120423       //==============================================================
000200120423       //?Estrazione file Località Cappario.                           ?
000300120423       //==============================================================
000400120423
000500120423       //--------------------------------------------------------------
000600120423       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700120423       //--------------------------------------------------------------
000800120423
000900120423     /*PRM  dbgview(*source)
001000120423     /*END
001100120423
001200120423       //--------------------------------------------------------------
001300120423       //?Specifiche di controllo.                                     ?
001400120423       //--------------------------------------------------------------
001500120423
001600120423     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001700120423     h dftactgrp(*no)
001800120423
001900120423       //--------------------------------------------------------------
002000120423       //?Dichiarazione file.                                          ?
002100120423       //--------------------------------------------------------------
002200120423
002300120423       // -?Video?
002400120423     fTRULCAPD  cf   e             workstn
002500120423     f                                     indds(IndDspF)
002600120423     f                                     infds(InfDspF)
002700120423
002800120423       //--------------------------------------------------------------
002900120423       //?Definizione costanti.                                        ?
003000120423       //--------------------------------------------------------------
003100120423
003200120423       // -?Tasti funzionali a video?
003300120423     d c_F01           c                   const(x'31')
003400120423     d c_F02           c                   const(x'32')
003500120423     d c_F03           c                   const(x'33')
003600120423     d c_F04           c                   const(x'34')
003700120423     d c_F05           c                   const(x'35')
003800120423     d c_F06           c                   const(x'36')
003900120423     d c_F07           c                   const(x'37')
004000120423     d c_F08           c                   const(x'38')
004100120423     d c_F09           c                   const(x'39')
004200120423     d c_F10           c                   const(x'3A')
004300120423     d c_F11           c                   const(x'3B')
004400120423     d c_F12           c                   const(x'3C')
004500120423     d c_F13           c                   const(x'B1')
004600120423     d c_F14           c                   const(x'B2')
004700120423     d c_F15           c                   const(x'B3')
004800120423     d c_F16           c                   const(x'B4')
004900120423     d c_F17           c                   const(x'B5')
005000120423     d c_F18           c                   const(x'B6')
005100120423     d c_F19           c                   const(x'B7')
005200120423     d c_F20           c                   const(x'B8')
005300120423     d c_F21           c                   const(x'B9')
005400120423     d c_F22           c                   const(x'BA')
005500120423     d c_F23           c                   const(x'BB')
005600120423     d c_F24           c                   const(x'BC')
005700120423     d c_Enter         c                   const(x'F1')
005800120423     d c_RollDown      c                   const(x'F4')
005900120423     d c_RollUp        c                   const(x'F5')
006000120423
006100120423       //--------------------------------------------------------------
006200120423       //?Definizione schiere.                                         ?
006300120423       //--------------------------------------------------------------
006400120423
006500120423       // -?Messaggi di errore?
006600120423     d $Msg            s             78    dim( 1)  ctdata  perrcd(1)
006700120423
006800120423       //--------------------------------------------------------------
006900120423       //?Definizione aree dati.                                       ?
007000120423       //--------------------------------------------------------------
007100120423
007200120423       // -?Dati utente?
007300120423     d §AzUte        e ds                  extname(AZUTE00F)
007400120423     d                                     dtaara
007500120423     d §DatiUte      e ds                  extname(dDatiUte)
007600120423     d                                     dtaara
007700120423
007800120423       //--------------------------------------------------------------
007900120423       //?Definizione strutture dati.                                  ?
008000120423       //--------------------------------------------------------------
008100120423
008200120423       // -?Status ds?
008300120423     d Status         sds
008400120423     d   SDSpgm          *proc
008500120423
008600120423       // -?InfDS?
008700120423     d InfDspF         ds
008800120423     d   dsp_aid             369    369a
008900120423
009000120423       // -?Indicatori su DspF?
009100120423     d IndDspF         ds                  inz
009200120423         // -?Abilitazione tasti funzionali?
009300120423         // -?Emissione messaggio di errore?
009400120423     d   ErrMessage                    n   overlay(IndDspF : 28)
009500120423         // -?Indicatori per Attibuti di visualizzazione?
009600120423         // -?Posizionamento cursore & segnalazione errore?
009700120423     d   PosCurVER                     n   overlay(IndDspF : 51)
009800120423         //   -?Riemissione videata?
009900120423     d   ErrGenerico                   n   overlay(IndDspF : 99)
010000120423
010100120423       // -?Parametri ricevuti & per batch?
010200120423     d KPJBA         e ds
010300120423     d trulCAPds       ds                  inz
010400120423     d   V1Cver
010500120423
010600120423       // -?Parametri per Reperimento dati utente?
010700120423     d TIBS34ds      e ds
010800120423
010900120423       //--------------------------------------------------------------
011000120423       //?Definizione variabili globali.                               ?
011100120423       //--------------------------------------------------------------
011200120423
011300120423       // -?Flags booleani?
011400120423     d $Fine           s               n   inz
011500120423     d $InzD01         s               n   inz(*on)
011600120423
011700120423       // -?Variabili per la gestione del video?
011800120423     d $Video          s              2    inz('D1')
011900120423
012000120423       //--------------------------------------------------------------
012100120423       //?Definizione prototipi procedure.                             ?
012200120423       //--------------------------------------------------------------
012300120423
012400120423       // -?Reperimento dati utente?
012500120423      /copy gaitrasrc/srcProtoPR,TIBS34R
012600120423
012700120423       // -?Sottomissione lavoro batch?
012800120423      /copy gaitrasrc/srcProtoPR,BCH10
012900120423
013000120423       // -?Richiamo diretto lavoro batch?
013100120423     d trulCAPc        pr                  extpgm('TRULCAPC')
013200120423     d   kpjba                             likeds(KPJBA)
013300120423
013400120423       //--------------------------------------------------------------
013500120423       //?Definizione key-list.                                        ?
013600120423       //--------------------------------------------------------------
013700120423
013800120423
013900120423       //--------------------------------------------------------------
014000120423       //?M A I N - L I N E                                            ?
014100120423       //--------------------------------------------------------------
014200120423
014300120423     c     *Entry        plist
014400120423     c                   parm                    KPJBA
014500120423
014600120423      /free
014700120423
014800120423       // -?Operazioni iniziali?
014900120423       exsr  sr_RoutInz;
015000120423
015100120423       // -?Ciclo di gestione del file video?
015200120423       DOW  $Fine = *off;
015300120423         exsr  sr_GesD01;
015400120423       ENDDO;
015500120423
015600120423       // -?Operazioni finali?
015700120423       exsr  sr_RoutEnd;
015800120423
015900120423       //--------------------------------------------------------------
016000120423       //?Operazioni iniziali.                                         ?
016100120423       //--------------------------------------------------------------
016200120423       BEGSR  sr_RoutInz;
016300120423
016400120423         *inLR = *on;
016500120423
016600120423         // -?Reperimento dati job?
016700120423         exsr  sr_DatiJob;
016800120423
016900120423         // -?Impostazione nome programma a video?
017000120423         V1Tpgm = SDSpgm;
017100120423
017200120423       ENDSR;
017300120423
017400120423       //--------------------------------------------------------------
017500120423       //?Reperimento Dati del job (Utente/Operativi).                 ?
017600120423       //--------------------------------------------------------------
017700120423       BEGSR  sr_DatiJob;
017800120423
017900120423         in(E) §AzUte;
018000120423         if NOT %error;
018100120423           in(E) §DatiUte;
018200120423         endif;
018300120423         if %error or RSut = *blanks;
018400120423           clear TIBS34ds;
018500120423           tibs34r ( tibs34ds );
018600120423           in §AzUte;
018700120423           in §DatiUte;
018800120423         endif;
018900120423
019000120423       ENDSR;
019100120423
019200120423       //--------------------------------------------------------------
019300120423       //?Gestione videata D01.                                        ?
019400120423       //--------------------------------------------------------------
019500120423       BEGSR  sr_GesD01;
019600120423
019700120423         // -?Inizializzazione videata?
019800120423         if  $InzD01 = *on;
019900120423           clear  ulCapD1;
020000120423           $InzD01 = *off;
020100120423         endif;
020200120423
020300120423         // -?Emissione videata?
020400120423         write  ULCAPT1;
020500120423         exfmt  ULCAPD1;
020600120423
020700120423         clear  V1Dmsg;
020800120423         reset  ErrMessage;
020900120423         reset  ErrGenerico;
021000120423
021100120423         SELECT;
021200120423
021300120423           // -?F3=Fine?
021400120423           WHEN  dsp_aid = c_F03;
021500120423             $Fine = *on;
021600120423
021700120423           // -?Invio / F6=Conferma?
021800120423           OTHER;
021900120423             exsr  sr_CtrD01;
022000120423             select;
022100120423               when  ErrGenerico = *on;
022200120423                 leavesr;
022300120423               when  dsp_aid = c_F06;
022400120423                 exsr  sr_SbmJob;
022500120423                 $Fine = *on;
022600120423             endsl;
022700120423
022800120423         ENDSL;
022900120423
023000120423       ENDSR;
023100120423
023200120423       //--------------------------------------------------------------
023300120423       //?Controllo dati immessi nella videata D01.                    ?
023400120423       //--------------------------------------------------------------
023500120423       BEGSR  sr_CtrD01;
023600120423
023700120423         // -?Spegnimento indicatori di posizionamento cursore?
023800120423         %subst(IndDspF : 28) = *off;
023900120423
024000120423         Select;
024100120423
024200120423           // -?Controllo immissione codice completo?
024300120423           When  V1Cver <= *zero;
024400120423             ErrMessage  = *on;
024500120423             ErrGenerico = *on;
024600120423             PosCurVER   = *on;
024700120423             V1Dmsg = $Msg(01);
024800120423             leavesr;
024900120423
025000120423         EndSl;
025100120423
025200120423       ENDSR;
025300120423
025400120423       //--------------------------------------------------------------
025500120423       //?Sottomissione del lavoro.                                    ?
025600120423       //--------------------------------------------------------------
025700120423       BEGSR  sr_SbmJob;
025800120423
025900120423         // -?Impostazione parametri?
026000120423         kcoaz = 'ULCA';
026100120423         kpjbu = TrulCAPds;
026200120423
026300120423         if  knmus = *all'1';
026400120423           // -?Richiamo interattivo?
026500120423           trulCAPc ( kpjba );
026600120423         else;
026700120423           // -?Sottomissione batch?
026800120423            bch10 ( kpjba );
026900120423         endif;
027000120423
027100120423       ENDSR;
027200120423
027300120423       //--------------------------------------------------------------
027400120423       //?Operazioni finali.                                           ?
027500120423       //--------------------------------------------------------------
027600120423       BEGSR  sr_RoutEnd;
027700120423
027800120423         // -?Chiusura pgm?
027900120423         return;
028000120423
028100120423       ENDSR;
028200120423
028300120423      /end-free
028400120423
028500120423       //--------------------------------------------------------------
028600120423       //?Schiere a tempo di compilazione.
028700120423       //--------------------------------------------------------------
028800120423
028900120423** -?$Msg:?Messaggi di Errore?---------------------------------------*
029000120423Versione Cappario obbligatoria                                          1
