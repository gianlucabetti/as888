000100090319      *PARMS dftactgrp(*no) actgrp(*caller) dbgview(*source)
000200090319       //--------------------------------------------------------------
000300090319       //?Gestione KPJBU per singola azione                            ?
000400090319       //--------------------------------------------------------------
000500090319
000600090319     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000700090319     h dftactgrp(*no) actgrp(*caller)
000800090319
000900090319       //--------------------------------------------------------------
001000090319       //?Dichiarazione file.                                          ?
001100090319       //--------------------------------------------------------------
001200090319
001300090319       // - Video gestione tabella "SCK"
001400090319     fTRULKPJD  cf   e             workstn
001500090319     f                                     indds(IndDspF)
001600090319     f                                     infds(InfDspF)
001700090319
001800090319       //--------------------------------------------------------------
001900090319       //?Definizione costanti.                                        ?
002000090319       //--------------------------------------------------------------
002100090319
002200090319       // - Tasti funzionali a video
002300090319     d c_F01           c                   const(x'31')
002400090319     d c_F02           c                   const(x'32')
002500090319     d c_F03           c                   const(x'33')
002600090319     d c_F05           c                   const(x'35')
002700090319     d c_F06           c                   const(x'36')
002800090319     d c_F07           c                   const(x'37')
002900090319     d c_F08           c                   const(x'38')
003000090319     d c_F09           c                   const(x'39')
003100090319     d c_F10           c                   const(x'3A')
003200090319     d c_F12           c                   const(x'3C')
003300090319     d c_F13           c                   const(x'B1')
003400090319     d c_F14           c                   const(x'B2')
003500090319     d c_F15           c                   const(x'B3')
003600090319     d c_F16           c                   const(x'B4')
003700090319     d c_F17           c                   const(x'B5')
003800090319     d c_F18           c                   const(x'B6')
003900090319     d c_F19           c                   const(x'B7')
004000090319     d c_F20           c                   const(x'B8')
004100090319     d c_F21           c                   const(x'B9')
004200090319     d c_F22           c                   const(x'BA')
004300090319     d c_F23           c                   const(x'BB')
004400090319     d c_F24           c                   const(x'BC')
004500090319     d c_Enter         c                   const(x'F1')
004600090319     d c_RollDown      c                   const(x'F4')
004700090319     d c_RollUp        c                   const(x'F5')
004800090319
004900090319       //--------------------------------------------------------------
005000090319       //?Definizione schiere.                                         ?
005100090319       //--------------------------------------------------------------
005200090319
005300090319
005400090319       //--------------------------------------------------------------
005500090319       //?Definizione aree dati.                                       ?
005600090319       //--------------------------------------------------------------
005700090319
005800090319       // - Dati utente
005900090319     d §AzUte        e ds                  extname(AZUTE00F)
006000090319     d                                     dtaara
006100090319     d §DatiUte      e ds                  extname(dDatiUte)
006200090319     d                                     dtaara
006300090319
006400090319       //--------------------------------------------------------------
006500090319       //?Definizione strutture dati.                                  ?
006600090319       //--------------------------------------------------------------
006700090319
006800090319       // - Status
006900090319     d Psds           sds
007000090319     d   SDSpgm          *proc
007100090319
007200090319       // - InfDS
007300090319     d InfDspF         ds
007400090319     d   dsp_aid             369    369a                                        AID byte
007500090319
007600090319       // - Indicatori su DspF
007700090319     d IndDspF         ds
007800090319        // - Indicatori di errore
007900090319     d  ErrMessage                    1n   overlay(IndDspF : 28)
008000090319     d  ErrGenerico                   1n   overlay(IndDspF : 99)
008100090319
008200090319       // - Parametri ricevuti
008300090319     d KPJBA         e ds
008400090319     d TRULKPJds     e ds
008500090319
008600090319       // - Reperimento dati utente
008700090319     d TIBS34ds      e ds
008800090319
008900090319       //--------------------------------------------------------------
009000090319       //?Definizione variabili globali.                               ?
009100090319       //--------------------------------------------------------------
009200090319
009300090319       // - Flags booleani
009400090319     d $Fine           s               n   inz(*off)
009500090319     d $InzD01         s               n   inz(*on)
009600090319
009700090319       // - Campi associati al video
009800090319     d $Video          s              2    inz('D1')
009900090319
010000090319       //--------------------------------------------------------------
010100090319       //?Definizione procedure usate.                                 ?
010200090319       //--------------------------------------------------------------
010300090319
010400090319       // - Reperimento dati utente
010500090319      /copy gaitrasrc/srcProtoPr,TIBS34R
010600090319
010700090319       //--------------------------------------------------------------
010800090319       //?Definizione key-list.                                        ?
010900090319       //--------------------------------------------------------------
011000090319
011100090319
011200090319       //--------------------------------------------------------------
011300090319       //?M A I N - L I N E                                            ?
011400090319       //--------------------------------------------------------------
011500090319
011600090319     c     *Entry        plist
011700090319     c                   parm                    KPJBA
011800090319     c                   parm                    TRULKPJds
011900090319
012000090319      /free
012100090319
012200090319       // - Operazioni iniziali
012300090319       exsr  sr_RoutInz;
012400090319
012500090319       // - Gestione video
012600090319       DOW  $Fine = *off;
012700090319         select;
012800090319           when  $Video = 'D1';
012900090319             exsr  sr_GesD01;
013000090319           other;
013100090319             $Fine = *on;
013200090319         endsl;
013300090319       ENDDO;
013400090319
013500090319       // - Operazioni finali
013600090319       exsr  sr_RoutEnd;
013700090319
013800090319       //--------------------------------------------------------------
013900090319       //?Operazioni iniziali.                                         ?
014000090319       //--------------------------------------------------------------
014100090319       BEGSR  sr_RoutInz;
014200090319
014300090319         *inLR = *on;
014400090319
014500090319         // - Impostazione nome programma a video
014600090319         V1Tpgm = SDSpgm;
014700090319
014800090319         // - Reperimento dati job
014900090319         exsr  sr_DatiJob;
015000090319
015100090319       ENDSR;
015200090319
015300090319       //--------------------------------------------------------------
015400090319       //?Reperimento Dati del job (Utente/Operativi).                 ?
015500090319       //--------------------------------------------------------------
015600090319       BEGSR  sr_DatiJob;
015700090319
015800090319         in(E) §AzUte;
015900090319         if  NOT %error;
016000090319           in(E) §DatiUte;
016100090319         endif;
016200090319         if  %error   or   RSut = *blank;
016300090319           clear  TIBS34ds;
016400090319           tibs34r(tibs34ds);
016500090319           in  §AzUte;
016600090319           in  §DatiUte;
016700090319         endif;
016800090319
016900090319       ENDSR;
017000090319
017100090319       //--------------------------------------------------------------
017200090319       //?Gestione videata D01                                         ?
017300090319       //--------------------------------------------------------------
017400090319       BEGSR  sr_GesD01;
017500090319
017600090319         // - Inizializzazione videata
017700090319         if  $InzD01   = *on;
017800090319           exsr  sr_InzD01;
017900090319           $InzD01  = *off;
018000090319         endif;
018100090319
018200090319         // - Emissione Testata e Piede con tasti funzionali abilitati
018300090319         if  ErrGenerico = *off;
018400090319           write  trkuT01;
018500090319           write  trkuP01;
018600090319         endif;
018700090319
018800090319         // - Emissione videata
018900090319         exfmt  trkuD01;
019000090319
019100090319         reset  ErrMessage;
019200090319         reset  ErrGenerico;
019300090319         clear  V1Dmsg;
019400090319
019500090319         SELECT;
019600090319
019700090319           // - F3=Fine
019800090319           WHEN  dsp_aid = c_F03;
019900090319             exsr sr_F03D01;
020000090319
020100090319           // - F12=Ritorno
020200090319           WHEN  dsp_aid = c_F12;
020300090319             exsr sr_F12D01;
020400090319
020500090319           // - Invio / F6=Conferma
020600090319           OTHER;
020700090319             exsr  sr_CtrD01;
020800090319             if  ErrGenerico = *on;
020900090319               leavesr;
021000090319             endif;
021100090319             if  dsp_aid = c_F06;
021200090319               exsr sr_F06D01;
021300090319             endif;
021400090319
021500090319         ENDSL;
021600090319
021700090319       ENDSR;
021800090319
021900090319       //--------------------------------------------------------------
022000090319       //?Inizializzazione videata D01                                 ?
022100090319       //--------------------------------------------------------------
022200090319       BEGSR  sr_InzD01;
022300090319
022400090319         // - Pulizia videata
022500090319         clear  trkuD01;
022600090319
022700090319         // - Caricamento dei dati da presentare a video
022800090319         VKPJBU01 = %subst(OKPJkpjbu :   1 : 50);
022900090319         VKPJBU02 = %subst(OKPJkpjbu :  51 : 50);
023000090319         VKPJBU03 = %subst(OKPJkpjbu : 101 : 50);
023100090319         VKPJBU04 = %subst(OKPJkpjbu : 151 : 50);
023200090319         VKPJBU05 = %subst(OKPJkpjbu : 201 : 50);
023300090319         VKPJBU06 = %subst(OKPJkpjbu : 251 :  6);
023400090319
023500090319       ENDSR;
023600090319
023700090319       //--------------------------------------------------------------
023800090319       //?Gestione tasto funzionale F3 da videata D01                  ?
023900090319       //?F3=Fine                                                      ?
024000090319       //--------------------------------------------------------------
024100090319       BEGSR  sr_F03D01;
024200090319
024300090319         // - Restituzione indicazione del tasto premuto al chiamante
024400090319         OKPJopz = 'F03';
024500090319
024600090319         // - Chiusura del programma
024700090319         $Fine = *on;
024800090319
024900090319       ENDSR;
025000090319
025100090319       //--------------------------------------------------------------
025200090319       //?Gestione tasto funzionale F6 da videata D01                  ?
025300090319       //?F6=Conferma                                                  ?
025400090319       //--------------------------------------------------------------
025500090319       BEGSR  sr_F06D01;
025600090319
025700090319         // - Restituzione parametri impostati a video
025800090319         OKPJkpjbu = VKPJBU01 + VKPJBU02 + VKPJBU03 +
025900090319                     VKPJBU04 + VKPJBU05 + VKPJBU06;
026000090319
026100090319         // - Restituzione indicazione del tasto premuto al chiamante
026200090319         OKPJopz = 'F06';
026300090319
026400090319         // - Chiusura del programma
026500090319         $Fine = *on;
026600090319
026700090319       ENDSR;
026800090319
026900090319       //--------------------------------------------------------------
027000090319       //?Gestione tasto funzionale F12 da videata D01                 ?
027100090319       //?F12=Ritorno                                                  ?
027200090319       //--------------------------------------------------------------
027300090319       BEGSR  sr_F12D01;
027400090319
027500090319         // - Restituzione indicazione del tasto premuto al chiamante
027600090319         OKPJopz = 'F12';
027700090319
027800090319         // - Chiusura del programma
027900090319         $Fine = *on;
028000090319
028100090319       ENDSR;
028200090319
028300090319       //--------------------------------------------------------------
028400090319       //?Controllo videata D01                                        ?
028500090319       //--------------------------------------------------------------
028600090319       BEGSR  sr_CtrD01;
028700090319
028800090319         IndDspF  = *off;
028900090319
029000090319       ENDSR;
029100090319
029200090319       //--------------------------------------------------------------
029300090319       //?Operazioni finali.                                           ?
029400090319       //--------------------------------------------------------------
029500090319       BEGSR sr_RoutEnd;
029600090319
029700090319         return;
029800090319
029900090319       ENDSR;
030000090319
030100090319      /end-free
