000100130911      //---------------------------------------------------------------
000200131108      //?TRULORFR - Visualizza Orari di Filiale
000300130911      //---------------------------------------------------------------
000400130911     h decedit('0,') datedit(*ymd.) option(*nodebugio)
000500130911     h dftactgrp(*no) actgrp(*caller)
000600130911
000700130911      //---------------------------------------------------------------
000800130911      //?Dichiarazione file.
000900130911      //---------------------------------------------------------------
001000130911
001100131112     fazorg01l  if   e           k disk
001200130911       // -?File video
001300131108     fTRULORFD  cf   e             workstn
001400130911
001500130911      //---------------------------------------------------------------
001600130911      //?Definizione costanti.
001700130911      //---------------------------------------------------------------
001800130911
001900130911      //---------------------------------------------------------------
002000130911      //?Definizione schiere.
002100130911      //---------------------------------------------------------------
002200130911
002300130911      //---------------------------------------------------------------
002400130911      //?Definizione aree dati.
002500130911      //---------------------------------------------------------------
002600130911
002700130911      //---------------------------------------------------------------
002800130911      //?Definizione strutture dati.
002900130911      //---------------------------------------------------------------
003000130911
003100130911      // - Parametri ricevuti
003200130911     d KPJBA         e ds
003300131108     d TRULORFds     e ds
003400131112
003500131112     d og129         e ds
003600131112     d og130         e ds
003700130911
003800130911
003900130911      //---------------------------------------------------------------
004000130911      //?Definizione variabili globali.
004100130911      //---------------------------------------------------------------
004200130911
004300131112     d w0040           s              4  0
004400131112     d w0040a          s              4  0
004500130911      // - Flags booleani
004600130911     d wFine           s               n   inz(*off)
004700130925
004800130911
004900130911      //---------------------------------------------------------------
005000130911      //?Definizione procedure esterne.
005100130911      //---------------------------------------------------------------
005200130911
005300130911
005400130911      //---------------------------------------------------------------
005500130911      //?Definizione prototipi.
005600130911      //---------------------------------------------------------------
005700130911
005800130911      //---------------------------------------------------------------
005900130911      //?Definizione key-list.
006000130911      //---------------------------------------------------------------
006100130911
006200130911      //---------------------------------------------------------------
006300130911      //?Main.
006400130911      //---------------------------------------------------------------
006500130911
006600130911     c     *Entry        plist
006700130911     c                   parm                    KPJBA
006800131108     c                   parm                    trulorfds
006900130911
007000130911      /free
007100130911
007200130911       //?Operazioni iniziali
007300130911       exsr RoutInz;
007400130911
007500130911       //?Elaboro
007600130911       DOW  wFine = *off;
007700130911         exsr Elabora;
007800130911       ENDDO;
007900130911
008000130911       //?Operazioni finali
008100130911       exsr RoutEnd;
008200130911
008300130911       //--------------------------------------------------------------
008400130911       //?Operazioni iniziali.
008500130911       //--------------------------------------------------------------
008600130911       BEGSR RoutInz;
008700130911
008800131112         clear OORFerr;
008900131112         clear OORFmsg;
009000130911
009100130911       //?Se non ho la Linea di riferimento esco dal pgm con errore
009200131112         IF  IORFfil = *zeros;
009300131112           OORFerr = '1';
009400131112           OORFmsg = 'Manca la filiale di riferimento';
009500130911           wFine = *on;
009600130911           leavesr;
009700130911         ENDIF;
009800130912
009900131016       //?Se non ho riga posizionamento WIN imposto riga 13
010000131112         IF  IORFrig = *zeros ;
010100131113           IORFrig = 06;
010200130912         ENDIF;
010300131016       //?Se non ho colonna posizionamento WIN imposto colonna 2
010400131112         IF  IORFcol = *zeros;
010500131113           IORFcol = 28;
010600130912         ENDIF;
010700130925
010800130911
010900130911       ENDSR;
011000130911
011100130911       //--------------------------------------------------------------
011200130911       //?Elabora.
011300130911       //--------------------------------------------------------------
011400130911       BEGSR Elabora;
011500130911
011600130911         wFine = *on;
011700130911
011800131112         clear ULORFW01C;
011900131015
012000130912
012100131112         W1rig = IORFrig;
012200131112         W1col = IORFcol;
012300131016
012400131112         //  con la filiale ricevuta chaino azorg
012500131112         chain iorffil  azorg01l;
012600131112         if %founD(azorg01l) and (orgfag='F' or orgfag='A');
012700131112         // dati di filiale
012800131112            orfdes=orgdes;
012900131112            orfind=orgind;
013000131112            orfloc=%editc(orgcpf:'X') + ' ' + %trim(orgloc)
013100131112            + ' (' + orgpro + ')';
013200131112            og129=orgdc9;
013300131113            if §ogorfmd>*zeros;
013400131113               w0040=%int(§OGORFMd);
013500131113               w0040a=%int(§OGORFMa);
013600131113               orfore = %editW(w0040:'  :  ')  + ' - ' + %editw(w0040a:'  :  ');
013700131113            endif;
013800131113            if §OGORFpD>*zeros;
013900131113               w0040=%int(§OGORFpd);
014000131113               w0040a=%int(§OGORFpa);
014100131113               orfore = %trim(orfore ) + '  ' + %editW(w0040:'  :  ')
014200131113               + ' - ' + %editw(w0040a:'  :  ');
014300131113            endif;
014400131112         // dati servizio clienti
014500131112            orftel=orgtel;
014600131112            og130=orgdd0;
014700131113            if §OGORamD>*zeros;
014800131113               w0040=%int(§OGORaMd);
014900131113               w0040a=%int(§OGOraMa);
015000131113               orforesc=%editW(w0040:'  :  ')  + ' - ' + %editw(w0040a:'  :  ');
015100131113            endif;
015200131113            if §OGORapD>*zeros;
015300131113               w0040=%int(§OGORapd);
015400131113               w0040a=%int(§OGORapa);
015500131113               orforesc = %trim(orforesc) + '  ' + %editW(w0040:'  :  ')
015600131113               + ' - ' + %editw(w0040a:'  :  ');
015700131113            endif;
015800131113            orffax=orgfax;
015900131113            if orgdd2<>*blanks;
016000131113               orfmail=%trim(orgdd2) + '@brt.it'        ;
016100131113            endif;
016200131113            exfmt  ULORFW01C;
016300131112         else;
016400131113           OORFerr = '1';
016500131113           OORFmsg = 'Il Codice ricevuto non è di filiale';
016600131112         endif;
016700130925
016800130911       ENDSR;
016900130911
017000130911       //--------------------------------------------------------------
017100130911       //?Operazioni finali.
017200130911       //--------------------------------------------------------------
017300130911       BEGSR RoutEnd;
017400130911
017500131120         WRITE ULORFASS     ;
017600130911         *inLR = *on;
017700130911         return;
017800130911
017900130911       ENDSR;
018000130911
018100130911      /end-free
