000100100715     ***************************************************************************
000200100715     **
000300100715     ** Questo programma riceve un anno e restituisce la data della Pasqua
000400100715     ** cattolica e ortodossa.
000500100715     **
000600100715     ***************************************************************************
000700110325     H DFTACTGRP(*NO) ACTGRP(*CALLER) BNDDIR('QC2LE')
000800100714
000900100715     ***************************************************************************
001000100715     **
001100100715     ** Prototipi.
001200100715     **
001300100715     ***************************************************************************
001400100715     D floor           PR             8F   EXTPROC('floor')
001500100715     D  double                        8F   VALUE
001600100714
001700100715     ***************************************************************************
001800100715     **
001900100715     ** Campi.
002000100715     **
002100100715     ***************************************************************************
002200100715     D anno            S              4S 0
002300100715     D pasquaC         S               D   DATFMT(*ISO)                         Pasqua cattolica
002400100715     D pasquaO         S               D   DATFMT(*ISO)                         Pasqua ortodossa
002500100715     D esito           S             10I 0
002600100715     D jDay            S              2S 0
002700100715     D wDay            S              2S 0
002800100715     D oDay            S              2S 0
002900100715     D r               S              2S 0
003000100715     D s               S              2S 0
003100100715     D g               S             10I 0
003200100715     D i               S             10I 0
003300100715     D j               S             10I 0
003400100715     D p               S             10I 0
003500100715     D a               S             10I 0
003600100715     D c               S             10I 0
003700100715     D h               S             10I 0
003800100715     D b               S             10I 0
003900100715     D d               S             10I 0
004000100715     D q               S             10I 0
004100100715     D extra           S             10I 0
004200100715     D tmp             S             10I 0
004300100715
004400100715     ***************************************************************************
004500100715     **
004600100715     ** Parametri.
004700100715     **
004800100715     ***************************************************************************
004900100715     C     *ENTRY        PLIST
005000100715     C                   PARM                    anno
005100100715     C                   PARM                    esito
005200100715     C                   PARM                    pasquaC
005300100715     C                   PARM                    pasquaO
005400100715
005500100714      /FREE
005600100714
005700100715       CLEAR esito;
005800100715       CLEAR pasquaC;
005900100715
006000100715       IF %PARMS() > 3;
006100100715         CLEAR pasquaO;
006200100715       ENDIF;
006300100715
006400100715       IF ((anno <= 325) OR (anno > 4099));
006500100715         esito = -1;
006600100715         RETURN;
006700100715       ENDIF;
006800100714
006900100715       IF ((anno > 325) AND (anno <= 1582));
007000100714
007100100715         g = %REM(anno : 19);
007200100714         i = %REM(19 * g + 15 : 30);
007300100715         j = %REM((anno + %INT(floor(anno / 4) + i)) : 7);
007400100714         p = i - j + 28;
007500100714
007600100715         IF (p <= 31);
007700100714           jDay = p;
007800100715           pasquaC = %DATE(%EDITC(anno : 'X') + '-03-' + %EDITC(jDay : 'X'));
007900100715         ELSE;
008000100715           jDay = p - 31;
008100100715           pasquaC = %DATE(%EDITC(anno : 'X') + '-04-' + %EDITC(jDay : 'X'));
008200100715         ENDIF;
008300100715
008400100715       ENDIF;
008500100714
008600100715       IF ((anno >= 1583) AND (anno <= 4099));
008700100714
008800100715         g = %REM(anno : 19);
008900100715         i = %REM(19 * g + 15 : 30);
009000100715         j = %REM((anno + %INT(floor(anno / 4) + i)) : 7);
009100100715         p = i - j + 28;
009200100715         a = %REM(anno : 19);
009300100715         c = floor(anno / 100);
009400100715         h = %REM((c - %INT(floor(c / 4)) - %INT(floor((8 * c + 13) / 25))
009500100715             + 19 * a + 15) : 30);
009600100715         b = h -
009700100715             floor(h / 28) * (1 - floor(29 / (h + 1)) * floor((21 - a) / 11));
009800100715         d = %REM((anno + %INT(floor(anno / 4)) + b + 2 - c +
009900100715             %INT(floor(c / 4))) : 7);
010000100715         q = b - d + 28;
010100100714
010200100715         IF ((anno > 1582) AND (anno <= 1600));
010300100715           extra = 10;
010400100715         ENDIF;
010500100714
010600100715         IF (anno > 1600);
010700100715           tmp = floor(anno / 100) - 16;
010800100715           extra = 10 + tmp - floor(tmp / 4);
010900100715         ENDIF;
011000100714
011100100715         IF (q <= 31);
011200100715           wDay = q;
011300100715           pasquaC = %DATE(%EDITC(anno : 'X') + '-03-' + %EDITC(wDay : 'X'));
011400100715         ELSE;
011500100715           wDay = q - 31;
011600100715           pasquaC = %DATE(%EDITC(anno : 'X') + '-04-' + %EDITC(wDay : 'X'));
011700100715         ENDIF;
011800100714
011900100715         IF %PARMS() > 3;
012000100715
012100100715           oDay = p + extra;
012200100715
012300100715           IF (oDay <= 31);
012400100715             pasquaO = %DATE(%EDITC(anno : 'X') + '-03-' + %EDITC(oDay : 'X'));
012500100715           ENDIF;
012600100714
012700100715           r = oDay - 31;
012800100714
012900100715           IF ((oDay > 31) AND (oDay <= 61));
013000100715             pasquaO = %DATE(%EDITC(anno : 'X') + '-04-' + %EDITC(r : 'X'));
013100100715           ENDIF;
013200100714
013300100715           s = oDay - 61;
013400100714
013500100715           IF (oDay > 61);
013600100715             pasquaO = %DATE(%EDITC(anno : 'X') + '-05-' + %EDITC(s : 'X'));
013700100715           ENDIF;
013800100714
013900100715         ENDIF;
014000100715
014100100715       ENDIF;
014200100714
014300100715       RETURN;
