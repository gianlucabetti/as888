000100141210      *PARMS dftactgrp(*no) actgrp('QILE') option(*noxref)
000200141210     /*PRM dbgview(*source)
000300141210     /*END
000400141210       //==============================================================
000500141210       //?TEST - RICHIESTA E CONTROLLO "PIN-CODE"                      ?
000600141210       //==============================================================
000700141210
000800141210     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000900141210     h dftactgrp(*no)
001000141210
001100141210       //--------------------------------------------------------------
001200141210       //?Dichiarazione file.                                          ?
001300141210       //--------------------------------------------------------------
001400141210
001500141210       // -?Video?
001600141210     fTRULPINTD cf   e             workstn
001700141210     f                                     indds(IndDspF)
001800141210     f                                     infds(InfDspF)
001900141210
002000141210       //--------------------------------------------------------------
002100141210       //?Definizione costanti.                                        ?
002200141210       //--------------------------------------------------------------
002300141210
002400141210       // -?Tasti funzionali a video?
002500141210     d c_F01           c                   const(x'31')
002600141210     d c_F02           c                   const(x'32')
002700141210     d c_F03           c                   const(x'33')
002800141210     d c_F04           c                   const(x'34')
002900141210     d c_F05           c                   const(x'35')
003000141210     d c_F06           c                   const(x'36')
003100141210     d c_F07           c                   const(x'37')
003200141210     d c_F08           c                   const(x'38')
003300141210     d c_F09           c                   const(x'39')
003400141210     d c_F10           c                   const(x'3A')
003500141210     d c_F11           c                   const(x'3B')
003600141210     d c_F12           c                   const(x'3C')
003700141210     d c_F13           c                   const(x'B1')
003800141210     d c_F14           c                   const(x'B2')
003900141210     d c_F15           c                   const(x'B3')
004000141210     d c_F16           c                   const(x'B4')
004100141210     d c_F17           c                   const(x'B5')
004200141210     d c_F18           c                   const(x'B6')
004300141210     d c_F19           c                   const(x'B7')
004400141210     d c_F20           c                   const(x'B8')
004500141210     d c_F21           c                   const(x'B9')
004600141210     d c_F22           c                   const(x'BA')
004700141210     d c_F23           c                   const(x'BB')
004800141210     d c_F24           c                   const(x'BC')
004900141210     d c_Enter         c                   const(x'F1')
005000141210     d c_RollDown      c                   const(x'F4')
005100141210     d c_RollUp        c                   const(x'F5')
005200141210
005300141210       //--------------------------------------------------------------
005400141210       //?Definizione schiere.                                         ?
005500141210       //--------------------------------------------------------------
005600141210
005700141210
005800141210       //--------------------------------------------------------------
005900141210       //?Definizione aree dati.                                       ?
006000141210       //--------------------------------------------------------------
006100141210
006200141210       // -?Dati utente?
006300141210     d §AzUte        e ds                  extname(AZUTE00F)
006400141210     d                                     dtaara
006500141210     d §DatiUte      e ds                  extname(dDatiUte)
006600141210     d                                     dtaara
006700141210
006800141210       //--------------------------------------------------------------
006900141210       //?Definizione strutture dati.                                  ?
007000141210       //--------------------------------------------------------------
007100141210
007200141210       // -?Status ds?
007300141210     d Status         sds
007400141210     d   SDSpgm          *proc
007500141210     d   SDSprm          *parms
007600141210     d   SDSusr              254    263
007700141210
007800141210       // -?InfDS?
007900141210     d InfDspF         ds
008000141210     d   dsp_aid             369    369a
008100141210
008200141210       // -?Indicatori su DspF?
008300141210     d IndDspF         ds
008400141210         // -?(Dis)Abilitazione tasti funzionali?
008500141210     d   F6Attivo                      n   overlay(IndDspF : 06)
008600141210     d   F12Attivo                     n   overlay(IndDspF : 12)
008700141210         // -?Emissione messaggio di errore?
008800141210     d   ErrMessage                    n   overlay(IndDspF : 28)
008900141210         // -?Riemissione videata?
009000141210     d   ErrGenerico                   n   overlay(IndDspF : 99)
009100141210
009200141210       // -?kpjba?
009300141210     d kpjba         e ds                  qualified
009400141210
009500141210       //--------------------------------------------------------------
009600141210       //?Definizione variabili globali.                               ?
009700141210       //--------------------------------------------------------------
009800141210
009900141210       // -?Flags booleani?
010000141210     d $Fine           s               n   inz(*off)
010100141210     d $InzD01         s               n   inz(*on)
010200141210
010300141210       //--------------------------------------------------------------
010400141210       //?Definizione procedure usate.                                 ?
010500141210       //--------------------------------------------------------------
010600141210
010700141210       // -?Reperimento dati utente?
010800141210     d TIBS34ds      e ds                  qualified
010900141210      /copy gaitrasrc/srcProtoPR,TIBS34R
011000141210
011100141210       // -?Richiesta e Controllo del "PINcode"?
011200141210     d TRULPINds     e ds                  inz
011300141210     d trulPINr        pr                  extpgm('TRULPINR')
011400141210     d   kpjba                             likeds(kpjba)
011500141210     d   trulPINds                         likeds(trulPINds)
011600141210
011700141210       //--------------------------------------------------------------
011800141210       //?Definizione key-list.                                        ?
011900141210       //--------------------------------------------------------------
012000141210
012100141210
012200141210       //--------------------------------------------------------------
012300141210       //?Riepilogo indicatori.                                        ?
012400141210       //--------------------------------------------------------------
012500141210
012600141210
012700141210       //--------------------------------------------------------------
012800141210       //?M A I N - L I N E                                            ?
012900141210       //--------------------------------------------------------------
013000141210
013100141210     c     *Entry        plist
013200141210     c                   parm                    KPJBA
013300141210
013400141210      /free
013500141210
013600141210       // -?Start?
013700141210       exsr  sr_RoutInz;
013800141210
013900141210       // -?Elab?
014000141210       dow  $Fine = *off;
014100141210         exsr  sr_GesD01;
014200141210       enddo;
014300141210
014400141210       // -?End?
014500141210       return;
014600141210
014700141210       //--------------------------------------------------------------
014800141210       //?Operazioni iniziali.                                         ?
014900141210       //--------------------------------------------------------------
015000141210       BEGSR  sr_RoutInz;
015100141210
015200141210         *inLR = *on;
015300141210
015400141210         // -?Reperimento dati job?
015500141210         exsr  sr_DatiJob;
015600141210
015700141210         // -?Impostazione nome programma a video?
015800141210         //VTDpgm = SDSpgm;
015900141210
016000141210         if  %parms() = *zero;
016100141210           $Fine  = *on;
016200141210           V1Dmsg = 'È richiesta la KPJBA';
016300141210           ErrMessage  = *on;
016400141210           ErrGenerico = *on;
016500141210           write  ulPINt1;
016600141210           write  ulPINz1;
016700141210           exfmt  ulPINd1;
016800141210           leavesr;
016900141210         endif;
017000141210
017100141210       ENDSR;
017200141210
017300141210       //--------------------------------------------------------------
017400141210       //?Reperimento Dati del job (Utente/Operativi).                 ?
017500141210       //--------------------------------------------------------------
017600141210       BEGSR  sr_DatiJob;
017700141210
017800141210         in(E) §AzUte;
017900141210         if NOT %error;
018000141210           in(E) §DatiUte;
018100141210         endif;
018200141210         if %error or RSut = *blanks;
018300141210           clear TIBS34ds;
018400141210           tibs34r(tibs34ds);
018500141210           in §AzUte;
018600141210           in §DatiUte;
018700141210         endif;
018800141210
018900141210       ENDSR;
019000141210
019100141210       //--------------------------------------------------------------
019200141210       //?Gestione videata D01                                         ?
019300141210       //--------------------------------------------------------------
019400141210       BEGSR  sr_GesD01;
019500141210
019600141210         // -?Inizializzazione videata?
019700141210         if  $InzD01 = *on;
019800141210           clear  ulPINd1;
019900141210           $InzD01  = *off;
020000141210         endif;
020100141210
020200141210         F6Attivo  = *on;
020300141210         F12Attivo = *off;
020400141210
020500141210         // -?Emissione videata?
020600141210         if  ErrMessage = *off;
020700141210           write  ulPINt1;
020800141210           write  ulPINz1;
020900141210         endif;
021000141210         exfmt  ulPINd1;
021100141210
021200141210         reset  ErrMessage;
021300141210         reset  ErrGenerico;
021400141210         clear  V1Dmsg;
021500141210
021600141210         Select;
021700141210
021800141210           // -?F3=Fine?
021900141210           When  dsp_aid = c_F03;
022000141210             $Fine = *on;
022100141210
022200141210           // -?Invio o F6=Conferma?
022300141210           Other;
022400141210             exsr sr_CtrD01;
022500141210             select;
022600141210               // -?rilevato errore?
022700141210               when  ErrGenerico = *on;
022800141210               // -?richiamo da eseguire?
022900141210               when  dsp_aid = c_F06;
023000141210                 exsr  sr_Call_TRULPINR;
023100141210                 //reset $InzD01;
023200141210                 //clear  iPINlnp;
023300141210                 //clear  iPINnrs;
023400141210                 clear  iPINnsp;
023500141210                 //clear  iPINaas;
023600141210                 clear  oPINfxx;
023700141210                 clear  oPINerr;
023800141210                 clear  oPINmsg;
023900141210             endsl;
024000141210
024100141210         EndSl;
024200141210
024300141210       ENDSR;
024400141210
024500141210       //--------------------------------------------------------------
024600141210       //?Richiamo *pgm TRULPINR                                       ?
024700141210       //--------------------------------------------------------------
024800141210       BEGSR  sr_Call_TRULPINR;
024900141210
025000141210         // -?Richiamo *pgm TRULPINR?
025100141210         trulPINr ( kpjba : trulPINds );
025200141210
025300141210         *in28  = oPINerr;
025400141210         V1Dmsg = oPINmsg;
025500141210
025600141210         F6Attivo  = *off;
025700141210         F12Attivo = *on;
025800141210
025900141210         write  ulPINt1;
026000141210         write  ulPINz1;
026100141210         write  ulPINd1;
026200141210         write  Protect;
026300141210
026400141210         // -?Emissione 2ª videata (con il risultato)?
026500141210         dou  dsp_aid = c_F03  or  dsp_aid = c_F12;
026600141210
026700141210           exfmt  ulPINd2;
026800141210
026900141210           // -?F3=Fine?
027000141210           if  dsp_aid = c_F03;
027100141210             $Fine = *on;
027200141210           endif;
027300141210
027400141210         enddo;
027500141210
027600141210       ENDSR;
027700141210
027800141210       //--------------------------------------------------------------
027900141210       //?Controllo dati in videata D01                                ?
028000141210       //--------------------------------------------------------------
028100141210       BEGSR  sr_CtrD01;
028200141210
028300141210         %subst(IndDspF : 28) = *off;
028400141210
028500141210       ENDSR;
028600141210
028700141210      /end-free
