000100140218     /*PRM dbgview(*source)
000200140218     /*END
000300140218       //==============================================================
000400140218       //?TEST - RECUPERO DATA/SCAGLIONE DA PREZZO GASOLIO.            ?
000500140218       //==============================================================
000600140218
000700140218     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000800140218     h dftactgrp(*no)
000900140218
001000140218       //--------------------------------------------------------------
001100140218       //?Dichiarazione file.                                          ?
001200140218       //--------------------------------------------------------------
001300140218
001400140218       // -?Video?
001500140219     fTRULPMGTSDcf   e             workstn
001600140218     f                                     indds(IndDspF)
001700140218     f                                     infds(InfDspF)
001800140218
001900140218       //--------------------------------------------------------------
002000140218       //?Definizione costanti.                                        ?
002100140218       //--------------------------------------------------------------
002200140218
002300140218       // -?Tasti funzionali a video?
002400140218     d c_F01           c                   const(x'31')
002500140218     d c_F02           c                   const(x'32')
002600140218     d c_F03           c                   const(x'33')
002700140218     d c_F04           c                   const(x'34')
002800140218     d c_F05           c                   const(x'35')
002900140218     d c_F06           c                   const(x'36')
003000140218     d c_F07           c                   const(x'37')
003100140218     d c_F08           c                   const(x'38')
003200140218     d c_F09           c                   const(x'39')
003300140218     d c_F10           c                   const(x'3A')
003400140218     d c_F11           c                   const(x'3B')
003500140218     d c_F12           c                   const(x'3C')
003600140218     d c_F13           c                   const(x'B1')
003700140218     d c_F14           c                   const(x'B2')
003800140218     d c_F15           c                   const(x'B3')
003900140218     d c_F16           c                   const(x'B4')
004000140218     d c_F17           c                   const(x'B5')
004100140218     d c_F18           c                   const(x'B6')
004200140218     d c_F19           c                   const(x'B7')
004300140218     d c_F20           c                   const(x'B8')
004400140218     d c_F21           c                   const(x'B9')
004500140218     d c_F22           c                   const(x'BA')
004600140218     d c_F23           c                   const(x'BB')
004700140218     d c_F24           c                   const(x'BC')
004800140218     d c_Enter         c                   const(x'F1')
004900140218     d c_RollDown      c                   const(x'F4')
005000140218     d c_RollUp        c                   const(x'F5')
005100140218
005200140218       //--------------------------------------------------------------
005300140218       //?Definizione schiere.                                         ?
005400140218       //--------------------------------------------------------------
005500140218
005600140218
005700140218       //--------------------------------------------------------------
005800140218       //?Definizione aree dati.                                       ?
005900140218       //--------------------------------------------------------------
006000140218
006100140218       // -?Dati utente?
006200140218     d §AzUte        e ds                  extname(AZUTE00F)
006300140218     d                                     dtaara
006400140218     d §DatiUte      e ds                  extname(dDatiUte)
006500140218     d                                     dtaara
006600140218
006700140218       //--------------------------------------------------------------
006800140218       //?Definizione strutture dati.                                  ?
006900140218       //--------------------------------------------------------------
007000140218
007100140218       // -?Status ds?
007200140218     d Status         sds
007300140218     d   SDSpgm          *proc
007400140218     d   SDSprm          *parms
007500140218     d   SDSusr              254    263
007600140218
007700140218       // -?InfDS?
007800140218     d InfDspF         ds
007900140218     d   dsp_aid             369    369a
008000140218
008100140218       // -?Indicatori su DspF?
008200140218     d IndDspF         ds
008300140218         // -?Abilitazione tasti funzionali?
008400140218     d   F6Attivo                      n   overlay(IndDspF : 06)
008500140218     d   F12Attivo                     n   overlay(IndDspF : 12)
008600140218         // -?Emissione messaggio di errore?
008700140218     d   ErrMessage                    n   overlay(IndDspF : 28)
008800140218         // -?Riemissione videata?
008900140218     d   ErrGenerico                   n   overlay(IndDspF : 99)
009000140218
009100140218       // -?Kpjba?
009200140218     d kpjba         e ds                  qualified
009300140218
009400140218       //--------------------------------------------------------------
009500140218       //?Definizione variabili globali.                               ?
009600140218       //--------------------------------------------------------------
009700140218
009800140218       // -?Flags booleani?
009900140218     d $Fine           s               n   inz(*off)
010000140218     d $InzD01         s               n   inz(*on)
010100140218
010200140218       //--------------------------------------------------------------
010300140218       //?Definizione procedure usate.                                 ?
010400140218       //--------------------------------------------------------------
010500140218
010600140218       // -?Reperimento dati utente?
010700140218     d TIBS34ds      e ds
010800140218      /copy gaitrasrc/srcProtoPR,TIBS34R
010900140218
011000140218       // -?Recupero Data/Scaglione da Prezzo gasolio?
011100140219     d trulPMGds     e ds                  inz
011200140219     d trulPMGr        pr                  extpgm('TRULPMGR')
011300140218     d   kpjba                             likeds(KPJBA)
011400140218
011500140218       //--------------------------------------------------------------
011600140218       //?Definizione key-list.                                        ?
011700140218       //--------------------------------------------------------------
011800140218
011900140218
012000140218       //--------------------------------------------------------------
012100140218       //?Riepilogo indicatori.                                        ?
012200140218       //--------------------------------------------------------------
012300140218
012400140218
012500140218       //--------------------------------------------------------------
012600140218       //?M A I N - L I N E .                                          ?
012700140218       //--------------------------------------------------------------
012800140218
012900140218     c     *Entry        plist
013000140218     c                   parm                    KPJBA
013100140218
013200140218      /free
013300140218
013400140218       // -?Start?
013500140218       *inLR = *on;
013600140218
013700140218       // -?Elab?
013800140218       doW  $Fine = *off;
013900140218         exsr  sr_GesD01;
014000140218       endDo;
014100140218
014200140218       // -?End?
014300140218       return;
014400140218
014500140218       //--------------------------------------------------------------
014600140218       //?Operazioni iniziali.                                         ?
014700140218       //--------------------------------------------------------------
014800140218       BEGSR  *InzSR;
014900140218
015000140218         // -?Reperimento dati job?
015100140218         exsr  sr_DatiJob;
015200140218
015300140218         // -?Impostazione nome programma a video?
015400140218         //VTDpgm = SDSpgm;
015500140218
015600140218       ENDSR;
015700140218
015800140218       //--------------------------------------------------------------
015900140218       //?Reperimento Dati del job (Utente/Operativi).                 ?
016000140218       //--------------------------------------------------------------
016100140218       BEGSR  sr_DatiJob;
016200140218
016300140218         in(E) §AzUte;
016400140218         if NOT %error;
016500140218           in(E) §DatiUte;
016600140218         endif;
016700140218         if %error or RSut = *blanks;
016800140218           clear TIBS34ds;
016900140218           tibs34r(tibs34ds);
017000140218           in §AzUte;
017100140218           in §DatiUte;
017200140218         endif;
017300140218
017400140218       ENDSR;
017500140218
017600140218       //--------------------------------------------------------------
017700140218       //?Gestione videata D01.                                        ?
017800140218       //--------------------------------------------------------------
017900140218       BEGSR  sr_GesD01;
018000140218
018100140218         // -?Inizializzazione videata?
018200140218         if  $InzD01 = *on;
018300140218           clear  taPMGd1;
018400140218           $InzD01  = *off;
018500140218         endif;
018600140218
018700140218         F6Attivo  = *on;
018800140218         F12Attivo = *off;
018900140218
019000140218         // -?Emissione videata?
019100140218         if  ErrMessage = *off;
019200140218           write  taPMGt1;
019300140218           write  taPMGz1;
019400140218         endif;
019500140218         exfmt  taPMGd1;
019600140218
019700140218         reset  ErrMessage;
019800140218         reset  ErrGenerico;
019900140218         clear  V1Dmsg;
020000140218
020100140218         SELECT;
020200140218
020300140218           // -?F3=Fine?
020400140218           WHEN  dsp_aid = c_F03;
020500140218             $Fine = *on;
020600140218
020700140218           // -?Invio o F6=Conferma?
020800140218           OTHER;
020900140218             exsr sr_CtrD01;
021000140218             select;
021100140218               // -?rilevato errore?
021200140218               when  ErrGenerico = *on;
021300140218               // -?non premuto F6?
021400140218               when  dsp_aid <> c_F06;
021500140218               // -?richiamo da eseguire?
021600140218               other;
021700140219                 exsr  sr_CallTRULPMGR;
021800140218                 //reset $InzD01;
021900140218                 //clear  iPMGpmg;
022000140218             endsl;
022100140218
022200140218         ENDSL;
022300140218
022400140218       ENDSR;
022500140218
022600140218       //--------------------------------------------------------------
022700140219       //?Richiamo *pgm TRULPMGR.                                      ?
022800140218       //--------------------------------------------------------------
022900140219       BEGSR  sr_CallTRULPMGR;
023000140218
023100140219         // -?Richiamo *pgm TRULPMGR?
023200140219         kpjba.kpjbu = trulPMGds;
023300140219         trulPMGr ( kpjba );
023400140219         trulPMGds = kpjba.kpjbu;
023500140218
023600140218         *in28  = (oPMGerr = *on);
023700140219         V1Dmsg = oPMGmsg;
023800140218         F6Attivo  = *off;
023900140218         F12Attivo = *on;
024000140218
024100140218         write  taPMGt1;
024200140218         write  taPMGz1;
024300140218         write  taPMGd1;
024400140218         write  Protect;
024500140218
024600140218         // -?Emissione 2ª videata (con il risultato)?
024700140218         doU  dsp_aid = c_F03  or  dsp_aid = c_F12;
024800140218
024900140218           exfmt  taPMGd2;
025000140218
025100140218           // -?F3=Fine?
025200140218           if  dsp_aid = c_F03;
025300140218             $Fine = *on;
025400140218           endif;
025500140218
025600140218         endDo;
025700140218
025800140218       ENDSR;
025900140218
026000140218       //--------------------------------------------------------------
026100140218       //?Controllo dati in videata D01.                               ?
026200140218       //--------------------------------------------------------------
026300140218       BEGSR  sr_CtrD01;
026400140218
026500140218         %subst(IndDspF : 28) = *off;
026600140218
026700140218       ENDSR;
026800140218
026900140218      /end-free
