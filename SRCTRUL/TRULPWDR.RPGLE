000100150310       //==============================================================
000200150310       //?Approvazione della parola d'ordine utente quando viene       ?
000300150310       //?  modificata tramite *cmd CHGPWD o *api QSYCHGPW.            ?
000400150310       //==============================================================
000500150310       //?Compilare in QUSRSYS ed                                      ?
000600150310       //?Impostare TRULPWDC nel valore di sistema QPWDVLDPGM.         ?
000700150310       //==============================================================
000800150227
000900150227       //--------------------------------------------------------------
001000150227       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
001100150227       //--------------------------------------------------------------
001200150227
001300150227     /*PRM  dbgview(*source)
001400150227
001500150227       //--------------------------------------------------------------
001600150227       //?Specifiche di controllo.                                     ?
001700150227       //--------------------------------------------------------------
001800150227
001900150227     h decedit('0,') datedit(*dmy/) option(*nodebugio)
002000150227     h dftactgrp(*no)
002100150227
002200150227       //--------------------------------------------------------------
002300150227       //?Dichiarazione file.                                          ?
002400150227       //--------------------------------------------------------------
002500150227
002600150227
002700150227       //--------------------------------------------------------------
002800150227       //?Definizione costanti.                                        ?
002900150227       //--------------------------------------------------------------
003000150309
003100150310       // -?Caratteri alfabetici?
003200150310     d c_Chars         c                   const('abcdefghijklm+
003300150310     d                                            nopqrstuvwxyz+
003400150310     d                                            àáâãäå+
003500150310     d                                            æç+
003600150310     d                                            èéêë+
003700150310     d                                            ìíîï+
003800150310     d                                            òóôõö+
003900150310     d                                            ùúûü+
004000150310     d                                            ABCDEFGHIJKLM+
004100150310     d                                            NOPQRSTUVWXYZ+
004200150310     d                                            ÀÁÂÃÄÅ+
004300150310     d                                            ÆÇ+
004400150310     d                                            ÈÉÊË+
004500150310     d                                            ÌÍÎÏ+
004600150310     d                                            ÒÓÔÕÖ+
004700150310     d                                            ÙÚÛÜ+
004800150310     d                                            ,;.:-_@#°§[{+*]}+
004900150310     d                                            \|!"£$%&/()=?^'' ')
005000150310
005100150310       // -?Caratteri numerici?
005200150310     d c_Digits        c                   const('0123456789')
005300150310
005400150310       // -?Numero Massimo di cifre contigue?
005500150310     d c_MaxDigits     c                   const(3)
005600150227
005700150227       //--------------------------------------------------------------
005800150227       //?Definizione schiere.                                         ?
005900150227       //--------------------------------------------------------------
006000150227
006100150309       // -?Stringhe da scartare?
006200150309     d sk_DaScartare   s             10    dim(13)  ctdata  perrcd(1)
006300150227
006400150227       //--------------------------------------------------------------
006500150227       //?Definizione aree dati.                                       ?
006600150227       //--------------------------------------------------------------
006700150227
006800150227
006900150227       //--------------------------------------------------------------
007000150227       //?Definizione strutture dati.                                  ?
007100150227       //--------------------------------------------------------------
007200150227
007300150227
007400150227       //--------------------------------------------------------------
007500150227       //?Definizione variabili globali.                               ?
007600150227       //--------------------------------------------------------------
007700150227
007800150227       // -?Parametri ricevuti?
007900150309       // ·?   di Input?
008000150227     d prm_Pwd         s            256
008100150309       // ·?   di Output?
008200150227     d prm_Err         s               n
008300150309
008400150309       // -?Indici di schiera?
008500150309     d xx              s              3  0 inz
008600150310     d yy              s              3  0 inz
008700150227
008800150227       //--------------------------------------------------------------
008900150227       //?Definizione prototipi procedure.                             ?
009000150227       //--------------------------------------------------------------
009100150227
009200150227
009300150227       //--------------------------------------------------------------
009400150227       //?Definizione key-list.                                        ?
009500150227       //--------------------------------------------------------------
009600150227
009700150227
009800150227       //--------------------------------------------------------------
009900150227       //?M A I N - L I N E                                            ?
010000150227       //--------------------------------------------------------------
010100150227
010200150227     c     *Entry        plist
010300150227     c                   parm                    prm_Pwd
010400150227     c                   parm                    prm_Err
010500150227
010600150227      /free
010700150227
010800150227       // -?Operazioni iniziali?
010900150310       *inLR   = *off;
011000150227       prm_Err = *off;
011100150227
011200150227       // -?Controllo password?
011300150227       //  ?(i controlli sulla lunghezza e sulla validità dei caratteri?
011400150227       //  ? sono già stati eseguiti dal sistema)?
011500150310
011600150310       // ·?Non deve contenere una delle stringhe da scartare?
011700150310       For  xx = 1  To  %elem( sk_DaScartare );
011800150309         prm_Err = ( %scan( %trim( sk_DaScartare(xx) ) : prm_Pwd ) > *zero );
011900150309         if  prm_Err;
012000150310           return;
012100150309         endif;
012200150309       EndFor;
012300150309
012400150310       // ·?Non deve contenere oltre 3 cifre consecutive?
012500150310       clear  xx;
012600150310       clear  yy;
012700150310       // ·?Ricerca delle cifre consecutive:?
012800150310       For  yy = 1  To  %size( prm_Pwd ) - c_MaxDigits;
012900150310         // ·?Fino alla fine della stringa di caratteri inserita?
013000150310         if  %subst( prm_Pwd : yy ) = *blank;
013100150310           leave;
013200150310         endif;
013300150310         // ·?Ricerca della prima cifra (dalla posizione in esame)?
013400150310         xx = %check( c_Chars : prm_Pwd : yy );
013500150310         if  xx = *zero;
013600150310           leave;
013700150310         endif;
013800150310         // ·?Ricerca del primo carattere alfabetico successivo?
013900150310         //  ?(se NON trovato: significa che sono cifre fino alla fine?
014000150310         //  ? della stringa di caratteri inserita)?
014100150310         yy = %check( c_Digits : prm_Pwd : xx + 1 );
014200150310         if  yy = *zero;
014300150310           yy = %size( prm_Pwd ) + 1;
014400150310         endif;
014500150310         // ·?Controllo del n° di cifre consecutive:?
014600150310         //  ?SE oltre 3 => trovato errore => uscita;?
014700150310         //  ?altrimenti => si prosegue il controllo di eventuali?
014800150310         //  ?              altre cifre (dalla posizione successiva?
014900150310         //  ?              a quella finale in esame)?
015000150310         prm_Err = ( yy - xx > c_MaxDigits );
015100150310         if  prm_Err;
015200150310           return;
015300150310         endif;
015400150309       EndFor;
015500150227
015600150227       // -?Operazioni finali?
015700150227       return;
015800150227
015900150227      /end-free
016000150309
016100150309       //--------------------------------------------------------------
016200150309       //?Schiere a tempo di compilazione.                             ?
016300150309       //--------------------------------------------------------------
016400150309
016500150309** -?sk_DaScartare:?Stringhe di caratteri da scartare nelle password?
016600150309BARTOLINI - 1
016700150309GENNAIO   - 2
016800150309FEBBRAIO  - 3
016900150309MARZO     - 4
017000150309APRILE    - 5
017100150309MAGGIO    - 6
017200150309GIUGNO    - 7
017300150309LUGLIO    - 8
017400150309AGOSTO    - 9
017500150309SETTEMBRE -10
017600150309OTTOBRE   -11
017700150309NOVEMBRE  -12
017800150309DICEMBRE  -13
