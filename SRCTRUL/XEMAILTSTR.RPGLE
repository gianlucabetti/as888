000100091008      *PARMS dftactgrp(*no) actgrp('QILE') option(*noxref)
000200091008       //--------------------------------------------------------------
000300091008       //?TEST - Verifica se una stringa è un indirizzo e-mail OK
000400091008       //--------------------------------------------------------------
000500091008
000600091008     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000700091008     h dftactgrp(*no) actgrp('QILE')
000800091008
000900091008       //--------------------------------------------------------------
001000091008       //?Dichiarazione file.
001100091008       //--------------------------------------------------------------
001200091008
001300091008       // - Video
001400091008     fXEMAILTSTDcf   e             workstn
001500091008     f                                     indds(IndDspF)
001600091008     f                                     infds(InfDspF)
001700091008
001800091008       //--------------------------------------------------------------
001900091008       //?Definizione costanti.
002000091008       //--------------------------------------------------------------
002100091008
002200091008       // - Tasti funzionali a video
002300091008     d c_F01           c                   const(x'31')
002400091008     d c_F02           c                   const(x'32')
002500091008     d c_F03           c                   const(x'33')
002600091008     d c_F04           c                   const(x'34')
002700091008     d c_F05           c                   const(x'35')
002800091008     d c_F06           c                   const(x'36')
002900091008     d c_F07           c                   const(x'37')
003000091008     d c_F08           c                   const(x'38')
003100091008     d c_F09           c                   const(x'39')
003200091008     d c_F10           c                   const(x'3A')
003300091008     d c_F11           c                   const(x'3B')
003400091008     d c_F12           c                   const(x'3C')
003500091008     d c_F13           c                   const(x'B1')
003600091008     d c_F14           c                   const(x'B2')
003700091008     d c_F15           c                   const(x'B3')
003800091008     d c_F16           c                   const(x'B4')
003900091008     d c_F17           c                   const(x'B5')
004000091008     d c_F18           c                   const(x'B6')
004100091008     d c_F19           c                   const(x'B7')
004200091008     d c_F20           c                   const(x'B8')
004300091008     d c_F21           c                   const(x'B9')
004400091008     d c_F22           c                   const(x'BA')
004500091008     d c_F23           c                   const(x'BB')
004600091008     d c_F24           c                   const(x'BC')
004700091008     d c_Enter         c                   const(x'F1')
004800091008     d c_RollDown      c                   const(x'F4')
004900091008     d c_RollUp        c                   const(x'F5')
005000091008
005100091008       //--------------------------------------------------------------
005200091008       //?Definizione schiere.
005300091008       //--------------------------------------------------------------
005400091008
005500091008
005600091008       //--------------------------------------------------------------
005700091008       //?Definizione aree dati.
005800091008       //--------------------------------------------------------------
005900091008
006000091008       // - Dati utente
006100091008     d §AzUte        e ds                  extname(AZUTE00F)
006200091008     d                                     dtaara
006300091008     d §DatiUte      e ds                  extname(dDatiUte)
006400091008     d                                     dtaara
006500091008
006600091008       //--------------------------------------------------------------
006700091008       //?Definizione strutture dati.
006800091008       //--------------------------------------------------------------
006900091008
007000091008       // - Status ds
007100091008     d Status         sds
007200091008     d  SDSpgm           *proc
007300091008     d  SDSprm           *parms
007400091008     d  SDSusr               254    263
007500091008
007600091008       // - InfDS
007700091008     d InfDspF         ds
007800091008     d  dsp_aid              369    369a
007900091008
008000091008       // - Indicatori su DspF
008100091008     d IndDspF         ds
008200091008        // - Abilitazione tasti funzionali
008300091008     d  AbilitF06                     1n   overlay(IndDspF : 06)
008400091008     d  AbilitF12                     1n   overlay(IndDspF : 12)
008500091008        // - Indicatori di errore
008600091008     d  ErrMessage                    1n   overlay(IndDspF : 28)
008700091008     d  ErrGenerico                   1n   overlay(IndDspF : 99)
008800091008
008900091008       // - KPJBA
009000091008     d kpjba         e ds
009100091008
009200091008       // - Parametri x Controllo profilo utenti
009300091008     d TIBS34ds      e ds                  qualified
009400091008
009500091008       // - Parametri x XEMAIL
009600091008     d dsEMAIL       e ds                  inz
009700091008
009800091008       //--------------------------------------------------------------
009900091008       //?Definizione variabili globali.
010000091008       //--------------------------------------------------------------
010100091008
010200091008       // - Flags booleani
010300091008     d $Fine           s               n   inz(*off)
010400091008     d $InzD01         s               n   inz(*on)
010500091008     d $InzD02         s               n   inz(*on)
010600091008
010700091008       // - Campi per la gestione del video
010800091008     d $Video          s              2a   inz('D1')
010900091008     d SaveInd         s             99a   inz(*zero)
011000091008     d SaveMsg         s             80a   inz
011100091008
011200091008       //--------------------------------------------------------------
011300091008       //?Definizione procedure usate.
011400091008       //--------------------------------------------------------------
011500091008
011600091008       // - Reperimento dati utente
011700091008      /copy GAITRASRC/SRCPROTOPR,TIBS34R
011800091008
011900091008       // - Controllo indirizzo e-mail
012000091008      /copy GAITRASRC/SRCPROTOPR,XEMAIL
012100091008
012200091008       //--------------------------------------------------------------
012300091008       //?Definizione key-list.
012400091008       //--------------------------------------------------------------
012500091008
012600091008
012700091008       //--------------------------------------------------------------
012800091008       //?Riepilogo indicatori.
012900091008       //--------------------------------------------------------------
013000091008
013100091008
013200091008       //--------------------------------------------------------------
013300091008       //?M A I N - L I N E
013400091008       //--------------------------------------------------------------
013500091008
013600091008     c     *Entry        plist
013700091008     c                   parm                    KPJBA
013800091008
013900091008      /free
014000091008
014100091008       // - Start
014200091008       *inLR = *on;
014300091008
014400091008       // - Elab
014500091008       dow  $Fine = *off;
014600091008         select;
014700091008           when  $Video = 'D1';
014800091008             exsr sr_GesD01;
014900091008           when  $Video = 'D2';
015000091008             exsr sr_GesD02;
015100091008           other;
015200091008             $Fine = *on;
015300091008         endsl;
015400091008       enddo;
015500091008
015600091008       // - End
015700091008       return;
015800091008
015900091008       //--------------------------------------------------------------
016000091008       //?Operazioni iniziali
016100091008       //--------------------------------------------------------------
016200091008       BEGSR *InzSR;
016300091008
016400091008         // Reperimento dati utente
016500091008         exsr sr_DatiJob;
016600091008
016700091008         // Impostazione nome programma in testata a video
016800091008         V1Tpgm = SDSpgm;
016900091008
017000091008       ENDSR;
017100091008
017200091008       //--------------------------------------------------------------
017300091008       //?Reperimento Dati del job (Utente/Operativi).
017400091008       //--------------------------------------------------------------
017500091008       BEGSR sr_DatiJob;
017600091008
017700091008         in(E) §AzUte;
017800091008         if NOT %error;
017900091008           in(E) §DatiUte;
018000091008         endif;
018100091008         if %error or RSut = *blanks;
018200091008           clear TIBS34ds;
018300091008           tibs34r(tibs34ds);
018400091008           in §AzUte;
018500091008           in §DatiUte;
018600091008         endif;
018700091008
018800091008       ENDSR;
018900091008
019000091008       //--------------------------------------------------------------
019100091008       //?Gestione videata D01
019200091008       //--------------------------------------------------------------
019300091008       BEGSR sr_GesD01;
019400091008
019500091008         // Inizializzazione videata
019600091008         if  $InzD01 = *on;
019700091008           clear XEMAILd1;
019800091008           $InzD01  = *off;
019900091008         endif;
020000091008         AbilitF06 = *on;
020100091008         AbilitF12 = *off;
020200091008
020300091008         // Emissione videata
020400091008         if  ErrMessage = *off;
020500091008           write XEMAILt1;
020600091008           write XEMAILz1;
020700091008         endif;
020800091008
020900091008         exfmt XEMAILd1;
021000091008
021100091008         reset ErrMessage;
021200091008         reset ErrGenerico;
021300091008         clear V1Dmsg;
021400091008
021500091008         SELECT;
021600091008
021700091008           // - F3=Fine
021800091008           WHEN  dsp_aid = c_F03;
021900091008             $Fine = *on;
022000091008
022100091008           // - Invio o F6=Conferma
022200091008           OTHER;
022300091008             exsr sr_CtrD01;
022400091008             select;
022500091008               // - rilevato errore
022600091008               when  ErrGenerico = *on;
022700091008               // - non premuto F6
022800091008               when  dsp_aid <> c_F06;
022900091008               // - richiamo *pgm
023000091008               other;
023100091008                 $Video = 'D2';
023200091008                 reset  $InzD02;
023300091008             endsl;
023400091008
023500091008         ENDSL;
023600091008
023700091008       ENDSR;
023800091008
023900091008       //--------------------------------------------------------------
024000091008       //?Controllo dati in videata D01                                ?
024100091008       //--------------------------------------------------------------
024200091008       BEGSR sr_CtrD01;
024300091008
024400091008         %subst(IndDspF : 28) = *off;
024500091008
024600091008       ENDSR;
024700091008
024800091008       //--------------------------------------------------------------
024900091008       //?Gestione videata D02                                         ?
025000091008       //--------------------------------------------------------------
025100091008       BEGSR  sr_GesD02;
025200091008
025300091008         // Inizializzazione videata
025400091008         if  $InzD02 = *on;
025500091012           reset  SaveInd;
025600091012           clear  SaveMsg;
025700091008           clear  XEMAILd2;
025800091008           exsr  Call_XEMAIL;
025900091008           $InzD02 = *off;
026000091008           AbilitF06 = *off;
026100091008           AbilitF12 = *on;
026200091008         endif;
026300091008
026400091008         // Emissione videata
026500091008         if  ErrMessage = *on;
026600091008           SaveInd = IndDspF;
026700091008           SaveMsg = V1Dmsg;
026800091008           clear V1Dmsg;
026900091008           ErrMessage  = *off;
027000091008           ErrGenerico = *off;
027100091008         endif;
027200091008         write XEMAILt1;
027300091008         write XEMAILz1;
027400091008         write XEMAILd1;
027500091008         write Protect;
027600091008         if  SaveInd <> *zero;
027700091008           IndDspF = SaveInd;
027800091008           V1Dmsg  = SaveMsg;
027900091008         endif;
028000091008
028100091008         exfmt XEMAILd2;
028200091008
028300091008         reset ErrMessage;
028400091008         reset ErrGenerico;
028500091008         clear V1Dmsg;
028600091008
028700091008         SELECT;
028800091008
028900091008           // - F3=Fine
029000091008           WHEN  dsp_aid = c_F03;
029100091008             $Fine = *on;
029200091008
029300091008           // - F12=Ritorno
029400091008           WHEN  dsp_aid = c_F12;
029500091008             $Video = 'D1';
029600091008             //reset $InzD01;
029700091008             reset $InzD02;
029800091008
029900091008           // - Invio
030000091008           OTHER;
030100091008
030200091008         ENDSL;
030300091008
030400091008       ENDSR;
030500091008
030600091008       //--------------------------------------------------------------
030700091008       //?Richiamo stored procedure TRUL55R
030800091008       //--------------------------------------------------------------
030900091008       BEGSR Call_XEMAIL;
031000091012
031100091012         clear  §emlINDo;
031200091012         clear  §emlERRo;
031300091012         clear  §emlMSGo;
031400091008
031500091008         XEMAIL ( dsEMAIL );
031600091008
031700091008         ErrMessage  = (§EMLerrO = *on);
031800091008         ErrGenerico = ErrMessage;
031900091008         V1Dmsg = §EMLmsgO;
032000091008
032100091008       ENDSR;
032200091008
032300091008      /end-free
