000100141105      *PARMS dftactgrp(*no) actgrp('QILE') bnddir('UBBNDDIR')
000200090921       //--------------------------------------------------------------
000300141105       //?TEST - Nr. Cellulare: normalizzazione e considerazioni       ?
000400090921       //--------------------------------------------------------------
000500090921
000600090921     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000700141105     h dftactgrp(*no) actgrp('QILE') bnddir('UBBNDDIR')
000800090921
000900090921       //--------------------------------------------------------------
001000090921       //?Dichiarazione file.                                          ?
001100090921       //--------------------------------------------------------------
001200090921
001300090921       // - Video
001400141126     fUBCHKPWDTDcf   e             workstn
001500090921     f                                     indds(IndDspF)
001600090921     f                                     infds(InfDspF)
001700090921
001800090921       //--------------------------------------------------------------
001900090921       //?Definizione costanti.                                        ?
002000090921       //--------------------------------------------------------------
002100090921
002200090921       // - Tasti funzionali a video
002300090921     d c_F01           c                   const(x'31')
002400090921     d c_F02           c                   const(x'32')
002500090921     d c_F03           c                   const(x'33')
002600090921     d c_F04           c                   const(x'34')
002700090921     d c_F05           c                   const(x'35')
002800090921     d c_F06           c                   const(x'36')
002900090921     d c_F07           c                   const(x'37')
003000090921     d c_F08           c                   const(x'38')
003100090921     d c_F09           c                   const(x'39')
003200090921     d c_F10           c                   const(x'3A')
003300090921     d c_F11           c                   const(x'3B')
003400090921     d c_F12           c                   const(x'3C')
003500090921     d c_F13           c                   const(x'B1')
003600090921     d c_F14           c                   const(x'B2')
003700090921     d c_F15           c                   const(x'B3')
003800090921     d c_F16           c                   const(x'B4')
003900090921     d c_F17           c                   const(x'B5')
004000090921     d c_F18           c                   const(x'B6')
004100090921     d c_F19           c                   const(x'B7')
004200090921     d c_F20           c                   const(x'B8')
004300090921     d c_F21           c                   const(x'B9')
004400090921     d c_F22           c                   const(x'BA')
004500090921     d c_F23           c                   const(x'BB')
004600090921     d c_F24           c                   const(x'BC')
004700090921     d c_Enter         c                   const(x'F1')
004800090921     d c_RollDown      c                   const(x'F4')
004900090921     d c_RollUp        c                   const(x'F5')
005000090921
005100090921       //--------------------------------------------------------------
005200090921       //?Definizione schiere.                                         ?
005300090921       //--------------------------------------------------------------
005400090921
005500090921
005600090921       //--------------------------------------------------------------
005700090921       //?Definizione aree dati.                                       ?
005800090921       //--------------------------------------------------------------
005900090921
006000090921       // - Dati utente
006100090921     d §AzUte        e ds                  extname(AZUTE00F)
006200090921     d                                     dtaara
006300090921     d §DatiUte      e ds                  extname(dDatiUte)
006400090921     d                                     dtaara
006500090921
006600090921       //--------------------------------------------------------------
006700090921       //?Definizione strutture dati.                                  ?
006800090921       //--------------------------------------------------------------
006900090921
007000090921       // - Status ds
007100090921     d Status         sds
007200090921     d  SDSpgm           *proc
007300090921     d  SDSprm           *parms
007400090921     d  SDSusr               254    263
007500090921
007600090921       // - InfDS
007700090921     d InfDspF         ds
007800090921     d  dsp_aid              369    369a
007900090921
008000090921       // - Indicatori su DspF
008100090921     d IndDspF         ds
008200090921        // - Abilitazione tasti funzionali
008300090921     d  AbilitF06                     1n   overlay(IndDspF : 06)
008400090921     d  AbilitF12                     1n   overlay(IndDspF : 12)
008500090921        // - Indicatori di errore
008600090921     d  ErrMessage                    1n   overlay(IndDspF : 28)
008700090921     d  ErrGenerico                   1n   overlay(IndDspF : 99)
008800090921
008900090921       // - KPJBA
009000090921     d kpjba         e ds
009100090921
009200090921       // - Parametri x Controllo profilo utenti
009300090921     d TIBS34ds      e ds
009400090921
009500090921       //--------------------------------------------------------------
009600090921       //?Definizione variabili globali.                               ?
009700090921       //--------------------------------------------------------------
009800090921
009900090921       // - Flags booleani
010000090921     d $Fine           s               n   inz(*off)
010100090921     d $InzD01         s               n   inz(*on)
010200090921     d $InzD02         s               n   inz(*on)
010300090921
010400090921       // - Campi per la gestione del video
010500090921     d $Video          s              2a   inz('D1')
010600090921
010700141126       // - Parametri x UBCHKPWD
010800141126      /copy gaitrasrc/srcProtoPi,UBCHKPWD
010900090921
011000090921       //--------------------------------------------------------------
011100090921       //?Definizione prototipi procedure usate.                       ?
011200090921       //--------------------------------------------------------------
011300090921
011400090921       // - Reperimento dati utente
011500090921      /copy gaitrasrc/srcProtoPr,TIBS34R
011600090921
011700141105       // - Prototipo srvpgm
011800141126      /copy gaitrasrc/srcProtoPr,UBCHKPWD
011900090921
012000090921       //--------------------------------------------------------------
012100090921       //?Definizione key-list.                                        ?
012200090921       //--------------------------------------------------------------
012300090921
012400090921
012500090921       //--------------------------------------------------------------
012600090921       //?Riepilogo indicatori.                                        ?
012700090921       //--------------------------------------------------------------
012800090921
012900090921
013000090921       //--------------------------------------------------------------
013100090921       //?M A I N - L I N E                                            ?
013200090921       //--------------------------------------------------------------
013300090921
013400090921     c     *Entry        plist
013500090921     c                   parm                    KPJBA
013600090921
013700090921      /free
013800090921
013900090921       // - Start
014000090921       *inLR = *on;
014100090921       V1Tpgm = SDSpgm;
014200090921
014300090921       // - Elab
014400090921       dow  $Fine = *off;
014500090921         select;
014600090921           when  $Video = 'D1';
014700090921             exsr sr_GesD01;
014800090921           when  $Video = 'D2';
014900090921             exsr sr_GesD02;
015000090921           other;
015100090921             $Fine = *on;
015200090921         endsl;
015300090921       enddo;
015400090921
015500090921       // - End
015600090921       return;
015700090921
015800090921       //--------------------------------------------------------------
015900090921       //?Operazioni iniziali                                          ?
016000090921       //--------------------------------------------------------------
016100090921       BEGSR  *InzSR;
016200090921
016300090921         // Reperimento dati utente
016400090921         exsr sr_DatiJob;
016500090921
016600090921         // Impostazione nome programma in testata a video
016700090921         V1Tpgm = SDSpgm;
016800090921
016900090921       ENDSR;
017000090921
017100090921       //--------------------------------------------------------------
017200090921       //?Reperimento Dati del job (Utente/Operativi).                 ?
017300090921       //--------------------------------------------------------------
017400090921       BEGSR  sr_DatiJob;
017500090921
017600090921         in(E) §AzUte;
017700090921         if NOT %error;
017800090921           in(E) §DatiUte;
017900090921         endif;
018000090921         if %error or RSut = *blanks;
018100090921           clear TIBS34ds;
018200090921           tibs34r(tibs34ds);
018300090921           in §AzUte;
018400090921           in §DatiUte;
018500090921         endif;
018600090921
018700090921       ENDSR;
018800090921
018900090921       //--------------------------------------------------------------
019000090921       //?Gestione videata D01                                         ?
019100090921       //--------------------------------------------------------------
019200090921       BEGSR  sr_GesD01;
019300090921
019400090921         // Inizializzazione videata
019500090921         if  $InzD01 = *on;
019600141126           clear ubCHKPWDd1;
019700090921           $InzD01 = *off;
019800090921         endif;
019900090921         AbilitF06 = *on;
020000090921         AbilitF12 = *off;
020100090921
020200090921         // Emissione videata
020300090921         if  ErrMessage = *off;
020400141126           write ubCHKPWDt1;
020500141126           write ubCHKPWDz1;
020600090921         endif;
020700090921
020800141126         exfmt ubCHKPWDd1;
020900090921
021000090921         reset ErrMessage;
021100090921         reset ErrGenerico;
021200090921
021300090921         SELECT;
021400090921
021500090921           // - F3=Fine
021600090921           WHEN  dsp_aid = c_F03;
021700090921             $Fine = *on;
021800090921
021900090921           // - Invio o F6=Conferma
022000090921           OTHER;
022100090921             exsr sr_CtrD01;
022200090921             select;
022300090921               // - rilevato errore
022400090921               when  ErrGenerico = *on;
022500090921               // - non premuto F6
022600090921               when  dsp_aid <> c_F06;
022700090921               // - richiamo *srvpgm
022800090921               other;
022900090921                 $Video = 'D2';
023000090921                 reset  $InzD02;
023100090921             endsl;
023200090921
023300090921         ENDSL;
023400090921
023500090921       ENDSR;
023600090921
023700090921       //--------------------------------------------------------------
023800090921       //?Controllo dati in videata D01                                ?
023900090921       //--------------------------------------------------------------
024000090921       BEGSR sr_CtrD01;
024100090921
024200090921         %subst(IndDspF : 28) = *off;
024300090921
024400090921       ENDSR;
024500090921
024600090921       //--------------------------------------------------------------
024700090921       //?Gestione videata D02                                         ?
024800090921       //--------------------------------------------------------------
024900090921       BEGSR  sr_GesD02;
025000090921
025100090921         // Inizializzazione videata
025200090921         if  $InzD02 = *on;
025300141126           clear  ubCHKPWDd2;
025400141126           exsr  Call_ubCHKPWD;
025500090921           $InzD02 = *off;
025600090921           AbilitF06 = *off;
025700090921           AbilitF12 = *on;
025800090921         endif;
025900090921
026000090921         // Emissione videata
026100090921         if  ErrMessage = *off;
026200141126           write ubCHKPWDt1;
026300141126           write ubCHKPWDz1;
026400141126           write ubCHKPWDd1;
026500090921           write Protect;
026600090921         endif;
026700090921
026800141126         exfmt ubCHKPWDd2;
026900090921
027000090921         reset ErrMessage;
027100090921         reset ErrGenerico;
027200090921
027300090921         SELECT;
027400090921
027500090921           // - F3=Fine
027600090921           WHEN  dsp_aid = c_F03;
027700090921             $Fine = *on;
027800090921
027900090921           // - F12=Ritorno
028000090921           WHEN  dsp_aid = c_F12;
028100090921             $Video = 'D1';
028200090921             //reset $InzD01;
028300090921             reset $InzD02;
028400090921
028500090921           // - Invio
028600090921           OTHER;
028700090921
028800090921         ENDSL;
028900090921
029000090921       ENDSR;
029100090921
029200090921       //--------------------------------------------------------------
029300141126       //?Richiamo Service Program UBCHKPWD                             ?
029400090921       //--------------------------------------------------------------
029500141126       BEGSR Call_ubCHKPWD;
029600090921
029700141127         pInSUN   = V1SUN   ;
029800141126         pInISV   = V1ISV   ;
029900141126         pInPWD   = V1PWD   ;
030000141126         pInLANG  = V1LANG  ;
030100141126         pOutKSU  = *blank;
030200141127         pOutTLE = *blank;
030300141126         pOutEsito= *blank;
030400141126         pOutMsg  = *blank;
030500090921
030600141127         V1Errore = UBCHKPWD_Check ( pInSUN : pInISV : pInPWD : pInLANG :
030700141127                                     pOutKSU : pOutTLE : pOutEsito : pOutMsg);
030800090921
030900141126         V1LANG = pInLANG;
031000141126         V1KSU = pOutKSU;
031100141127         V1TLE = pOutTLE;
031200141126         V1Esito = pOutEsito;
031300141126         V1Msg = pOutMsg;
031400090921
031500090921       ENDSR;
031600090921
031700090921      /end-free
