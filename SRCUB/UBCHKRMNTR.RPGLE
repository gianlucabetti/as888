000100100113     /*END
000200100113       //--------------------------------------------------------------
000300100113       //?TEST - VERIFICA ESISTENZA RIFERIMENTO MITTENTE NUMERICO      ?
000400100113       //--------------------------------------------------------------
000500100113
000600100113     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000700100113     h dftactgrp(*no) actgrp('QILE') bnddir('UBBNDDIR')
000800100113
000900100113       //--------------------------------------------------------------
001000100113       //?Dichiarazione file.                                          ?
001100100113       //--------------------------------------------------------------
001200100113
001300100113       // - Video
001400100113     fUBCHKRMNTDcf   e             workstn
001500100113     f                                     indds(IndDspF)
001600100113     f                                     infds(InfDspF)
001700100113
001800100113       //--------------------------------------------------------------
001900100113       //?Definizione costanti.                                        ?
002000100113       //--------------------------------------------------------------
002100100113
002200100113       // - Tasti funzionali a video
002300100113     d c_F01           c                   const(x'31')
002400100113     d c_F02           c                   const(x'32')
002500100113     d c_F03           c                   const(x'33')
002600100113     d c_F04           c                   const(x'34')
002700100113     d c_F05           c                   const(x'35')
002800100113     d c_F06           c                   const(x'36')
002900100113     d c_F07           c                   const(x'37')
003000100113     d c_F08           c                   const(x'38')
003100100113     d c_F09           c                   const(x'39')
003200100113     d c_F10           c                   const(x'3A')
003300100113     d c_F11           c                   const(x'3B')
003400100113     d c_F12           c                   const(x'3C')
003500100113     d c_F13           c                   const(x'B1')
003600100113     d c_F14           c                   const(x'B2')
003700100113     d c_F15           c                   const(x'B3')
003800100113     d c_F16           c                   const(x'B4')
003900100113     d c_F17           c                   const(x'B5')
004000100113     d c_F18           c                   const(x'B6')
004100100113     d c_F19           c                   const(x'B7')
004200100113     d c_F20           c                   const(x'B8')
004300100113     d c_F21           c                   const(x'B9')
004400100113     d c_F22           c                   const(x'BA')
004500100113     d c_F23           c                   const(x'BB')
004600100113     d c_F24           c                   const(x'BC')
004700100113     d c_Enter         c                   const(x'F1')
004800100113     d c_RollDown      c                   const(x'F4')
004900100113     d c_RollUp        c                   const(x'F5')
005000100113
005100100113       //--------------------------------------------------------------
005200100113       //?Definizione schiere.                                         ?
005300100113       //--------------------------------------------------------------
005400100113
005500100113
005600100113       //--------------------------------------------------------------
005700100113       //?Definizione aree dati.                                       ?
005800100113       //--------------------------------------------------------------
005900100113
006000100113       // - Dati utente
006100100113     d §AzUte        e ds                  extname(AZUTE00F)
006200100113     d                                     dtaara
006300100113     d §DatiUte      e ds                  extname(dDatiUte)
006400100113     d                                     dtaara
006500100113
006600100113       //--------------------------------------------------------------
006700100113       //?Definizione strutture dati.                                  ?
006800100113       //--------------------------------------------------------------
006900100113
007000100113       // - Status ds
007100100113     d Status         sds
007200100113     d  SDSpgm           *proc
007300100113     d  SDSprm           *parms
007400100113     d  SDSusr               254    263
007500100113
007600100113       // - InfDS
007700100113     d InfDspF         ds
007800100113     d  dsp_aid              369    369a
007900100113
008000100113       // - Indicatori su DspF
008100100113     d IndDspF         ds
008200100113        // - Abilitazione tasti funzionali
008300100113     d  AbilitF06                     1n   overlay(IndDspF : 06)
008400100113     d  AbilitF12                     1n   overlay(IndDspF : 12)
008500100113        // - Indicatori di errore
008600100113     d  ErrMessage                    1n   overlay(IndDspF : 28)
008700100113     d  ErrGenerico                   1n   overlay(IndDspF : 99)
008800100113
008900100113       // - Parametri x Controllo profilo utenti
009000100113     d TIBS34ds      e ds
009100100113
009200100113
009300100113       //--------------------------------------------------------------
009400100113       //?Definizione variabili globali.                               ?
009500100113       //--------------------------------------------------------------
009600100113
009700100113       // - Flags booleani
009800100113     d $Fine           s               n   inz(*off)
009900100113     d $InzD01         s               n   inz(*on)
010000100113     d $InzD02         s               n   inz(*on)
010100100113
010200100113       // - Campi per la gestione del video
010300100113     d $Video          s              2a   inz('D1')
010400100113
010500100113       //--------------------------------------------------------------
010600100113       //?Definizione prototipi procedure usate.                       ?
010700100113       //--------------------------------------------------------------
010800100113
010900100113       // - Reperimento dati utente
011000100113      /copy gaitrasrc/srcProtoPr,TIBS34R
011100100113
011200100113       // - Reperimento trk "GEN" da FIAR531C
011300100113      /copy gaitrasrc/srcProtoPr,UBCHKRMN
011400100113
011500100113       //--------------------------------------------------------------
011600100113       //?Definizione key-list.                                        ?
011700100113       //--------------------------------------------------------------
011800100113
011900100113
012000100113       //--------------------------------------------------------------
012100100113       //?Riepilogo indicatori.                                        ?
012200100113       //--------------------------------------------------------------
012300100113
012400100113
012500100113       //--------------------------------------------------------------
012600100113       //?M A I N - L I N E                                            ?
012700100113       //--------------------------------------------------------------
012800100113
012900100113      /free
013000100113
013100100113       // - Start
013200100113       *inLR = *on;
013300100113       if  ubChkRmn_Open() < *zero;
013400100113         ErrMessage  = *on;
013500100113         ErrGenerico = *on;
013600100113         V1Dmsg = 'Rilevato errore in fase di apertura archivi +
013700100113                   dal Service Program';
013800100113         write ubRMNt1;
013900100113         write ubRMNz1;
014000100113         exfmt ubRMNd1;
014100100113         $Fine = *on;
014200100113       endif;
014300100113
014400100113       // - Elab
014500100113       dow  $Fine = *off;
014600100113         select;
014700100113           when  $Video = 'D1';
014800100113             exsr sr_GesD01;
014900100113           when  $Video = 'D2';
015000100113             exsr sr_GesD02;
015100100113           other;
015200100113             $Fine = *on;
015300100113         endsl;
015400100113       enddo;
015500100113
015600100113       // - End
015700100113       //ubChkRmn_Close();
015800100113       return;
015900100113
016000100113       //--------------------------------------------------------------
016100100113       //?Operazioni iniziali                                          ?
016200100113       //--------------------------------------------------------------
016300100113       BEGSR  *InzSR;
016400100113
016500100113         // - Reperimento dati utente
016600100113         exsr sr_DatiJob;
016700100113
016800100113         // - Impostazione nome programma in testata a video
016900100113         //VTDpgm = SDSpgm;
017000100113
017100100113       ENDSR;
017200100113
017300100113       //--------------------------------------------------------------
017400100113       //?Reperimento Dati del job (Utente/Operativi).                 ?
017500100113       //--------------------------------------------------------------
017600100113       BEGSR  sr_DatiJob;
017700100113
017800100113         in(E) §AzUte;
017900100113         if NOT %error;
018000100113           in(E) §DatiUte;
018100100113         endif;
018200100113         if %error or RSut = *blanks;
018300100113           clear TIBS34ds;
018400100113           tibs34r(tibs34ds);
018500100113           in §AzUte;
018600100113           in §DatiUte;
018700100113         endif;
018800100113
018900100113       ENDSR;
019000100113
019100100113       //--------------------------------------------------------------
019200100113       //?Gestione videata D01                                         ?
019300100113       //--------------------------------------------------------------
019400100113       BEGSR  sr_GesD01;
019500100113
019600100113         // - Inizializzazione videata
019700100113         if  $InzD01 = *on;
019800100113           clear ubRMNd1;
019900100113           $InzD01 = *off;
020000100113         endif;
020100100113         AbilitF06  = *on;
020200100113         AbilitF12  = *off;
020300100113
020400100113         // - Emissione videata
020500100113         if  ErrMessage = *off;
020600100113           write ubRMNt1;
020700100113           write ubRMNz1;
020800100113         endif;
020900100113
021000100113         exfmt ubRMNd1;
021100100113
021200100113         reset ErrMessage;
021300100113         reset ErrGenerico;
021400100113         clear V1Dmsg;
021500100113
021600100113         SELECT;
021700100113
021800100113         // - F3=Fine
021900100113           WHEN  dsp_aid = c_F03;
022000100113             $Fine = *on;
022100100113
022200100113         // - Invio o F6=Conferma
022300100113           OTHER;
022400100113             exsr sr_CtrD01;
022500100113             select;
022600100113               // - rilevato errore
022700100113               when  ErrGenerico = *on;
022800100113               // - non premuto F6
022900100113               when  dsp_aid <> c_F06;
023000100113               // - premuto F6
023100100113               other;
023200100113                 $Video = 'D2';
023300100113                 reset  $InzD02;
023400100113             endsl;
023500100113
023600100113         ENDSL;
023700100113
023800100113       ENDSR;
023900100113
024000100113       //--------------------------------------------------------------
024100100113       //?Controllo dati in videata D01                                ?
024200100113       //--------------------------------------------------------------
024300100113       BEGSR sr_CtrD01;
024400100113
024500100113         %subst(IndDspF : 28) = *off;
024600100113
024700100113       ENDSR;
024800100113
024900100113       //--------------------------------------------------------------
025000100113       //?Gestione videata D02                                         ?
025100100113       //--------------------------------------------------------------
025200100113       BEGSR  sr_GesD02;
025300100113
025400100113         // - Inizializzazione videata
025500100113         if  $InzD02 = *on;
025600100113           clear  ubRMNd2;
025700100113           exsr  Call_ubChkRmn;
025800100113           $InzD02  = *off;
025900100113           AbilitF06  = *off;
026000100113           AbilitF12  = *on;
026100100113         endif;
026200100113
026300100113         // - Emissione videata
026400100113         if  ErrMessage = *off;
026500100113           write ubRMNt1;
026600100113           write ubRMNz1;
026700100113           write ubRMNd1;
026800100113           write Protect;
026900100113         endif;
027000100113
027100100113         exfmt ubRMNd2;
027200100113
027300100113         reset ErrMessage;
027400100113         reset ErrGenerico;
027500100113         clear V1Dmsg;
027600100113
027700100113         SELECT;
027800100113
027900100113           // - F3=Fine
028000100113           WHEN  dsp_aid = c_F03;
028100100113             $Fine = *on;
028200100113
028300100113           // - F12=Ritorno
028400100113           WHEN  dsp_aid = c_F12;
028500100113             $Video = 'D1';
028600100113             //reset $InzD01;
028700100113             reset $InzD02;
028800100113
028900100113           // - Invio
029000100113           OTHER;
029100100113
029200100113         ENDSL;
029300100113
029400100113       ENDSR;
029500100113
029600100113       //--------------------------------------------------------------
029700100113       //?Richiamo Service Program ubChkRmn                            ?
029800100113       //--------------------------------------------------------------
029900100113       BEGSR Call_ubChkRmn;
030000100113
030100100113         V2Cesito = ubChkRmn_Exist ( V1Cccm : V1Crmn :
030200100113                                     V2Fvab : V2Fblp : V2Ftas );
030300100113
030400100113       ENDSR;
030500100113
030600100113      /end-free
