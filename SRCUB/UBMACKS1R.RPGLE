000100121217       //==============================================================
000200161110       // Wrapper per TIMAC00F - differenza e storico 1
000300121217       //==============================================================
000400141008
000500121217       //--------------------------------------------------------------
000600161103       // Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700121217       //--------------------------------------------------------------
000800121217
000900121217     /*PRM dbgview(*source)
001000121217     /*PRM commit(*none)
001100121217     /*END
001200161108     **
001300161108     ** ISTRUZIONI PER LA COMPILAZIONE
001400161108     **
001500161110     ** 1. Creare il pgm UBMACKS1R (Opz 14 PDM)
001600161108     **
001700121217
001800121217       //--------------------------------------------------------------
001900161103       // Specifiche di controllo.                                     ?
002000121217       //--------------------------------------------------------------
002100121217
002200121217     h decedit('0,') datedit(*dmy/) option(*nodebugio)
002300161110     h dftactgrp(*no) actgrp('QILE')
002400161110     h bnddir('UBBNDDIR')
002500121217
002600121217       //--------------------------------------------------------------
002700161103       // Dichiarazione file.                                          ?
002800121217       //--------------------------------------------------------------
002900121217
003000121217       //--------------------------------------------------------------
003100161103       // Definizione costanti.                                        ?
003200121217       //--------------------------------------------------------------
003300121217
003400121217
003500121217       //--------------------------------------------------------------
003600161103       // Definizione schiere.                                         ?
003700121217       //--------------------------------------------------------------
003800121217
003900121217
004000121217       //--------------------------------------------------------------
004100161103       // Definizione aree dati.                                       ?
004200121217       //--------------------------------------------------------------
004300121217
004400121217
004500121217       //--------------------------------------------------------------
004600161103       // Definizione strutture dati.                                  ?
004700121217       //--------------------------------------------------------------
004800121217
004900161110       // - Architettura
005000161110     d kpjba         e ds
005100161117     d sav_kpjba       s                   like(kpjba)
005200121218
005300161103       // - Status?
005400121217     d Psds           sds
005500121217     d   SDSpgm          *proc
005600121217     d*//JobName             244    253                                         Job name
005700161103     d*//JobUser             254    263
005800121217     d*//JobNumber           264    269s 0                                      Job number
005900121217
006000121217       //--------------------------------------------------------------
006100161103       // Definizione variabili.                                       ?
006200121217       //--------------------------------------------------------------
006300121217
006400161110       // Periodo DA in kpjbu
006500161110     d DtDa            s             10
006600161110       // Periodo AL in kpjbu
006700161110     d DtAl            s             10
006800161110
006900161111       // Opzione
007000161111     d MACHKOpz        s              1
007100161111       // Periodo DA
007200161111     d MACHKTSDa       s               z
007300161110       // Periodo AL
007400161110     d MACHKTSAl       s               z
007500161110       // Esito
007600161110     d MACHKEsito      s              1
007700121218
007800121217       //--------------------------------------------------------------
007900161103       // Definizione prototipi procedure.                             ?
008000121217       //--------------------------------------------------------------
008100121217
008200161110       /copy gaitrasrc/srcProtoPR,UBMACHK1R
008300161110       /copy gaitrasrc/srcProtoPR,UBMASTO1R
008400161117     d UBMACKS1R1...
008500161117     d                 pr                  extpgm('UBMACKS1R1')
008600161117     d kpjba                        502a
008700121217
008800121217       //--------------------------------------------------------------
008900161103       // Definizione key-list.                                        ?
009000121217       //--------------------------------------------------------------
009100161104
009200121217
009300121217       //--------------------------------------------------------------
009400161103       // Definizione parametri procedura.                             ?
009500121217       //--------------------------------------------------------------
009600121217
009700161103
009800121217       //--------------------------------------------------------------
009900121217       //?M A I N - L I N E                                            ?
010000121217       //--------------------------------------------------------------
010100121217
010200161014       // Operazioni iniziali?
010300121217       exsr sr_RoutInz;
010400121217
010500161110       // Esecuzione
010600161110       exsr  sr_Esegui;
010700121217
010800161103       // - Operazioni finali?
010900121217       exsr sr_RoutEnd;
011000121217
011100121217       //--------------------------------------------------------------
011200161103       // Operazioni iniziali.                                         ?
011300121217       //--------------------------------------------------------------
011400121217       BEGSR  sr_RoutInz;
011500161111     C*
011600161111     C     *ENTRY        PLIST
011700161111     C                   PARM                    KPJBA
011800121217
011900161110         // - Reperisco dati di ingresso
012000161110         if %subst(kpjbu : 1 : 10) <> *blank;
012100161110           DtDa = %subst(kpjbu : 1 : 10);
012200161110         else;
012300161110           DtDa = '0001-01-01';
012400161110         endif;
012500161110         if %subst(kpjbu : 11 : 10) <> *blank;
012600161110           DtAl = %subst(kpjbu : 11 : 10);
012700161110         else;
012800161110           DtAl = '0001-01-01';
012900161110         endif;
013000161110
013100161110         // - Controllo parametri d'ingresso
013200161110         exsr  sr_CtrlParms;
013300130208
013400140925       ENDSR;
013500141028
013600141028       //--------------------------------------------------------------
013700161103       // Controllo parametri
013800141028       //--------------------------------------------------------------
013900161103       BEGSR  sr_CtrlParms;
014000161014
014100161110         // i controlli li faccio fare ai chiamati
014200161111         MACHKOpz  = %subst(kpjbu : 21 : 1);
014300161110         MACHKTSDa = %timestamp(%date(DtDa));
014400161110         MACHKTSAl = %timestamp(%date(DtAl));
014500161103
014600161103       ENDSR;
014700121217
014800121217       //--------------------------------------------------------------
014900161110       // Esecuzione
015000121217       //--------------------------------------------------------------
015100161110       BEGSR  sr_Esegui;
015200161103
015300161110         // chiamo per creare TIMAC
015400161111         UBMACHK1R_S( MACHKOpz :
015500161111                      MACHKTSDa :
015600161111                      MACHKTSAl :
015700161111                      MACHKEsito );
015800161110
015900161110         // chiamo per cristallizzare TIMAC
016000161110         UBMASTO1R_S( *blank :
016100161110                      MACHKTSDa :
016200161110                      MACHKTSAl :
016300161110                      MACHKEsito );
016400161117
016500161117         // chiamo per testare il ritardo invio email
016600161117         if %subst(kpjbu:22:1) = 'S';
016700161117           sav_kpjba=kpjba;
016800161117           clear kpjbu;
016900161117           UBMACKS1R1(kpjba);
017000161117           kpjba=sav_kpjba;
017100161117         endif;
017200121217
017300121217       ENDSR;
017400161110
017500161110       //--------------------------------------------------------------
017600161110       // Operazioni finali.                                           ?
017700161110       //--------------------------------------------------------------
017800161110       BEGSR  sr_RoutEnd;
017900161110
018000161110         // - Chiusura pgm?
018100161110         return;
018200161110
018300161110       ENDSR;
018400161110
