000100100817       //==============================================================
000200100817       //?                                                             ?
000300100817       //?VISUALIZZAZIONE  INDICATORI UTILIZZATI DA UN PGM. RPG ILE    ?
000400100817       //?                                                             ?
000500100817       //==============================================================
000600110218
000700110218       //--------------------------------------------------------------
000800110218       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000900110218       //--------------------------------------------------------------
001000110218
001100110218     /*CMD ovrdbf file(SOURCE) tofile(GAITRASRC/SRCTRUL) ovrscope(*calllvl)
001200110218     /*END dltovr file(SOURCE) lvl(*)
001300110218     /*END
001400110218
001500110218       //--------------------------------------------------------------
001600110218       //?Specifiche di controllo.                                     ?
001700110218       //--------------------------------------------------------------
001800100817
001900100817     h debug decedit('0,') datedit(*DMY/)
002000100817
002100110218       //--------------------------------------------------------------
002200110218       //?Dichiarazione file.                                          ?
002300110218       //--------------------------------------------------------------
002400110218
002500110218       // -?Sorgente?
002600110218     fSOURCE    if   f   92        disk
002700110218
002800110218       // -?Video?
002900100817     fUBONOFFD  cf   e             workstn
003000110218
003100110218       //--------------------------------------------------------------
003200110218       //?Definizione costanti.                                        ?
003300110218       //--------------------------------------------------------------
003400110218
003500110218       // -?Attributi di Visualizzazione?
003600110218     d c_DspAtrNorm    c                   const(x'A0')
003700110218     d c_DspAtr_HI_RI  c                   const(x'A3')
003800110218     d c_DspAtr_ND     c                   const(x'A7')
003900110218     d c_DspAtrRed_RI  c                   const(x'A9')
004000110218
004100110218       // -?Costante x CHECK numerico di un campo alfa?
004200110218     d c_Digits        c                   const('0123456789')
004300110218
004400110218       // -?Caratteri minuscoli?
004500110218     d c_Minusc        c                   const('abcdefghijklm+
004600110218     d                                            nopqrstuvwxyz+
004700110218     d                                            ‡·‚„‰Â+
004800110218     d                                            ÊÁ+
004900110218     d                                            ËÈÍÎ+
005000110218     d                                            ÏÌÓÔ+
005100110218     d                                            ÚÛÙıˆ+
005200110218     d                                            ˘˙˚¸')
005300110218
005400110218       // -?Caratteri maiuscoli?
005500110218     d c_Maiusc        c                   const('ABCDEFGHIJKLM+
005600110218     d                                            NOPQRSTUVWXYZ+
005700110218     d                                            ¿¡¬√ƒ≈+
005800110218     d                                            ∆«+
005900110218     d                                            »… À+
006000110218     d                                            ÃÕŒœ+
006100110218     d                                            “”‘’÷+
006200110218     d                                            Ÿ⁄€‹')
006300110218
006400110218       //--------------------------------------------------------------
006500110218       //?Definizione schiere.                                         ?
006600110218       //--------------------------------------------------------------
006700100817
006800110218       // -?Indicatorei in spedifiche "I" del sorgente?
006900100817     d $I              s              2    dim(5)
007000110218       // -?Indicatorei in spedifiche "C" del sorgente?
007100100817     d $C              s              2    dim(4)
007200110218     d SK              s              6    dim(3)
007300110218       // -?Indicatorei in spedifiche "O" del sorgente?
007400100817     d $O              s              2    dim(3)
007500110218
007600110218       // -?Elenco completo indicatori usati?
007700100817     d SavInd          s              1    dim(99)
007800110218
007900110218       //--------------------------------------------------------------
008000110218       //?Definizione aree dati.                                       ?
008100110218       //--------------------------------------------------------------
008200110218
008300110218
008400110218       //--------------------------------------------------------------
008500110218       //?Definizione strutture dati.                                  ?
008600110218       //--------------------------------------------------------------
008700110218
008800100817     d dsIN            ds             2    inz
008900100817     d  dsIN1                  1      1    inz
009000100817     d  dsIN2                  2      2    inz
009100110218
009200110218       //--------------------------------------------------------------
009300110218       //?Definizione variabili globali.                               ?
009400110218       //--------------------------------------------------------------
009500110218
009600110218       // -?Flags booleani?
009700110218     d $All            s               n   inz(*off)
009800100817     d $Free           s               n   inz(*off)
009900100817     d $IndDs          s               n   inz(*off)
010000100817     d $Overlay        s               n   inz(*off)
010100151210     d $SeeNextRow     s               n   inz
010200151210     d $Almeno_1_ind   s               n   inz
010300110218
010400110218       // -?Indici di schiera?
010500151210     d xx              s              2  0 inz
010600151210     d yy              s              2  0 inz
010700100817     d wIN             s              2  0 inz
010800110218
010900110218       // -?Campi di comodo?
011000100817     d wIndDs          s             44    inz
011100110218
011200110218       //--------------------------------------------------------------
011300110218       //?Definizione prototipi procedure.                             ?
011400110218       //--------------------------------------------------------------
011500110218
011600110218
011700110218       //--------------------------------------------------------------
011800110218       //?Definizione key-list.                                        ?
011900110218       //--------------------------------------------------------------
012000110218
012100110218
012200110218       //--------------------------------------------------------------
012300110218       //?Specifiche di input.                                         ?
012400110218       //--------------------------------------------------------------
012500100817
012600110218       // -?Membro Sorgente?
012700100817     iSOURCE    nn
012800100817     i                                 13   14  EOF
012900100817     i                                 18   18  SPEC
013000100817     i                                 19   19  CHAR
013100100817     i                                 19   27  FREE
013200100817     i                                 19   92  FreeSpec
013300100817     i                                 38   47  CodOpe
013400110218       //   ∑?Specifiche "I"?
013500100817     i                                 33   34  $I(1)
013600100817     i                                 79   80  $I(2)
013700100817     i                                 81   82  $I(3)
013800100817     i                                 83   84  $I(4)
013900100817     i                                 85   86  $I(5)
014000110218       //   ∑?Specifiche "F"?
014100100817     i                                 56   60  IndDs
014200100817     i                                 61   92  SpecF
014300110218       //   ∑?Specifiche "D"?
014400151210     i                                 19   92  d_ds_Name_cmpl
014500151210     i                                 19   33  d_ds_Name
014600100817     i                                 35   38  d_ds_
014700100817     i                                 41   44  d_IndDs_i
014800100817     i                                 48   51  d_IndDs_f
014900100817     i                                 56   92  Overlay
015000110218       //   ∑?Specifiche "C"?
015100100817     i                                 22   23  $C(1)
015200100817     i                                 83   84  $C(2)
015300100817     i                                 85   86  $C(3)
015400100817     i                                 87   88  $C(4)
015500100817     i                                 24   29  SK(1)
015600100817     i                                 48   53  SK(2)
015700100817     i                                 62   67  SK(3)
015800100817     i                                 48   91  Fatt2
015900110218       //   ∑?Specifiche "O"?
016000100817     i                                 36   37  $O(1)
016100100817     i                                 39   40  $O(2)
016200100817     i                                 42   43  $O(3)
016300110218
016400110218       //--------------------------------------------------------------
016500110218       //?M A I N - L I N E                                            ?
016600110218       //--------------------------------------------------------------
016700100817
016800100817     c     *Entry        plist
016900100817     c                   parm                    £Lib             10
017000100817     c                   parm                    £SrcF            10
017100100817     c                   parm                    £Mbr             10
017200100817     c                   parm                    £Type            10
017300100817     c                   parm                    £IndDs            4
017400100817      /free
017500100817
017600100817       *inLR = *on;
017700100817
017800110218       // -?Ciclo di lettura specifiche nel membro sorgente?
017900100817       DoU  %eof(Source);
018000100817
018100100817         read  Source;
018200100817
018300100817         if  %eof(SOURCE)   or   EoF = '**';
018400100817           leave;
018500100817         endif;
018600100817
018700110218         // -?Record "particolari"?
018800100817         if  Spec = '/'   or
018900100817             Char = '/'   or
019000100817             Char = '+'   or
019100100817             Char = '*';
019200100817           Free = %xlate( c_Minusc : c_Maiusc : Free );
019300100817           select;
019400100817             when  Free = '/FREE     ';
019500100817               $Free = *on;
019600100817             when  Free = '/END-FREE ';
019700100817               $Free = *off;
019800100817           endsl;
019900100817           iter;
020000100817         endif;
020100100817
020200100817         select;
020300110218           // -?Specifica in free-format?
020400100817           when  $Free = *on;
020500100817             exsr  sr_Free;
020600110218           // -?Specifica "F"?
020700100817           when  (Spec = 'F'   or   Spec = 'f')   and
020800100817                 wIndDs = *blank                  and
020900100817                 £IndDs = '*YES';
021000100817             exsr  sr_F;
021100110218           // -?Specifica "D"?
021200100817           when  (Spec = 'D'   or   Spec = 'd')   and
021300100817                 wIndDs <> *blank;
021400100817             exsr  sr_D;
021500110218           // -?Specifica "I"?
021600100817           when   Spec = 'I'   or   Spec = 'i';
021700100817             exsr  sr_I;
021800110218           // -?Specifica "C"?
021900100817           when   Spec = 'C'   or   Spec = 'c';
022000100817             exsr  sr_C;
022100110218           // -?Specifica "O"?
022200110218           when   Spec = 'O'   or   Spec = 'o';
022300100817             exsr  sr_O;
022400100817         endsl;
022500100817
022600100817       EndDo;
022700100817
022800110218       // -?Emissione window?
022900100817       W1typ = £Type + ':';
023000100817       W1pgm = £Mbr;
023100100817       W1lib = £Lib;
023200100817       W1fil = £SrcF;
023300100817       *in   = SavInd;
023400110218       if  $All;
023500110218         DAxAll = c_DspAtr_HI_RI;
023600110218       else;
023700110218         DAxAll = c_DspAtr_ND;
023800110218       endif;
023900100817       exfmt  OnOffW1;
024000100817
024100100817       //--------------------------------------------------------------
024200100817       //?TEST X INDICATORI SPECFICHE DI DEFINIZIONE FILE ("F")        ?
024300100817       //--------------------------------------------------------------
024400100817       BEGSR  sr_F;
024500100817
024600100817         IndDs = %xlate ( c_Minusc : c_Maiusc : IndDs );
024700100817
024800100817         if  IndDs = 'INDDS';
024900100817           xx = %scan( '(' : SpecF );
025000100817           yy = %scan( ')' : SpecF );
025100100817           if  xx = *zero   or   yy = *zero;
025200100817             leavesr;
025300100817           endif;
025400100817           xx += 1;
025500100817           yy -= 1;
025600100817           wIndDs = %trim( %subst( SpecF : xx : yy - xx + 1 ) );
025700100817           wIndDs = %xlate ( c_Minusc : c_Maiusc : wIndDs );
025800100817         endif;
025900100817
026000100817       ENDSR;
026100100817
026200100817       //--------------------------------------------------------------
026300100817       //?TEST X INDICATORI SPECFICHE "D"                              ?
026400100817       //--------------------------------------------------------------
026500100817       BEGSR  sr_D;
026600100817
026700151210         //*//d_ds_Name = %xlate ( c_Minusc : c_Maiusc : d_ds_Name );
026800151210         d_ds_Name_cmpl = %xlate ( c_Minusc : c_Maiusc : d_ds_Name_cmpl );
026900151210         d_ds_     = %xlate ( c_Minusc : c_Maiusc : d_ds_   );
027000100817         Overlay   = %xlate ( c_Minusc : c_Maiusc : Overlay );
027100151210
027200151210         if  Not $IndDs  and  Not $SeeNextRow;
027300151210           $SeeNextRow = ( %scan( '...' : d_ds_Name_cmpl ) > *zero );
027400151210         endif;
027500100817
027600110218         // -?Verifica se inizia o finisce la definizione "INDDS"?
027700100817         select;
027800151210           when  Not $IndDs  and  d_ds_Name_cmpl <> *blank
027900151210                             and  $SeeNextRow;
028000151210             $IndDs = ( %scan( %trim(wIndDs) :
028100151210                               %trimR(d_ds_Name_cmpl) ) > *zero );
028200151210           when  Not $IndDs  and  d_ds_Name <> *blank
028300151210                             and  d_ds_     =  ' DS ';
028400100817             $IndDs = ( d_ds_     =  ' DS '   and
028500100817                        d_ds_Name <> *blank   and
028600160413                        %scan( %trim(wIndDs) : %trimr(d_ds_Name_cmpl) )
028700160413                                  >  *zero );
028800151210           when  $IndDs      and  d_ds_     <> ' DS ';
028900151210           when  $IndDs      and  d_ds_     =  ' DS '
029000151210                             and  $SeeNextRow
029100151210                             and  Not $Almeno_1_ind;
029200151210           when  $IndDs      and  %scan( '...' : d_ds_Name_cmpl ) > *zero;
029300151210             $IndDs = *off;
029400151210           when  $IndDs      and  d_ds_     =  ' DS ';
029500100817             $IndDs = *off;
029600100817         endsl;
029700100817         if  Not $IndDs;
029800100817           leavesr;
029900100817         endif;
030000100817
030100110218         // -?Verifica se indicatori definiti via "OVERLAY" o?
030200110218         //  ?se definiti a posizioni fisse?
030300100817         clear  xx;
030400100817         xx = %scan( 'OVERLAY' : Overlay );
030500100817         if  xx > *zero    and
030600100817             %scan( %trim(wIndDs) : Overlay : xx + 1 ) > *zero;
030700100817           $Overlay = *on;
030800100817         Else;
030900100817           $Overlay = *off;
031000100817         endif;
031100100817
031200110218         // -?Reperimento indicatori utilizzati?
031300100817         clear  xx;
031400100817         clear  yy;
031500100817         select;
031600100817           when  $Overlay;
031700100817             xx = %scan( ':' : Overlay : xx + 1 );
031800100817             yy = %scan( ')' : Overlay : xx + 1 );
031900100817           when  d_IndDs_i = *blank   or
032000100817                 d_IndDs_f = *blank   or
032100100817                 %check ( c_Digits : %triml(d_IndDs_i) ) > *zero   or
032200100817                 %check ( c_Digits : %triml(d_IndDs_f) ) > *zero;
032300100817           other;
032400100817             xx = %int( %triml( d_IndDs_i ) );
032500100817             yy = %int( %triml( d_IndDs_f ) );
032600100817         endsl;
032700100817
032800100817         if  xx = *zero   or   yy = *zero;
032900100817           leavesr;
033000100817         endif;
033100100817
033200151209         If  $Overlay;
033300151209           xx += 1;
033400151209           yy -= 1;
033500151209           wIn = %int( %trim( %subst( Overlay : xx : yy - xx + 1 ) ) );
033600151209         Else;
033700151209           wIn = xx;
033800151209         EndIf;
033900100817
034000100817         if  wIN > *zero;
034100100817           SavInd(wIN) = *on;
034200100817         endif;
034300151210
034400151210         $Almeno_1_ind = *on;
034500100817
034600100817       ENDSR;
034700100817
034800100817       //--------------------------------------------------------------
034900100817       //?TEST X INDICATORI SPECFICHE DI INPUT                         ?
035000100817       //--------------------------------------------------------------
035100100817       BEGSR  sr_I;
035200100817
035300100817         For  xx = 1  To  5;
035400100817
035500100817           if  %check( c_Digits : $I(xx) ) = *zero;
035600100817             wIN = %int( $I(xx) );
035700100817             if  wIN > *zero;
035800100817               SavInd(wIN) = *on;
035900100817             endif;
036000100817           endif;
036100100817
036200100817         EndFor;
036300100817
036400100817       ENDSR;
036500100817
036600100817       //--------------------------------------------------------------
036700100817       //?TEST X INDICATORI SPECFICHE DI CALCOLO                       ?
036800100817       //--------------------------------------------------------------
036900100817       BEGSR  sr_C;
037000100817
037100100817         if  CodOpe <> *blank;
037200100817           Free = %xlate( c_Minusc : c_Maiusc : CodOpe );
037300100817           exsr  sr_C1;
037400100817         endif;
037500100817
037600151209         if  Free <> 'IF   '   and
037700151209             Free <> 'DOU  '   and
037800151209             Free <> 'DOW  '   and
037900151209             Free <> 'WHEN '   and
038000151209             Free <> 'EVAL '   and
038100151209             Free <> *blank;
038200100817           exsr  sr_C2;
038300100817         else;
038400100817           exsr  sr_C3;
038500100817         endif;
038600100817
038700100817       ENDSR;
038800100817
038900100817       //--------------------------------------------------------------
039000100817       //?Specifiche "C": 'nn' a sinistra (1) e a destra (3)           ?
039100100817       //--------------------------------------------------------------
039200100817       BEGSR  sr_C1;
039300100817
039400100817         For  xx = 1  To  4;
039500100817
039600100817           if  %check( c_Digits : $C(xx) ) = *zero;
039700100817             wIN = %int( $C(xx) );
039800100817             if  wIN > *zero;
039900100817               SavInd(wIN) = *on;
040000100817             endif;
040100100817           endif;
040200100817
040300151209           if  Free = 'IF   '   or
040400151209               Free = 'DOU  '   or
040500151209               Free = 'DOW  '   or
040600151209               Free = 'WHEN '   or
040700151209               Free = 'EVAL ';
040800100817             leave;
040900100817           endif;
041000100817
041100100817         EndFor;
041200100817
041300100817       ENDSR;
041400100817
041500100817       //--------------------------------------------------------------
041600100817       //?Specifiche "C": '*INnn' in fatt.1/2 o risultato              ?
041700100817       //--------------------------------------------------------------
041800100817       BEGSR  sr_C2;
041900100817
042000100817         For  xx = 1  To  3;
042100100817
042200100817           if  %subst(SK(xx):1:3) = '*IN'   or
042300100817               %subst(SK(xx):1:3) = '*in'   or
042400100817               %subst(SK(xx):1:3) = '*In'   or
042500100817               %subst(SK(xx):1:3) = '*iN';
042600100817
042700110218             select;
042800110218
042900110218               when  %subst( SK(xx) : 4 : 1 ) = *blank;
043000110218                 $All = *on;
043100110218                 iter;
043200100817
043300110218               when  %subst( SK(xx) : 4 : 1 ) = '(';
043400110218                 dsIN = %subst( SK(xx) : 5 : 2 );
043500110218
043600110218               other;
043700110218                 dsIN = %subst( SK(xx) : 4 : 2 );
043800110218
043900110218             endsl;
044000100817
044100100817             if  dsIN2 = *blank;
044200100817               dsIN2 = dsIN1;
044300100817               dsIN1 = *zero;
044400100817             endif;
044500100817
044600100817             if  %check( c_Digits : dsIN ) = *zero;
044700100817               wIN = %int( dsIN );
044800100817               if  wIN > *zero;
044900100817                 SavInd(wIN) = *on;
045000100817                 leavesr;
045100100817               endif;
045200100817             endif;
045300100817
045400100817           endif;
045500100817
045600100817         EndFor;
045700100817
045800100817       ENDSR;
045900100817
046000100817       //--------------------------------------------------------------
046100100817       //?Specifiche "C": '*INxx' in fatt.2 esteso                     ?
046200100817       //--------------------------------------------------------------
046300100817       BEGSR  sr_C3;
046400100817
046500100817         clear  xx;
046600100817         clear  yy;
046700100817
046800100817         DoU  xx = *zero;
046900100817
047000100817           yy = xx + 1;
047100100817           xx = %scan('*in' : Fatt2 : yy);
047200100817           if  xx = *zero;
047300100817             xx = %scan('*IN' : Fatt2 : yy);
047400100817             if  xx = *zero;
047500100817               xx = %scan('*In' : Fatt2 : yy);
047600100817               if  xx = *zero;
047700100817                 xx = %scan('*iN' : Fatt2 : yy);
047800100817               endif;
047900100817             endif;
048000100817           endif;
048100100817
048200100817           if  xx = *zero;
048300100817             leave;
048400100817           endif;
048500100817
048600110218           select;
048700110218
048800151210             when  %subst( Fatt2 : XX+3 : 1 ) = *blank;
048900110218               $All = *on;
049000110218               leave;
049100110218
049200151210             when  %subst( Fatt2 : XX+3 : 1 ) = '(';
049300110218               dsIN = %subst( Fatt2 : XX+4 : 2);
049400110218
049500110218             other;
049600110218               dsIN = %subst( Fatt2 : XX+3 : 2 );
049700110218
049800110218           endsl;
049900100817
050000100817           if  dsIN2 = *blank;
050100100817             dsIN2 = dsIN1;
050200100817             dsIN1 = *zero;
050300100817           endif;
050400100817
050500100817           if  %check( c_Digits : dsIN ) = *zero;
050600100817             wIN = %int( dsIN );
050700100817             if  wIN > *zero;
050800100817               SavInd(wIN) = *on;
050900100817               leavesr;
051000100817             endif;
051100100817           endif;
051200100817
051300100817         EndDo;
051400100817
051500100817       ENDSR;
051600100817
051700100817       //--------------------------------------------------------------
051800100817       //?TEST X INDICATORI SPECFICHE "FREE"                           ?
051900100817       //--------------------------------------------------------------
052000100817       BEGSR  sr_Free;
052100110217
052200110217         If  $Free;
052300110217           // -?"Exec Sql"?
052400110217           xx = %scan( 'EXEC ' : FreeSpec );
052500110217           if  xx > *zero   and
052600110217               %scan( ' SQL ' : FreeSpec : xx ) > *zero;
052700110217             leavesr;
052800110217           endif;
052900110217           // -?Commento ("//")?
053000110217           xx = %scan( '//' : FreeSpec );
053100110217           if  xx > *zero;
053200110217             %subst( FreeSpec : xx ) = *blank;
053300110217           endif;
053400110217           if  xx = 1   or
053500110217              (xx > 1   and   %subst( FreeSpec : 1 : xx ) = *blank);
053600110217             leavesr;
053700110217           endif;
053800110217         EndIf;
053900100817
054000100817         clear  xx;
054100100817         clear  yy;
054200100817
054300100817         DoU  xx = *zero;
054400100817
054500100817           yy = xx + 1;
054600110218           xx = %scan('*in' : FreeSpec : yy);
054700100817           if  xx = *zero;
054800110218             xx = %scan('*IN' : FreeSpec : yy);
054900100817             if  xx = *zero;
055000110218               xx = %scan('*In' : FreeSpec : yy);
055100100817               if  xx = *zero;
055200110218                 xx = %scan('*iN' : FreeSpec : yy);
055300100817               endif;
055400100817             endif;
055500100817           endif;
055600100817
055700100817           if  xx = *zero;
055800100817             leave;
055900100817           endif;
056000100817
056100100817           select;
056200100817             when  %subst( FreeSpec : xx+3 : 1 ) = *blank;
056300110218               $All = *on;
056400110218               leave;
056500100817             when  %subst( FreeSpec : xx+3 : 1 ) = '(';
056600100817               dsIN = %subst( FreeSpec : xx+4 : 2 );
056700100817             other;
056800100817               dsIN = %subst( FreeSpec : xx+3 : 2 );
056900100817           endsl;
057000100817
057100100817           if  dsIN2 = *blank;
057200100817             dsIN2 = dsIN1;
057300100817             dsIN1 = *zero;
057400100817           endif;
057500100817
057600100817           if  %check( c_Digits : dsIN ) = *zero
057700100817               and  dsIN > *zero;
057800100817             wIN = %int( dsIN );
057900100817             if  wIN > *zero;
058000100817               SavInd(wIN) = *on;
058100100817             endif;
058200100817           endif;
058300100817
058400100817         EndDo;
058500100817
058600100817       ENDSR;
058700100817
058800100817       //--------------------------------------------------------------
058900100817       //?TEST X INDICATORI SPECFICHE DI OUTPUT                        ?
059000100817       //--------------------------------------------------------------
059100100817       BEGSR  sr_O;
059200100817
059300100817         For  xx = 1  To  3;
059400100817
059500100817           if  $O(xx) <> '1P';
059600100817
059700100817             if  %check( c_Digits : $O(xx) ) = *zero;
059800100817               wIN = %int( $O(xx) );
059900100817               if  wIN > *zero;
060000100817                 SavInd(wIN) = *on;
060100100817               endif;
060200100817             endif;
060300100817           endif;
060400100817
060500100817         EndFor;
060600100817
060700100817       ENDSR;
060800100817
060900100817      /end-free
