000100091228       //==============================================================
000200160204       // Driver reperimento dati da TNTBE00F tab.AOP
000300091228       //==============================================================
000400091228
000500091228       //--------------------------------------------------------------
000600121106       // Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700091228       //--------------------------------------------------------------
000800091228
000900100325     /*PRM dbgview(*source)
001000091223     /*END
001100160202     **
001200160202     ** ISTRUZIONI PER LA COMPILAZIONE
001300160202     **
001400160202     ** 1. Creare il modulo UBTA400R (Opz 15 PDM)
001500160202     ** 2. Creare/Aggiornare il programma di servizio UBTA400R (CRTSRVPGM / UPDSRVPGM)
001600160202     **    con ACTGRP(*caller)
001700160202     **    aggiungere nella BNDDIR(UBBNDDIR)
001800160202     ** 3. Creare/Aggiornare il programma UBTA400R (CRTPGM / UPDPGM)
001900160202     **    con ACTGRP(*caller)
002000160202     ** 4. Cancellare il modulo.
002100160202     **
002200091228
002300091228       //--------------------------------------------------------------
002400121106       // Specifiche di controllo.
002500091228       //--------------------------------------------------------------
002600091223
002700091223     h decedit('0,') datedit(*dmy/) option(*nodebugio)
002800091223     h alwnull(*inputonly)
002900091223
003000091223       //--------------------------------------------------------------
003100121106       // Dichiarazione file.
003200091223       //--------------------------------------------------------------
003300100112
003400091223
003500091223       //--------------------------------------------------------------
003600121106       // Definizione costanti.
003700091223       //--------------------------------------------------------------
003800100302
003900091223
004000091223       //--------------------------------------------------------------
004100121106       // Definizione schiere.
004200091223       //--------------------------------------------------------------
004300091223
004400091223
004500091223       //--------------------------------------------------------------
004600121106       // Definizione aree dati.
004700091223       //--------------------------------------------------------------
004800091223
004900091223
005000140724       //--------------------------------------------------------------
005100140724       // Definizione strutture dati.
005200140724       //--------------------------------------------------------------
005300140724
005400121106       // - Status
005500110516     d Psds           sds
005600110516     d   SDSpgm          *proc
005700121106     d   JobName             244    253                                         Job name
005800121106     d   JobUser             254    263                                         User name
005900121106     d   JobNumber           264    269s 0                                      Job number
006000160202
006100160202       // - DS per TITA400f tipo record "A"
006200160204     d DAOP001       e ds
006300091223
006400091223       //--------------------------------------------------------------
006500121106       // Definizione variabili.
006600091223       //--------------------------------------------------------------
006700091223
006800121106       // - Parametri ricevuti:
006900160202     d pIn_Opz         s              1a
007000160202       // tipo lancio: 'C'=LR   *blank=RT
007100160202     d pIn_TLa         s              1a
007200160204     d pIn_KEY         s             15s 0
007300160204     d pIn_Data        s              8s 0
007400160202       // esito chiamata: 0=OK   1=ERR INPUT   2=KO
007500160202     d pOut_ERR        s              1s 0
007600160202     d pOut_DS         s             10a
007700160204     d pOut_Len        s              3s 0
007800160204     d pOut_Dati       s            256a
007900121106
008000121106       // Campi di comodo
008100121106     d wDate           s              8  0 inz
008200091223
008300091223       //--------------------------------------------------------------
008400121106       // Definizione prototipi procedure.
008500091223       //--------------------------------------------------------------
008600130307
008700091223       //--------------------------------------------------------------
008800121106       // Definizione key-list.
008900091223       //--------------------------------------------------------------
009000091223
009100091223
009200091223       //--------------------------------------------------------------
009300121107       // Definizione parametri procedura.
009400091223       //--------------------------------------------------------------
009500091223
009600091223     c     *Entry        plist
009700160202     c                   parm                    pIn_Opz
009800160204     c                   parm                    pIn_TLa
009900160204     c                   parm                    pIn_Key
010000160204     c                   parm                    pIn_Data
010100160202     c                   parm                    pOut_ERR
010200160202     c                   parm                    pOut_DS
010300160202     c                   parm                    pOut_Len
010400160202     c                   parm                    pOut_Dati
010500091223
010600130307      /free
010700091223
010800091223       //--------------------------------------------------------------
010900121106       // M A I N - L I N E
011000091223       //--------------------------------------------------------------
011100140806
011200130307       // Operazioni iniziali?
011300130307       exsr sr_RoutInz;
011400130307
011500140724       // attività richiesta dal chiamante se non chiamato per chiusura
011600160202       if pIn_TLa = *blank;
011700160202         K_TA4AAS = pIn_AAS;
011800160202         K_TA4LNP = pIn_LNP;
011900160202         K_TA4NRS = pIn_NRS;
012000160202         K_TA4NSP = pIn_NSP;
012100160202         K_TA4TRC = pIn_TRC;
012200160202         chain %kds(K05TITA430) TITA430C ;
012300160202         If  %found(TITA430C);
012400160202           select;
012500160202            when pIn_TRC='A';
012600160202             DTA4A = TA4NOT;
012700160202             pOut_Dati = DTA4A;
012800160202             pOut_DS   = 'DTA4A';
012900160202             pOut_Len  = %size(DTA4A);
013000160202           endsl;
013100160202           pOut_Err = 0;
013200140724         endif;
013300140724       endif;
013400091223
013500121106       // Operazioni finali?
013600091223       exsr sr_RoutEnd;
013700091223
013800091223       //--------------------------------------------------------------
013900121107       // Operazioni iniziali.
014000091223       //--------------------------------------------------------------
014100091223       BEGSR  sr_RoutInz;
014200121108
014300121108         // Reperimento data odierna (fmt aaaa/mm/gg)
014400121108         wDate = %dec( %date() );
014500160202
014600160202         // Inizializzazione parametri di output
014700160202         clear pOut_ERR     ;
014800160202         clear pOut_DS      ;
014900160202         clear pOut_Len     ;
015000160202         clear pOut_Dati    ;
015100160202
015200160202         // Inizializzo risultato a errore
015300160202         pOut_Err = 2;
015400160202
015500160202         // Controllo i parametri di input
015600160202         exsr sr_CtrlPIn;
015700160202
015800160202       ENDSR;
015900160202
016000160202       //--------------------------------------------------------------
016100160202       // Controllo i parametri di input
016200160202       //--------------------------------------------------------------
016300160202       BEGSR  sr_CtrlPIn;
016400140724
016500160202         // L'opzione in questo caso non serve'
016600160202
016700160202         // Tipo lancio deve essere blank o 'C'
016800160202         if pIn_TLa <> *blank and pIn_TLa <>'C';
016900160202           // esco dando errore
017000160202           pOut_Err = 1;
017100160202           exsr sr_RoutEnd;
017200140724         endif;
017300160202
017400160202         // Anno spedizione deve essere valorizzato
017500160204         if pIn_Key = *blank;
017600160202           // esco dando errore
017700160202           pOut_Err = 1;
017800160202           exsr sr_RoutEnd;
017900160202         endif;
018000160204
018100160204         // Se la data di riferimento non è stata impostata, assumo data corrente
018200160204         if pIn_Data = 0;
018300160204           // assumo data corrente
018400160204           pIn_Data = WDate;
018500160204         endif;
018600091223
018700091223       ENDSR;
018800121106
018900091223       //--------------------------------------------------------------
019000121107       // Operazioni finali.
019100091223       //--------------------------------------------------------------
019200091223       BEGSR  sr_RoutEnd;
019300140724
019400140724         // Chiusura pgm
019500160202         if pIn_TLa = 'C';
019600140724           *inlr = *on;
019700140724         else;
019800140724           *inrt = *on;
019900140724         endif;
020000140724         return;
020100091223
020200091223       ENDSR;
020300091223
020400091223      /end-free
