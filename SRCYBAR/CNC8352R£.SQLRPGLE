000100080307     ***************************************************************************
000200080307     **
000300080307     ** Questo programma confronta i file CNABI00F e CNABI00W
000400080307     ** e scrive il file YNSBA00F con gli sportelli annullati.
000500080307     **
000600080307     ***************************************************************************
000700080307     H DFTACTGRP(*NO) ACTGRP(*NEW)
000800080307
000900080307      /FREE
001000080307
001100080307       *INLR = *ON;
001200080307
001300080307       EXEC SQL SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED, READ WRITE;
001400080307
001500080307       EXEC SQL DELETE FROM YNSBA00F;
001600080307
001700080307       IF sqlCode < 0;
001800080307         DUMP(A);
001900080307         EXEC SQL ROLLBACK;
002000080307         RETURN;
002100080307       ENDIF;
002200080307
002300080307       // Inserisco gli sportelli che non esistono più.
002400080307
002500080307       EXEC SQL INSERT INTO YNSBA00F (SBAABI, SBACAB)
002600080307                SELECT DIGITS(CNABI00F.ABIABI), DIGITS(CNABI00F.ABICAB)
002700080307                FROM CNABI00F
002800080307                EXCEPTION JOIN CNABI00W
002900080307                ON  CNABI00F.ABIABI = CNABI00W.ABIABI
003000080307                AND CNABI00F.ABICAB = CNABI00W.ABICAB
003100080310                WHERE CNABI00F.ABICAB < 90000
003200080307       ;
003300080307
003400080307       IF sqlCode < 0;
003500080307         DUMP(A);
003600080307         EXEC SQL ROLLBACK;
003700080307         RETURN;
003800080307       ENDIF;
003900080307
004000080307       // Inserisco gli istituti che non esistono più.
004100080307
004200080307       EXEC SQL INSERT INTO YNSBA00F (SBAABI)
004300080307                SELECT DIGITS(CNABI00F.ABIABI)
004400080307                FROM (SELECT DISTINCT ABIABI FROM CNABI00F) AS CNABI00F
004500080307                EXCEPTION JOIN (SELECT DISTINCT ABIABI FROM CNABI00W)
004600080307                               AS CNABI00W
004700080307                ON CNABI00F.ABIABI = CNABI00W.ABIABI
004800080310                WHERE CNABI00F.ABICAB < 90000
004900080307       ;
005000080307
005100080307       IF sqlCode < 0;
005200080307         DUMP(A);
005300080307         EXEC SQL ROLLBACK;
005400080307         RETURN;
005500080307       ENDIF;
005600080307
005700080307       EXEC SQL COMMIT;
005800080307
005900080307      /END-FREE
