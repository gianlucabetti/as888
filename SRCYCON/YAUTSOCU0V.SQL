000100140708--  Generazione SQL
000200140708--  Versione:                  V7R1M0 100423
000300140708--  Generata su:               08/07/14 11:42:57
000400140708--  Database relazionale:      AS888
000500140708--  Opzioni standard:          DB2 for i
000600140708
000700140708CREATE VIEW YAUTSOCU0V (
000800140708  DISTRETTO ,
000900140708  AREA ,
001000140708  FIL ,
001100140708  FILIALE ,
001200140708  UTENTE ,
001300140708  GRUPPO ,
001400140708  SOCIETA_OPERATIVA FOR COLUMN SOCIE00001 ,
001500140708  AUTORIZZATO_SOCIETA FOR COLUMN AUTOR00001 ,
001600140708  AUTORIZZATO_UNITA FOR COLUMN AUTOR00002 )
001700140708  AS
001800140708  SELECT AZORG00F.ORGFL3 AS DISTRETTO, AZORG00F.ORGCAR AS AREA, AZORG00F.ORGFIL AS FIL, AZORG00F.ORG
001900140708DES AS FILIALE, ANUTN00F.UTNPRF AS UTENTE, ANUTN00F.UTNGRP AS GRUPPO, AZSOF00F.IDSOCIETA AS SOCIETA_
002000140708OPERATIVA, ANABS00F.ABSSOC AS AUTORIZZATO_SOCIETA, ANABU00F.ABUUNI AS AUTORIZZATO_UNITA
002100140708   FROM          ANUTN00F ANUTN00F
002200140708   JOIN GAITRAGRU/AZORG00F AZORG00F ON SUBSTR(ANUTN00F.UTNPRF, 4, 3) = DIGITS(AZORG00F.ORGFIL)
002300140708   JOIN UNITRAGRP/AZSOF00F AZSOF00F ON AZORG00F.ORGFIL = AZSOF00F.IDFILIALE AND CURRENT_DATE BETWEEN
002400140708 AZSOF00F.VALIDITA_DATA_INIZIO AND AZSOF00F.VALIDITA_DATA_FINE
002500140708   LEFT OUTER JOIN          ANABS00F ANABS00F ON AZSOF00F.IDSOCIETA = ANABS00F.ABSSOC AND (ANUTN00F.
002600140708UTNPRF = ANABS00F.ABSPRF OR ANUTN00F.UTNGRP = ANABS00F.ABSGRP)
002700140708   LEFT OUTER JOIN          ANABU00F ANABU00F ON AZSOF00F.IDSOCIETA = ANABU00F.ABUSOC AND SUBSTR(ANU
002800140708TN00F.UTNPRF, 4, 3) = ANABU00F.ABUUNI AND (ANUTN00F.UTNPRF = ANABU00F.ABUPRF OR ANUTN00F.UTNGRP = AN
002900140708ABU00F.ABUGRP)
003000140708   WHERE ANUTN00F.UTNUFF = 'FI' AND ANUTN00F.UTNGRP < 999
003100140708   UNION
003200140708    -- Utenti con autorizzazioni che non dovrebbero avere.
003300140708   SELECT AZORG00F.ORGFL3 AS DISTRETTO, AZORG00F.ORGCAR AS AREA, AZORG00F.ORGFIL AS FIL, AZORG00F.OR
003400140708GDES AS FILIALE, ANUTN00F.UTNPRF AS UTENTE, ANUTN00F.UTNGRP AS GRUPPO, AZSOF00F.IDSOCIETA AS SOCIETA
003500140708_OPERATIVA, ANABS00F.ABSSOC AS AUTORIZZATO_SOCIETA, ANABU00F.ABUUNI AS AUTORIZZATO_UNITA
003600140708   FROM          ANUTN00F ANUTN00F
003700140708   JOIN GAITRAGRU/AZORG00F AZORG00F ON SUBSTR(ANUTN00F.UTNPRF, 4, 3) = DIGITS(AZORG00F.ORGFIL)
003800140708   JOIN          ANABU00F ANABU00F ON SUBSTR(ANUTN00F.UTNPRF, 4, 3) = ANABU00F.ABUUNI AND (ANUTN00F.
003900140708UTNPRF = ANABU00F.ABUPRF OR ANUTN00F.UTNGRP = ANABU00F.ABUGRP)
004000140708   JOIN          ANABS00F ANABS00F ON ANABU00F.ABUSOC = ANABS00F.ABSSOC AND (ANUTN00F.UTNPRF = ANABS
00410014070800F.ABSPRF OR ANUTN00F.UTNGRP = ANABS00F.ABSGRP)
004200140708   EXCEPTION JOIN UNITRAGRP/AZSOF00F AZSOF00F ON ANABU00F.ABUUNI = DIGITS(DEC(AZSOF00F.IDFILIALE, 3,
004300140708 0)) AND ANABU00F.ABUSOC = AZSOF00F.IDSOCIETA AND CURRENT_DATE BETWEEN AZSOF00F.VALIDITA_DATA_INIZIO
004400140708 AND AZSOF00F.VALIDITA_DATA_FINE
004500140708   WHERE ANUTN00F.UTNUFF = 'FI' AND ANUTN00F.UTNGRP < 999 AND ANABU00F.ABUSOC <> '201' ;
004600140708
004700140708LABEL ON TABLE YAUTSOCU0V
004800140708  IS 'Utenti autorizzati a società e unità di Proj.' ;
004900140708
005000140708LABEL ON COLUMN YAUTSOCU0V
005100140708( FIL IS 'COD.FIL.' ,
005200140708  UTENTE IS 'Profilo' ,
005300140708  GRUPPO IS 'Gru' ,
005400140708  SOCIETA_OPERATIVA IS 'ID                  Soc' ,
005500140708  AUTORIZZATO_SOCIETA IS 'Società' ,
005600140708  AUTORIZZATO_UNITA IS 'Unità' ) ;
005700140708
005800140708LABEL ON COLUMN YAUTSOCU0V
005900140708( DISTRETTO TEXT IS '3° FLAG ABILITAZIONE' ,
006000140708  AREA TEXT IS 'COD.AREA' ,
006100140708  FIL TEXT IS 'COD.FILIALE' ,
006200140708  FILIALE TEXT IS 'DESCRIZIONE FILIALE' ,
006300140708  UTENTE TEXT IS 'Profilo ....................' ,
006400140708  GRUPPO TEXT IS 'Gruppo .....................' ,
006500140708  SOCIETA_OPERATIVA TEXT IS 'ID società.' ,
006600140708  AUTORIZZATO_SOCIETA TEXT IS 'Società ....................' ,
006700140708  AUTORIZZATO_UNITA TEXT IS 'Unità ......................' ) ;
006800140708
006900140708GRANT SELECT
007000140708ON YAUTSOCU0V TO PUBLIC ;
007100140708
007200140708GRANT ALTER , REFERENCES , SELECT
007300140708ON YAUTSOCU0V TO QPGMR WITH GRANT OPTION ;
007400140708
