000100170328--  Generazione SQL
000200170328--  Versione:                  V7R1M0 100423
000300170328--  Generata su:               29/03/17 11:57:55
000400170328--  Database relazionale:      SETRAS
000500170328--  Opzioni standard:          DB2 for i
000600170328
000700170328CREATE VIEW PJBARGRU/YBLS_REPORT_DG FOR SYSTEM NAME YBLSREPORT (
000800170328  COD_EVENTO ,
000900170328  CLASSIFICAZIONE_ABC FOR COLUMN CLASS_ABC  ,
001000170328  CODICE_CLIENTE FOR COLUMN ID_CLIENTE ,
001100170328  RAGIONE_SOCIALE FOR COLUMN RAG_SOC    ,
001200170328  IMPORTO_SCADUTO_INIZIALE FOR COLUMN IMPSCAINI  ,
001300170328  IMPORTO_SCADUTO_ATTUALE FOR COLUMN IMPSCAATT  ,
001400170328  IMPORTO_ESPOSIZIONE_ATTUALE FOR COLUMN IMPESPATT  ,
001500170328  FILIALE ,
001600170328  AREA ,
001700170328  DISTRETTO ,
001800170328  CODICE_COMMERCIALE FOR COLUMN COD_COMM   ,
001900170328  NOME_COMMERCIALE FOR COLUMN NOME_COMM  ,
002000170328  CAUSALE ,
002100170328  NOTA ,
002200170328  TIPO_PROPOSTA FOR COLUMN TIPOPROP   ,
002300170328  DATA_PROPOSTA FOR COLUMN DATAPROP   )
002400170328  AS
002500170328  SELECT
002600170328  	
002700170328  	EV.COD_EVENTO , CLNCLASABC , ID_CLIENTE AS CODICE_CLIENTE , SOGDES AS RAGIONE_SOCIALE , IMPORTO_S
002800170328CADUTO_INIZIALE ,IMPORTO_SCADUTO_ATTUALE , IMPORTO_ESPOSIZIONE_ATTUALE , ORGFIL AS FILIALE , ORGCAR
002900170328AS AREA , ORGFL3 AS DISTRETTO ,
003000170328  	CMMCOD AS CODICE_COMMERCIALE , CMMDES AS NOME_COMMERCIALE , (SUBSTR(TBEUNI , 1 , 30)) AS CAUSALE
003100170328, VALUE(EV37.NOTA , EV10.NOTA , '') AS NOTA , PR.TIPO_PROPOSTA AS TIPOPROP , PR.DATA_PROPOSTA AS DAT
003200170328APROP
003300170328  	
003400170328  	FROM PJBARGRU/YBLSPR00F PR
003500170328  	
003600170328  	JOIN PJBARGRU/YBLSEV00F EV
003700170328  	ON PR.IDPROPOSTA = EV.IDPROPOSTA AND EV.FLAG_ULTIMO_EVENTO = '1'
003800170328  	
003900170328  	LEFT JOIN PJBARGRU/YBLSEV00F EV10
004000170328  	ON PR.IDPROPOSTA = EV10.IDPROPOSTA AND EV10.COD_EVENTO = '10'
004100170328  	
004200170328  	LEFT JOIN PJBARGRU/YBLSEV00F EV37
004300170328  	ON PR.IDPROPOSTA = EV37.IDPROPOSTA AND EV37.COD_EVENTO = '37'
004400170328  	
004500170328  	JOIN GAITRAGRU/AZORG00F ON DEC(ID_UNITA) = ORGFIL
004600170328  	
004700170328  	JOIN PJBARGRU/ANCLN00F ON PR.ID_SOCIETA = CLNSOCIETA AND PR.ID_CLIENTE = CLNKSC AND CLNFILIALE =
0048001703280 AND CLNLINEAV = ''
004900170328  	JOIN UNITRAGRU/CNCLP00F ON CLPKUT=1 AND CLPKCC=DEC(CLNKCC) AND CLPKSC=DEC(CLNKSC)
005000170328  	JOIN UNITRAGRU/AZCMM00F ON CLPAGE=CMMCOD
005100170328  	JOIN PJBARGRU/ANSOG00F ON CLNSOGG = SOGSOGG
005200170328  	
005300170328  	LEFT JOIN GAITRAGRU/TNTBE00F ON TBECOD = 'BLX' AND TBEKE1 = VALUE(EV37.COD_EVENTO,EV10.COD_EVENTO
005400170328) AND TBEKE2 = VALUE(EV37.CAUSALE_EVENTO,EV10.CAUSALE_EVENTO)
005500170328  	
005600170328  	WHERE DATA_PROPOSTA=(SELECT MAX(DATA_PROPOSTA) FROM PJBARGRU/YBLSPR00F WHERE TIPO_PROPOSTA = 'A')
005700170328
005800170328  RCDFMT YBLSREPORT ;
005900170328
006000170328LABEL ON COLUMN PJBARGRU/YBLS_REPORT_DG
006100170328( CLASSIFICAZIONE_ABC IS 'Cl                  AB' ,
006200170328  CODICE_CLIENTE IS 'ID_CLIENTE' ,
006300170328  RAGIONE_SOCIALE IS 'Ragione             sociale' ,
006400170328  FILIALE IS 'COD.FIL.' ,
006500170328  CODICE_COMMERCIALE IS 'CODICE              COMM.LE' ,
006600170328  NOME_COMMERCIALE IS 'DECOD.              COMMERC.' ) ;
006700170328
006800170328LABEL ON COLUMN PJBARGRU/YBLS_REPORT_DG
006900170328( COD_EVENTO TEXT IS 'Codice Evento' ,
007000170328  CLASSIFICAZIONE_ABC TEXT IS 'Classificazione ABC ........' ,
007100170328  CODICE_CLIENTE TEXT IS 'Codice Evento' ,
007200170328  RAGIONE_SOCIALE TEXT IS 'Ragione sociale ............' ,
007300170328  IMPORTO_SCADUTO_INIZIALE TEXT IS 'Importo Scaduto Iniziale' ,
007400170328  IMPORTO_SCADUTO_ATTUALE TEXT IS 'Importo Scaduto Attuale' ,
007500170328  IMPORTO_ESPOSIZIONE_ATTUALE TEXT IS 'Importo Esposizione Attuale' ,
007600170328  FILIALE TEXT IS 'Codice Filiale' ,
007700170328  AREA TEXT IS 'Codice Area' ,
007800170328  DISTRETTO TEXT IS 'Distretto' ,
007900170328  CODICE_COMMERCIALE TEXT IS 'Codice commerciale' ,
008000170328  NOME_COMMERCIALE TEXT IS 'Nome commerciale' ,
008100170328  CAUSALE TEXT IS 'Causale evento' ,
008200170328  NOTA TEXT IS 'Nota' ,
008300170328  TIPO_PROPOSTA TEXT IS 'Tipo Proposta' ,
008400170328  DATA_PROPOSTA TEXT IS 'DATA PROPOSTA' ) ;
008500170328
008600170328GRANT SELECT
008700170328ON PJBARGRU/YBLS_REPORT_DG TO PUBLIC ;
008800170328
008900170328GRANT ALTER , REFERENCES , SELECT
009000170328ON PJBARGRU/YBLS_REPORT_DG TO QPGMR WITH GRANT OPTION ;
009100170328
