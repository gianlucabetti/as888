000100140114--  Generazione SQL
000200140114--  Versione:                  V7R1M0 100423
000300140114--  Generata su:               14/01/14 10:49:16
000400140114--  Database relazionale:      AS888
000500140114--  Opzioni standard:          DB2 for i
000600140114
000700140114CREATE VIEW YCLI_36 (
000800140114  DATA_CALCOLO FOR COLUMN DTCALCOLO  ,
000900140114  DATA_ESTRAZIONE FOR COLUMN DTESTRAZ   ,
001000140114  SOCIETA ,
001100140114  AREA ,
001200140114  DESCRIZIONE_AREA FOR COLUMN DZAREA     ,
001300140114  KSC_CLIENTE FOR COLUMN KSCCLIENTE ,
001400140114  RAGIONE_SOCIALE FOR COLUMN RAGSOCIALE ,
001500140114  PARTITA_IVA FOR COLUMN PARTITAIVA ,
001600140114  CODICE_FISCALE FOR COLUMN CODFISCALE ,
001700140114  ABC ,
001800140114  IMPORTO_SCADUTO_OLTRE_30 FOR COLUMN IMPSCADU30 ,
001900140114  IMPORTO_ESPOSIZIONE FOR COLUMN IMPESPOSIZ ,
002000140114  SCADENZA ,
002100140114  NUOVO_STATO_CREDITO FOR COLUMN NUOVOSTACR ,
002200140114  AGENTE ,
002300140114  DESCRIZIONE_AGENTE FOR COLUMN DZAGENTE   )
002400140114  AS
002500140114  WITH SCADUTO (SOCIETA, DVA, KCC, KSC, IMPORTO_SCADUTO_OLTRE_30, SCADENZA) AS ( SELECT NDSCL00F.SCL
002600140114CSI, NDSCL00F.SCLDVA, NDSCL00F.SCLKCC, NDSCL00F.SCLKSC, DEC(SUM(NDSCL00F.SCLIMP), 15, 2) AS SCADUTO
002700140114
002800140114  		, MIN(CASE WHEN NDSCL00F.SCLIMP > 0 THEN NDSCL00F.SCLDSC ELSE LAST_DAY(CURRENT_DATE - 1 MONTH) E
002900140114ND)
003000140114  		AS SCADENZA FROM          NDSCL00F NDSCL00F
003100140114  		 WHERE NDSCL00F.SCLCSI = '201' AND NDSCL00F.SCLDVA = '' AND NDSCL00F.SCLDSC <=
003200140114  		 LAST_DAY(CURRENT_DATE - 3 MONTH) AND SUBSTR(NDSCL00F.SCLKSC, 5, 4) NOT IN ('8888', '9999') GROU
003300140114P BY NDSCL00F.SCLCSI
003400140114  		 , NDSCL00F.SCLDVA, NDSCL00F.SCLKCC, NDSCL00F.SCLKSC HAVING SUM(NDSCL00F.SCLIMP) > 0 ) , ESPOSIZ
003500140114IONE (SOCIETA, DVA, KCC, KSC, IMPORTO_ESPOSIZIONE) AS ( SELECT NDEPA00F.EPACSI, NDEPA00F.EPADVA, NDE
003600140114PA00F.EPAKCC, NDEPA00F.EPAKSC, DEC(SUM(NDEPA00F.EPASCO + NDEPA00F.EPAASC + NDEPA00F.EPARIS), 15, 2)
003700140114
003800140114  		AS IMPORTO_ESPOSIZIONE FROM          NDEPA00F NDEPA00F WHERE NDEPA00F.EPACSI = '201' AND NDEPA00
003900140114F.EPADVA = '' GROUP BY NDEPA00F.EPACSI, NDEPA00F.EPADVA, NDEPA00F.EPAKCC, NDEPA00F.EPAKSC )
004000140114  		 SELECT (SELECT NDMEM00F.MEMDMD FROM          NDMEM00F NDMEM00F WHERE NDMEM00F.MEMCSI = '201' AN
004100140114D NDMEM00F.MEMDVA = '' AND NDMEM00F.MEMKCC = '000151' AND NDMEM00F.MEMANN = '') AS DATA_CALCOLO , CU
004200140114RRENT_TIMESTAMP AS DATA_ESTRAZIONE, SCADUTO.SOCIETA, AZORG00F.ORGCAR AS ID_AREA, VARCHAR(RTRIM(LEFT(
004300140114TABEL_05.TBLUNI, 25)), 25) AS DESCRIZIONE_AREA, SCADUTO.KSC AS ID_CLIENTE , RTRIM(ANSOG00F.SOGDES CO
004400140114NCAT ANSOG00F.SOGDESAGG) AS RAGIONE_SOCIALE, RTRIM(ANSOG00F.SOGPARTIVA) AS PARTITA_IVA, RTRIM(ANSOG0
0045001401140F.SOGCDFISC) AS CODICE_FISCALE, ANCLN00F.CLNCLASABC AS ABC , SCADUTO.IMPORTO_SCADUTO_OLTRE_30, ESPO
004600140114SIZIONE.IMPORTO_ESPOSIZIONE, SCADUTO.SCADENZA , CHAR(' 36' , 3) AS NUOVO_STATO_CREDITO
004700140114  		 , DIGITS(YBACL00F.ACLAGE) AS ID_AGENTE
004800140114  		 , CMMDES AS DESCRIZIONE_AGENTE
004900140114  		 FROM SCADUTO SCADUTO
005000140114  		 JOIN ESPOSIZIONE ESPOSIZIONE ON SCADUTO.SOCIETA = ESPOSIZIONE.SOCIETA AND SCADUTO.DVA = ESPOSIZ
005100140114IONE.DVA AND SCADUTO.KCC = ESPOSIZIONE.KCC AND SCADUTO.KSC = ESPOSIZIONE.KSC
005200140114  		 JOIN PJBARGRU/ANRCO00F ANRCO00F ON SCADUTO.SOCIETA = ANRCO00F.RCOSOCIETA AND 'C' = ANRCO00F.RCO
005300140114SNATURA AND SCADUTO.KSC = ANRCO00F.RCOKSC
005400140114  		 JOIN PJBARGRU/ANCLN00F ANCLN00F ON SCADUTO.SOCIETA = ANCLN00F.CLNSOCIETA AND SCADUTO.KSC = ANCL
005500140114N00F.CLNKSC AND 0 = ANCLN00F.CLNFILIALE AND '' = ANCLN00F.CLNLINEAV
005600140114  		 JOIN PJBARGRU/YBACL00F YBACL00F ON SCADUTO.SOCIETA = YBACL00F.ACLSOCIETA AND SCADUTO.KCC = YBAC
005700140114L00F.ACLKCC AND SCADUTO.KSC = YBACL00F.ACLKSC
005800140114  		 JOIN PJBARGRU/ANSOG00F ANSOG00F ON ANRCO00F.RCOSOGG = ANSOG00F.SOGSOGG
005900140114  		 JOIN GAITRAGRPS/AZORG00F AZORG00F ON SUBSTR(SCADUTO.KSC, 2, 3) = AZORG00F.ORGFIL
006000140114  		
006100140114  		 JOIN UNITRAGRP/AZCMM00F ON YBACL00F.ACLAGE = CMMCOD
006200140114  		 JOIN GAITRAGRPS/TABEL00F TABEL_05 ON 1 = TABEL_05.TBLKUT AND '05' = TABEL_05.TBLCOD AND AZORG00
006300140114F.ORGCAR = TABEL_05.TBLKEY
006400140114  		 WHERE ANRCO00F.RCOCTGAN03 < ' 39' AND SUBSTR(AZORG00F.ORGDE3, 11, 3) IN ('COR', 'MES') AND SCAD
006500140114UTO.SCADENZA < LAST_DAY(CURRENT_DATE - 1 MONTH) ;
006600140114
006700140114GRANT SELECT
006800140114ON YCLI_36 TO PUBLIC ;
006900140114
007000140114GRANT ALTER , REFERENCES , SELECT
007100140114ON YCLI_36 TO QPGMR WITH GRANT OPTION ;
007200140114
